<!DOCTYPE html>
<html>
<head>
    <title>Researchopia æµ‹è¯•é¢æ¿</title>
    <meta charset="utf-8"/>
</head>
<body>
    <h2>åå¥½è®¾ç½®æµ‹è¯•</h2>
    <p>è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„æµ‹è¯•é¢æ¿</p>
    
    <button id="simpleTestBtn" style="padding: 10px; font-size: 14px;" onclick="testClick();">ç®€å•æµ‹è¯•æŒ‰é’®</button>
    <div id="testResult" style="margin-top: 10px; padding: 10px; border: 1px solid #ccc;">ç­‰å¾…æŒ‰é’®ç‚¹å‡»...</div>
    
    <script>
        // ç«‹å³æ‰§è¡Œçš„åŸºç¡€æµ‹è¯•
        (function() {
            console.log('IMMEDIATE: æµ‹è¯•è„šæœ¬å¼€å§‹æ‰§è¡Œ');
            
            // æ˜¾ç¤ºæ‰§è¡Œæ ‡è®°
            var resultDiv = document.getElementById('testResult');
            if (resultDiv) {
                resultDiv.innerHTML = 'è„šæœ¬å·²åŠ è½½ï¼Œç­‰å¾…æŒ‰é’®ç‚¹å‡»...';
                resultDiv.style.backgroundColor = '#fff3cd';
            }
        })();
        
        // å…¨å±€å‡½æ•°ï¼Œç”¨äºæŒ‰é’®ç‚¹å‡»
        function testClick() {
            console.log('CLICK: æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼');
            var resultDiv = document.getElementById('testResult');
            if (resultDiv) {
                resultDiv.innerHTML = 'âœ… æŒ‰é’®å“åº”æˆåŠŸï¼æ—¶é—´: ' + new Date().toLocaleString();
                resultDiv.style.backgroundColor = '#e8f5e8';
            }
            
            // æµ‹è¯• Zotero å¯¹è±¡è®¿é—®
            try {
                if (typeof Zotero !== 'undefined') {
                    console.log('Zoteroå¯¹è±¡å¯ç”¨:', Zotero);
                    resultDiv.innerHTML += '<br>âœ… Zoteroå¯¹è±¡å¯ç”¨';
                } else {
                    console.log('Zoteroå¯¹è±¡ä¸å¯ç”¨');
                    resultDiv.innerHTML += '<br>âŒ Zoteroå¯¹è±¡ä¸å¯ç”¨';
                }
            } catch (e) {
                console.error('è®¿é—®Zoteroå¯¹è±¡å‡ºé”™:', e);
                resultDiv.innerHTML += '<br>âŒ è®¿é—®Zoteroå‡ºé”™: ' + e.message;
            }
        }
        
        // æ–‡æ¡£å°±ç»ªæ£€æµ‹
        function checkDocReady() {
            console.log('DOC_READY: æ–‡æ¡£çŠ¶æ€æ£€æŸ¥:', document.readyState);
            var resultDiv = document.getElementById('testResult');
            if (resultDiv && document.readyState === 'complete') {
                resultDiv.innerHTML += '<br>ğŸ“„ æ–‡æ¡£åŠ è½½å®Œæˆ';
            }
        }
        
        // å¤šç§åˆå§‹åŒ–æ£€æµ‹
        checkDocReady();
        setTimeout(checkDocReady, 100);
        setTimeout(checkDocReady, 500);
        
        if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOMContentLoaded äº‹ä»¶è§¦å‘');
                checkDocReady();
            });
        }
        
        if (window.addEventListener) {
            window.addEventListener('load', function() {
                console.log('Window load äº‹ä»¶è§¦å‘');
                checkDocReady();
            });
        }
    </script>
</body>
</html>