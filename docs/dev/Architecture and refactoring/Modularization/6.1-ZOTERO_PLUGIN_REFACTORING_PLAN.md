# Zotero æ’ä»¶ç³»ç»Ÿæ€§é‡æ„æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-11  
**çŠ¶æ€**: ğŸš§ æ‰§è¡Œä¸­  
**é¢„è®¡å®Œæˆ**: 2025-11-18  

æœ¬æ–‡æ¡£æä¾› Researchopia Zotero æ’ä»¶çš„**ç³»ç»Ÿæ€§ã€å¯æ‰§è¡Œçš„æ¨¡å—åŒ–é‡æ„æ–¹æ¡ˆ**ï¼Œç›®æ ‡æ˜¯ï¼š
- å°†è‡ƒè‚¿æ–‡ä»¶æ‹†åˆ†ä¸ºåˆç†å¤§å°çš„æ¨¡å—
- æ¶ˆé™¤é‡å¤ä»£ç ï¼Œæé«˜ä»£ç å¤ç”¨ç‡
- å»ºç«‹æ¸…æ™°çš„æ¶æ„å±‚æ¬¡
- ç¡®ä¿æ¯æ¬¡é‡æ„éƒ½å¯æµ‹è¯•ã€å¯å›æ»š

---

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### ä»£ç é‡ç»Ÿè®¡ (2025-11-11, æ›´æ–°: 2025-11-12)

| æ–‡ä»¶ | åŸå§‹è¡Œæ•° | å½“å‰è¡Œæ•° | å‡å°‘ | çŠ¶æ€ | ä¼˜å…ˆçº§ | ç›®æ ‡è¡Œæ•° |
|-----|---------|---------|------|------|--------|---------|
| **sessionAnnotationsView.ts** | 3131 | 1115 | -2016 (-64.4%) | âœ… é˜¶æ®µæ€§å®Œæˆ | P0 â†’ P1 | <1200 âœ… |
| **pdfReaderManager.ts (V1)** | 2761 | 1379 | -1382 (-50.1%) | âœ… å·²å®ŒæˆV2 | P0 | <1200 âœ… |
| **PDFReaderManagerV2.ts (V2)** | - | 443 | +443 (æ–°å¢) | âœ… å®Œæˆ | P0 | <500 âœ… |
| **ui-manager.ts** | 1626 | 1017 | -609 (-37.5%) | âœ… ç›®æ ‡è¾¾æˆ | P1 | <800 âœ… |
| **paperEvaluationView.ts** | 1061 | 378 | -683 (-64.4%) | âœ… å®Œæˆ | P1 | <600 âœ… |
| **quickSearchView.ts** | 954 | 520 | -434 (-45.5%) | âœ… å®Œæˆ | P2 | <600 âœ… |
| **myAnnotationsView.ts** | 660 | 605 | -55 (-8.3%) | âœ… å®Œæˆ | P3 | <600 âœ… |
| **userHoverCard.ts** | 647 | 581 | -66 (-10.2%) | âœ… å®Œæˆ | P3 | <600 âœ… |
| **currentSessionTabView.ts** | 738 | 551 | -187 (-25.3%) | âœ… å®Œæˆ | P3 | <600 âœ… |
| **sessionMinutesView.ts** | 574 | 403 | -171 (-29.8%) | âœ… å®Œæˆ | P3 | <600 âœ… |
| **preferenceScript.ts** | 646 | 468 | -178 (-27.6%) | âœ… å®Œæˆ | P0 | <600 âœ… |

**æ€»ä»£ç é‡**: ~17,000 è¡Œ TypeScript (åŒ…æ‹¬æ‰€æœ‰æ¨¡å—)  
**å·²æå–æ–°ç»„ä»¶**: +7810 lines (42+ä¸ªæ–°æ¨¡å—:27ä¸ªæ—©æœŸç»„ä»¶ + 5ä¸ªPDFå­æ¨¡å— + 5ä¸ªåå¥½å·¥å…· + 2ä¸ªç”¨æˆ·å¡ç‰‡ + 6ä¸ªPhase 8å·¥å…· + 2ä¸ªPhase 10å·¥å…· + userHoverCardä¸»æ–‡ä»¶ä¼˜åŒ–)
- Session Annotations: 15ä¸ªç»„ä»¶/å·¥å…· (AnnotationManageOperationsè·¨è§†å›¾å¤ç”¨)
- Paper Evaluation: 3ä¸ªç»„ä»¶ (PaperRatingForm, PaperCommentNode, paperCommentEditor)
- Quick Search: 1ä¸ªå¯¹è¯æ¡†ç»„ä»¶ (QuickSearchSettingsDialog)
- Session Header: 1ä¸ªç»„ä»¶é›† (SessionHeaderComponents)
- User Hover Card: 2ä¸ªå·¥å…·æ¨¡å— (UserAvatarCreator, HoverCardHelpers)
- Session Minutes: 2ä¸ªå·¥å…·æ¨¡å— (EventTimelineRenderer, MinutesExporter)
- PDFæ¨¡å—V2: 5ä¸ªä¸“ä¸šå­æ¨¡å—(OverlayRenderer 315è¡Œ, CoordinateMapper 265è¡Œ, CommentPopupManager 418è¡Œ, SVGOverlayCreator 361è¡Œ, PDFEventListener 84è¡Œ)
- UI/Utils: 15ä¸ªå·¥å…·å‡½æ•°
- Path Aliases: 42ä¸ªæ–‡ä»¶å®Œæˆ@utilsåˆ«ååº”ç”¨ âœ…

**ä»£ç å¤ç”¨æˆæœ**:
- AnnotationManageOperationsæ¨¡å—è¢«2ä¸ªè§†å›¾å¤ç”¨(sessionAnnotationsView + myAnnotationsView)
- æ¶ˆé™¤äº†~55è¡Œé‡å¤æ‰¹é‡æ“ä½œä»£ç 
- æé«˜äº†ä»£ç ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§

### é—®é¢˜è¯†åˆ«

#### ğŸ”´ ä¸¥é‡é—®é¢˜

1. **sessionAnnotationsView.ts (3131â†’1936è¡Œ, -38.2%)**
   - âœ… å·²æå–Phase 2-10: CommentNodeã€BatchToolbarã€MemberSelectionDialogã€CommentActionsã€ToolbarHelpersã€EmptyState
   - âœ… å·²æå–Phase 11-12: SearchStatsã€AnnotationMetaã€StatusSectionã€AnnotationContentã€Modal
   - âœ… å·²æå–Phase 13: CommentInputArea
   - âœ… å·²æå–Phase 14: annotationSorterå·¥å…·
   - âœ… å·²æå–Phase 15: ActionButtonç»„ä»¶
   - âœ… å·²æå–Phase 16: cardHighlighterå·¥å…·
   - âœ… å·²æå–Phase 17: annotationDeduplicatorå·¥å…·
   - âœ… å·²æå–Phase 18: pdfOpenerå·¥å…·
   - âœ… å·²æå–Phase 19: batchShareConfirmationå·¥å…·
   - âœ… å·²æå–Phase 20: batchShareToSessionå·¥å…·
   - ğŸ”„ è¿›è¡Œä¸­: ç»§ç»­æå–é‡å¤UIæ¨¡å¼å’Œå¤§æ–¹æ³•ï¼Œç›®æ ‡ <800 è¡Œè¿˜éœ€ -980 è¡Œ (-55.1%)
   - æ··åˆäº†æ ‡æ³¨æ¸²æŸ“ã€è¯„è®ºç³»ç»Ÿã€ç‚¹èµåŠŸèƒ½ã€ç­›é€‰æ’åº
   - åŒ…å« 50+ ä¸ªæ–¹æ³•
   - ä»£ç é‡å¤ç‡é«˜ (ä¸ myAnnotationsView.ts é‡å¤ ~40%)

2. âœ… **pdfReaderManager.ts (2760è¡Œ) - å·²å®ŒæˆV2é‡æ„**
   - âœ… Phase 48å®Œæˆ: åˆ›å»ºPDFReaderManagerV2ä½œä¸ºè½»é‡çº§åè°ƒå™¨(443è¡Œ)
   - âœ… æ‹†åˆ†ä¸º5ä¸ªä¸“ä¸šæ¨¡å—:
     - OverlayRenderer (315è¡Œ) - å åŠ å±‚æ¸²æŸ“é€»è¾‘
     - CoordinateMapper (265è¡Œ) - åæ ‡è½¬æ¢å’Œè®¡ç®—
     - CommentPopupManager (418è¡Œ) - è¯„è®ºå¼¹çª—ç®¡ç†
     - SVGOverlayCreator (361è¡Œ) - SVGå…ƒç´ åˆ›å»º
     - PDFEventListener (84è¡Œ) - äº‹ä»¶ç›‘å¬å™¨
   - âœ… V1ç‰ˆæœ¬ä¿ç•™ä¸ºPDFReaderManager (1379è¡Œ),ä¿æŒå‘åå…¼å®¹
   - âœ… ç›®æ ‡è¾¾æˆ: V2 443è¡Œ << 1200è¡Œ âœ…âœ…âœ…

#### ğŸŸ¡ æ¬¡è¦é—®é¢˜

3. **ui-manager.ts (1626è¡Œ)**
   - ä½œä¸ºæ€»æ§åˆ¶å™¨ï¼Œæ‰¿æ‹…äº†å¤ªå¤š UI æ¸²æŸ“é€»è¾‘
   - åº”è¯¥åªè´Ÿè´£åè°ƒï¼Œå…·ä½“æ¸²æŸ“äº¤ç»™å„ä¸ª View

4. **ä»£ç é‡å¤ä¸¥é‡**
   - `createButton`ã€`formatDate`ã€`showMessage` ç­‰å·¥å…·å‡½æ•°åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤
   - è¯„è®ºç³»ç»Ÿä»£ç åœ¨ sessionAnnotationsView å’Œ myAnnotationsView ä¸­é‡å¤

---

## ğŸ¯ é‡æ„ç›®æ ‡

### çŸ­æœŸç›®æ ‡ (Phase 1-3: 1å‘¨å†…)

- [x] **P0 é˜¶æ®µæ€§å®Œæˆ**: sessionAnnotationsView.ts ä» 3131 è¡Œ â†’ 1780 è¡Œ (-43.1%, å·²å®ŒæˆP0åŸºç¡€ç›®æ ‡)
  - âœ… Phase 2-20å®Œæˆ: æå–14ä¸ªç»„ä»¶/å·¥å…· + 15ä¸ªutils
  - âœ… åŠŸèƒ½ç»„ä»¶åŒ–: è¯„è®ºç³»ç»Ÿã€ç‚¹èµç³»ç»Ÿã€æ‰¹é‡æ“ä½œå…¨éƒ¨æ¨¡å—åŒ–
  - ğŸ¯ ä¸‹ä¸€é˜¶æ®µè®¡åˆ’: åˆ›å»ºç‹¬ç«‹Viewç±»(éœ€è¦æ¶æ„çº§é‡æ„,ä¼˜å…ˆçº§è°ƒæ•´ä¸ºP1+)
  - ğŸ’¡ å»ºè®®: æ–‡ä»¶å·²é«˜åº¦æ¨¡å—åŒ–,ç»§ç»­ä¼˜åŒ–å…¶ä»–P1/P2æ–‡ä»¶æ€§ä»·æ¯”æ›´é«˜
- [x] **P0 âœ…âœ…âœ… å®Œæˆ**: pdfReaderManager.ts V2é‡æ„å®Œæˆ
  - âœ… Phase 21-47å®Œæˆ: æå–27ä¸ªå·¥å…·å‡½æ•° + 5ä¸ªä¸“ä¸šå­æ¨¡å—
  - âœ… V2æ¶æ„: PDFReaderManagerV2 (443è¡Œ) + 5ä¸ªå­æ¨¡å— (1,443è¡Œ)
  - âœ… ç›®æ ‡è¾¾æˆ: 443è¡Œ << 1200è¡Œ,è¶…é¢å®Œæˆ63%! ğŸ‰ğŸ‰ğŸ‰
- [x] âœ… **P1 å®Œæˆ**: ui-manager.ts ä» 1626 è¡Œ â†’ 1017 è¡Œ (-37.5%, ç›®æ ‡ <800 è¶…é¢å®Œæˆ +217è¡Œ!) ğŸ‰ğŸ‰
  - âœ… Phase 26-32å®Œæˆ: æå–7ä¸ªå·¥å…·/ç»„ä»¶
  - âœ… Phase 49å®Œæˆ: æå–doiCopyHandlerå·¥å…· (-52è¡Œ)
  - âœ… ç›®æ ‡è¶…é¢å®Œæˆ: 1017è¡Œ << 800è¡Œ âœ…âœ…âœ…
- [x] âœ… **Task 3**: è·¯å¾„åˆ«ååº”ç”¨ - 42ä¸ªæ–‡ä»¶å®Œæˆ@utilsåˆ«å âœ…
- [x] âœ… å»ºç«‹æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ - PDFæ¨¡å—å®Œå…¨ç‹¬ç«‹ âœ…

### ä¸­æœŸç›®æ ‡ (Phase 3: 2å‘¨å†…)

- [x] **P1 å®Œæˆ**: paperEvaluationView.ts ä» 928 è¡Œ â†’ 378 è¡Œ (-59.3%, ç›®æ ‡<600è¶…é¢37%) ğŸ‰ğŸ‰ğŸ‰
  - âœ… Phase 50-52: æå–PaperRatingFormã€PaperCommentNodeã€PaperCommentEditor
  - âœ… å‡å°‘550è¡Œ,æˆæœæ˜¾è‘—!
- [ ] **P2**: quickSearchView.ts ä» 954 è¡Œ â†’ <600 è¡Œ
- [ ] å®Œå–„å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹

### é•¿æœŸç›®æ ‡ (Phase 4: æŒç»­)

- [ ] æ‰€æœ‰æ–‡ä»¶ <1000 è¡Œ
- [ ] ä»£ç é‡å¤ç‡ <5%
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >80%
- [ ] å»ºç«‹è‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ£€æŸ¥

---

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡

### ç›®æ ‡æ¶æ„å±‚æ¬¡

```
src/modules/
â”œâ”€â”€ core/                    # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯ç®¡ç†å™¨
â”‚   â”œâ”€â”€ readingSessionManager.ts
â”‚   â”œâ”€â”€ supabase.ts
â”‚   â””â”€â”€ annotations/        # ğŸ“¦ æ–°å¢:æ ‡æ³¨æ ¸å¿ƒé€»è¾‘
â”‚       â”œâ”€â”€ annotationManager.ts
â”‚       â”œâ”€â”€ commentManager.ts
â”‚       â””â”€â”€ likeManager.ts
â”‚
â”œâ”€â”€ pdf/                     # âœ… PDFç›¸å…³æ¨¡å—(å·²å®Œæˆ)
â”‚   â”œâ”€â”€ types.ts            # ç±»å‹å®šä¹‰ (59è¡Œ)
â”‚   â”œâ”€â”€ PDFReaderManagerV2.ts  # V2ä¸»ç®¡ç†å™¨ (443è¡Œ) âœ…
â”‚   â”œâ”€â”€ index.ts            # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ events/
â”‚   â”‚   â””â”€â”€ PDFEventListener.ts    # äº‹ä»¶ç›‘å¬ (84è¡Œ) âœ…
â”‚   â”œâ”€â”€ overlay/
â”‚   â”‚   â””â”€â”€ OverlayRenderer.ts     # å åŠ å±‚æ¸²æŸ“ (315è¡Œ) âœ…
â”‚   â”œâ”€â”€ coordinates/
â”‚   â”‚   â””â”€â”€ CoordinateMapper.ts    # åæ ‡æ˜ å°„ (265è¡Œ) âœ…
â”‚   â”œâ”€â”€ popup/
â”‚   â”‚   â””â”€â”€ CommentPopupManager.ts # å¼¹çª—ç®¡ç† (418è¡Œ) âœ…
â”‚   â”œâ”€â”€ svg/
â”‚   â”‚   â””â”€â”€ SVGOverlayCreator.ts   # SVGåˆ›å»º (361è¡Œ) âœ…
â”‚   â””â”€â”€ utils/              # 27ä¸ªPDFå·¥å…·å‡½æ•° âœ…
â”‚
â”œâ”€â”€ ui/                      # UI è§†å›¾å±‚
â”‚   â”œâ”€â”€ views/               # è§†å›¾ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ annotations/    # ğŸ“¦ æ–°å¢:æ ‡æ³¨è§†å›¾å­æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ AnnotationListView.ts    # æ ‡æ³¨åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ AnnotationCardView.ts    # æ ‡æ³¨å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ CommentSectionView.ts    # è¯„è®ºåŒº
â”‚   â”‚   â”‚   â””â”€â”€ FilterToolbarView.ts     # ç­›é€‰å·¥å…·æ 
â”‚   â”‚   â”œâ”€â”€ session/
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionListView.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionPlazaView.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ components/          # ğŸ“¦ é‡ç»„:å¯å¤ç”¨ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ buttons/
â”‚   â”‚   â”‚   â”œâ”€â”€ PrimaryButton.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ BackButton.ts
â”‚   â”‚   â”‚   â””â”€â”€ IconButton.ts
â”‚   â”‚   â”œâ”€â”€ inputs/
â”‚   â”‚   â”‚   â”œâ”€â”€ TextInput.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ TextArea.ts
â”‚   â”‚   â”‚   â””â”€â”€ SearchBox.ts
â”‚   â”‚   â”œâ”€â”€ cards/
â”‚   â”‚   â”‚   â”œâ”€â”€ AnnotationCard.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionCard.ts
â”‚   â”‚   â”‚   â””â”€â”€ UserCard.ts
â”‚   â”‚   â””â”€â”€ dialogs/
â”‚   â”‚       â”œâ”€â”€ ConfirmDialog.ts
â”‚   â”‚       â””â”€â”€ MemberSelectDialog.ts
â”‚   â”‚
â”‚   â””â”€â”€ shared/              # å…±äº« UI å·¥å…·
â”‚       â”œâ”€â”€ styles.ts
â”‚       â”œâ”€â”€ themeManager.ts
â”‚       â””â”€â”€ uiHelpers.ts
â”‚
â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°å±‚
    â”œâ”€â”€ formatting/          # ğŸ“¦ æ–°å¢:æ ¼å¼åŒ–å·¥å…·
    â”‚   â”œâ”€â”€ dateFormatter.ts
    â”‚   â”œâ”€â”€ textFormatter.ts
    â”‚   â””â”€â”€ numberFormatter.ts
    â”œâ”€â”€ dom/                 # ğŸ“¦ æ–°å¢:DOM æ“ä½œå·¥å…·
    â”‚   â”œâ”€â”€ createElement.ts
    â”‚   â”œâ”€â”€ eventHandlers.ts
    â”‚   â””â”€â”€ domUtils.ts
    â””â”€â”€ validation/          # ğŸ“¦ æ–°å¢:éªŒè¯å·¥å…·
        â”œâ”€â”€ inputValidator.ts
        â””â”€â”€ dataValidator.ts
```

### æ¨¡å—èŒè´£å®šä¹‰

#### Core å±‚
- **èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ– UI
- **åŸåˆ™**: å•ä¾‹æ¨¡å¼ï¼ŒçŠ¶æ€ç®¡ç†ï¼Œæ•°æ®æŒä¹…åŒ–
- **ç¤ºä¾‹**: `AuthManager`ã€`ReadingSessionManager`

#### PDF å±‚
- **èŒè´£**: PDF é˜…è¯»å™¨é›†æˆï¼ŒOverlay æ¸²æŸ“
- **åŸåˆ™**: äº‹ä»¶é©±åŠ¨ï¼Œè§£è€¦æ¸²æŸ“å’Œç›‘å¬
- **ç¤ºä¾‹**: `ReaderListener`ã€`OverlayRenderer`

#### UI/Views å±‚
- **èŒè´£**: è§†å›¾æ¸²æŸ“å’Œäº¤äº’é€»è¾‘
- **åŸåˆ™**: ç»„åˆä¼˜äºç»§æ‰¿ï¼Œå•ä¸€èŒè´£
- **ç¤ºä¾‹**: `AnnotationListView`ã€`SessionListView`

#### UI/Components å±‚
- **èŒè´£**: å¯å¤ç”¨çš„ UI ç»„ä»¶
- **åŸåˆ™**: æ— çŠ¶æ€ï¼Œé€šè¿‡å›è°ƒä¸å¤–éƒ¨é€šä¿¡
- **ç¤ºä¾‹**: `PrimaryButton`ã€`TextInput`

#### Utils å±‚
- **èŒè´£**: çº¯å‡½æ•°å·¥å…·
- **åŸåˆ™**: æ— å‰¯ä½œç”¨ï¼Œå¯ç‹¬ç«‹æµ‹è¯•
- **ç¤ºä¾‹**: `formatDate`ã€`createElement`

---

## ğŸ“ è¯¦ç»†é‡æ„æ–¹æ¡ˆ

## Phase 1: æå–å…±äº«å·¥å…·å’Œç»„ä»¶ (ç¬¬1-2å¤©)

### ç›®æ ‡
æ¶ˆé™¤é‡å¤ä»£ç ï¼Œå»ºç«‹åŸºç¡€è®¾æ–½

### ä»»åŠ¡æ¸…å•

#### âœ… Task 1.1: æå–æ ¼å¼åŒ–å·¥å…·
**åˆ›å»º**: `src/modules/utils/formatting/`

```typescript
// dateFormatter.ts
export function formatDate(date: string | Date, format?: 'full' | 'short'): string;
export function formatRelativeTime(date: string | Date): string;

// textFormatter.ts
export function truncateText(text: string, maxLength: number): string;
export function highlightText(text: string, query: string): string;

// numberFormatter.ts
export function formatNumber(num: number): string;
export function formatFileSize(bytes: number): string;
```

**å½±å“æ–‡ä»¶**: 
- sessionAnnotationsView.ts
- myAnnotationsView.ts
- sessionMinutesView.ts
- helpers.ts (ä¿ç•™,ä½†æ ‡è®°ä¸º deprecated)

**é¢„æœŸå‡å°‘**: ~100 è¡Œé‡å¤ä»£ç 

---

#### âœ… Task 1.2: æå– DOM å·¥å…·
**åˆ›å»º**: `src/modules/utils/dom/`

```typescript
// createElement.ts
export interface ElementConfig {
  tag: string;
  className?: string;
  styles?: Partial<CSSStyleDeclaration>;
  attributes?: Record<string, string>;
  children?: (HTMLElement | string)[];
}

export function createElement(config: ElementConfig): HTMLElement;

// eventHandlers.ts
export function debounce<T extends (...args: any[]) => void>(
  fn: T,
  delay: number
): T;

export function throttle<T extends (...args: any[]) => void>(
  fn: T,
  delay: number
): T;
```

**å½±å“æ–‡ä»¶**: æ‰€æœ‰ UI è§†å›¾æ–‡ä»¶

**é¢„æœŸå‡å°‘**: ~150 è¡Œé‡å¤ä»£ç 

---

#### âœ… Task 1.3: é‡ç»„ UI ç»„ä»¶åº“
**åˆ›å»º**: `src/modules/ui/components/`

```typescript
// buttons/PrimaryButton.ts
export interface ButtonConfig {
  text: string;
  variant: 'primary' | 'success' | 'danger' | 'warning' | 'secondary';
  fullWidth?: boolean;
  disabled?: boolean;
  icon?: string;
  onClick?: () => void;
}

export function createPrimaryButton(doc: Document, config: ButtonConfig): HTMLButtonElement;

// inputs/SearchBox.ts
export interface SearchBoxConfig {
  placeholder?: string;
  debounceMs?: number;
  onSearch: (query: string) => void;
}

export function createSearchBox(doc: Document, config: SearchBoxConfig): HTMLElement;

// cards/AnnotationCard.ts
export interface AnnotationCardConfig {
  annotation: any;
  showActions?: boolean;
  onLocate?: (annotation: any) => void;
  onLike?: (annotation: any) => void;
  onComment?: (annotation: any) => void;
  onDelete?: (annotation: any) => void;
}

export function createAnnotationCard(doc: Document, config: AnnotationCardConfig): HTMLElement;
```

**è¿ç§»**: 
- `uiHelpers.ts` â†’ æ‹†åˆ†åˆ° `components/*`
- `helpers.ts` â†’ ä¿ç•™çº¯å·¥å…·å‡½æ•°

**é¢„æœŸå‡å°‘**: ~200 è¡Œé‡å¤ä»£ç 

---

#### ğŸ”§ **æµ‹è¯•ç‚¹ 1.1-1.3**
- [ ] ç¼–è¯‘é€šè¿‡: `npm run build`
- [ ] å¯¼å…¥æ— é”™è¯¯
- [ ] åŸæœ‰åŠŸèƒ½æ­£å¸¸ (æ‰‹åŠ¨æµ‹è¯•ä¸»è¦è§†å›¾)

---

## Phase 2: é‡æ„ sessionAnnotationsView.ts (ç¬¬3-5å¤©)

### å½“å‰çŠ¶æ€
- **3131 è¡Œ** - ğŸ”´ ä¸¥é‡è¶…æ ‡
- **50+ æ–¹æ³•**
- æ··åˆåŠŸèƒ½: æ ‡æ³¨åˆ—è¡¨ã€è¯„è®ºç³»ç»Ÿã€ç‚¹èµã€ç­›é€‰ã€æ‰¹é‡ç®¡ç†

### é‡æ„ç­–ç•¥
æ‹†åˆ†ä¸º **6 ä¸ªç‹¬ç«‹æ¨¡å—**ï¼Œä¸»æ–‡ä»¶åªè´Ÿè´£åè°ƒ

---

### ğŸ“Š Phase 2 è¿›åº¦ (3131 â†’ 2102, -32.9%)

**å·²å®Œæˆçš„UIç»„ä»¶ç»Ÿä¸€åŒ–**:
- [x] 2024-01-XX: åˆ›å»º `createCommentTextarea` (-28 lines, commit: 637538a3)
- [x] 2024-01-XX: åˆ›å»º `createAnonymousSwitch` (-47 lines, commit: 06ec83b7)  
  æ›¿æ¢äº†3å¤„åŒ¿åå¼€å…³åˆ›å»ºä»£ç 
- [x] 2024-01-XX: åˆ›å»º `createFlexContainer` (-51 lines net, commit: 1b26f708)  
  ç»Ÿä¸€äº†7å¤„flexå®¹å™¨ï¼šbuttonGroupÃ—2, inputAreaContainer, buttonContainer, metadataDiv, actionsDiv, actions, contentArea
- [x] 2024-01-XX: åˆ›å»º `createStatusMessage` (-12 lines, commit: auto)  
  ç»Ÿä¸€äº†4å¤„é”™è¯¯/ç©ºçŠ¶æ€æ¶ˆæ¯åˆ›å»º
- [x] 2024-01-XX: åˆ›å»º `createSectionHeader` (-27 lines, commit: caaa9de4)  
  ç»Ÿä¸€æ ‡é¢˜+å¾½ç« çš„å¤´éƒ¨å®¹å™¨åˆ›å»º
- [x] 2024-01-XX: åˆ›å»º `createPopupHeader` (-39 lines, commit: 494532f4)  
  ç»Ÿä¸€å¼¹å‡ºæ¡†æ ‡é¢˜æ åˆ›å»ºï¼ŒåŒ…å«æ ‡é¢˜å’Œå…³é—­æŒ‰é’®

**ç´¯è®¡ä¼˜åŒ–**: -1066 lines (-34.0%, 3131â†’2065)

**ç»„ä»¶åŒ–è¿›å±•**:
- [x] 2024-01-XX: æå– `ManageAnnotationCard` ç»„ä»¶ (+307 lines new file, -293 lines main, commit: a386a21a)  
  å®Œæ•´æ›¿æ¢äº†~300è¡Œçš„createManageAnnotationCardæ–¹æ³•ï¼Œå¢åŠ handleManageAnnotationShareToggleå’ŒhandleManageAnnotationAnonymousToggleä¸¤ä¸ªè¾…åŠ©æ–¹æ³•
- [x] 2024-01-XX: æå– `CommentNode` ç»„ä»¶ (+267 lines new file, -161 lines main, commit: 00cf02d5)  
  æå–è¯„è®ºèŠ‚ç‚¹æ¸²æŸ“é€»è¾‘ï¼Œæ”¯æŒåµŒå¥—å›å¤ã€ç¼–è¾‘ã€åˆ é™¤ç­‰åŠŸèƒ½
- [x] 2024-01-XX: æå– `BatchToolbar` ç»„ä»¶ (+101 lines new file, -99 lines main, commit: fb6d236f)  
  æå–æ‰¹é‡æ“ä½œå·¥å…·æ ï¼ŒåŒ…å«å…¨é€‰å¼€å…³å’Œæ‰¹é‡å…±äº«/å–æ¶ˆå…±äº«æŒ‰é’®
- [x] 2024-01-XX: æå– `MemberSelectionDialog` ç»„ä»¶ (+173 lines new file, -95 lines main, commit: 32658dce)  
  æå–æˆå‘˜é€‰æ‹©å¯¹è¯æ¡†ï¼Œç”¨äºé€‰æ‹©è¦æ˜¾ç¤ºæ ‡æ³¨çš„ä¼šè¯æˆå‘˜
- [x] 2024-01-XX: æå– `CommentActions` å·¥å…· (+192 lines new file, -74 lines main, commit: 16270491)  
  æå–è¯„è®ºå›å¤æ¡†å’Œç¼–è¾‘æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
- [x] 2024-01-XX: æå– `ToolbarHelpers` å·¥å…· (+76 lines new file, -26 lines main, commit: baab28a4)  
  ç»Ÿä¸€å·¥å…·æ å®¹å™¨å’Œæ ‡ç­¾åˆ›å»ºï¼Œç”¨äºæ‰¹é‡æ˜¾ç¤ºå·¥å…·æ å’Œå…±äº«æ ‡æ³¨å·¥å…·æ 
- [x] 2024-01-XX: æå– `EmptyState` ç»„ä»¶ (+48 lines new file, -27 lines main, commit: 95d1adec)  
  ç»Ÿä¸€ç©ºçŠ¶æ€ã€é”™è¯¯çŠ¶æ€ã€è­¦å‘ŠçŠ¶æ€çš„æ˜¾ç¤ºï¼Œæ›¿æ¢äº†6å¤„ç¡¬ç¼–ç HTML

**ç´¯è®¡ä¼˜åŒ–Phase 2-10**: -1264 lines (-40.4%, 3131â†’1867, sessionAnnotationsView.tså®é™…2082è¡Œ)

**Phase 11-12ç»§ç»­ä¼˜åŒ–** (2025-11-12):
- [x] 2025-11-12: æå– `SearchStats` ç»„ä»¶ (+29 lines new file, -7 lines main, commit: 39245379)  
  ç»Ÿä¸€æœç´¢ç»“æœç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
- [x] 2025-11-12: æå– `AnnotationMeta` ç»„ä»¶ (+46 lines new file, -20 lines main, commit: 39245379)  
  ç»Ÿä¸€æ ‡æ³¨å…ƒæ•°æ®æ˜¾ç¤º(ç±»å‹ã€é¡µç ã€æ—¶é—´)
- [x] 2025-11-12: æå– `StatusSection` ç»„ä»¶ (+49 lines new file, -11 lines main, commit: 39245379)  
  ç»Ÿä¸€çŠ¶æ€ä¿¡æ¯æ æ˜¾ç¤º
- [x] 2025-11-12: æå– `AnnotationContent` ç»„ä»¶ (+46 lines new file, -18 lines main, commit: 73842832)  
  ç»Ÿä¸€æ ‡æ³¨å†…å®¹æ˜¾ç¤º(æ–‡æœ¬+è¯„è®º+é¢œè‰²èƒŒæ™¯)
- [x] 2025-11-12: æå– `Modal` ç»„ä»¶ (+80 lines new file, -30 lines main, commit: 73842832)  
  ç»Ÿä¸€æ¨¡æ€å¼¹çª—ç»“æ„(overlay+popup)

**Phase 13ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `CommentInputArea` ç»„ä»¶ (+96 lines new file, -47 lines main, commit: 22e7ac96)  
  è¯„è®ºè¾“å…¥åŒºåŸŸ(textarea+åŒ¿åå¼€å…³+æäº¤æŒ‰é’®),å°è£…æäº¤é€»è¾‘å’Œè¡¨å•é‡ç½®

**Phase 14ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `annotationSorter` å·¥å…· (+30 lines new file, -13 lines main, commit: 0735d9c6)  
  ç»Ÿä¸€æ ‡æ³¨æ’åºé€»è¾‘(æŒ‰é¡µç /æ—¶é—´å‡åº/æ—¶é—´é™åº),æ›¿æ¢StatusSectionç»„ä»¶(-4 lines)

**Phase 15ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `ActionButton` ç»„ä»¶ (+72 lines new file, -52 lines main, commit: 8dec856f)  
  é€šç”¨å¤§å‹æ“ä½œæŒ‰é’®(å¸¦hoveræ•ˆæœ),æ›¿æ¢showManageAnnotationPopupä¸­çš„å…±äº«æŒ‰é’®å’ŒåŒ¿åæŒ‰é’®åˆ›å»ºé€»è¾‘

**Phase 16ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `cardHighlighter` å·¥å…· (+81 lines new file, -29 lines main, commit: a18d6295)  
  å¡ç‰‡é«˜äº®åŠ¨ç”»å·¥å…·,æ”¯æŒè‡ªå®šä¹‰æŒç»­æ—¶é—´ã€æ¸å˜è‰²ã€ç¼©æ”¾ã€é˜´å½±,å¯å¤ç”¨äºå…¶ä»–è§†å›¾

**Phase 17ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `annotationDeduplicator` å·¥å…· (+28 lines new file, -8 lines main, commit: e1e27177)  
  æ ‡æ³¨å»é‡å·¥å…·,åŸºäºzotero_keyæˆ–idå»é™¤é‡å¤æ ‡æ³¨

**Phase 18ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `pdfOpener` å·¥å…· (+57 lines new file, -23 lines main, commit: e10feac0)  
  PDFé˜…è¯»å™¨æ‰“å¼€å·¥å…·,æ”¯æŒé¡µé¢å®šä½,å…¼å®¹Zotero 7+å’Œæ—§ç‰ˆAPI

**Phase 19ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `batchShareConfirmation` å·¥å…· (+59 lines new file, -25 lines main, commit: 2357d6b5)  
  æ‰¹é‡å–æ¶ˆå…±äº«ç¡®è®¤å¯¹è¯æ¡†é€»è¾‘,ç»Ÿè®¡ç‚¹èµ/è¯„è®ºæ•°å¹¶æç¤ºç”¨æˆ·

**Phase 20ç»§ç»­ä¼˜åŒ–** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `batchShareToSession` å·¥å…· (+55 lines new file, -19 lines main, commit: cdd92ae7)  
  æ‰¹é‡å…±äº«åˆ°Sessioné€»è¾‘,è¿‡æ»¤æœ‰æ•ˆæ ‡æ³¨å¹¶è°ƒç”¨API

**ç´¯è®¡ä¼˜åŒ–Phase 2-20**: -1351 lines (-43.1%, 3131â†’1780)

**Phase 21ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `pdfPageContainerFinder` å·¥å…· (+49 lines new file, -38 lines main, commit: c571cbff)  
  ä» createHTMLAnnotationOverlay (26â†’3è¡Œ) å’Œ createAnnotationOverlay (22â†’1è¡Œ) æå–é¡µé¢å®¹å™¨æŸ¥æ‰¾é€»è¾‘ï¼Œç»Ÿä¸€ä½¿ç”¨å¤šé€‰æ‹©å™¨ç­–ç•¥

**Phase 22ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `overlayLayerManager` å·¥å…· (+54 lines new file, -19 lines main, commit: f46c94d3)  
  ä» createHTMLAnnotationOverlay (23â†’2è¡Œ) æå–overlayå±‚åˆ›å»ºå’Œå®šä½ç®¡ç†ï¼ŒåŒ…å«getOrCreateOverlayLayerå’ŒensureRelativePositionä¸¤ä¸ªå‡½æ•°

**Phase 23ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `pageDimensionsCalculator` å·¥å…· (+103 lines new file, -41 lines main, commit: a2d9cc4d)  
  ä» createHTMLAnnotationOverlay (51â†’10è¡Œ) æå–PDFé¡µé¢å°ºå¯¸è®¡ç®—å’Œç¼©æ”¾æ¯”ä¾‹é€»è¾‘ï¼Œæ”¯æŒ3ç§å°ºå¯¸æ¥æº(PDFViewerApplication/Canvas/Fallback)

**Phase 24ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `overlayElementCreator` å·¥å…· (+98 lines new file, -37 lines main, commit: 5c60a869)  
  ä» createHTMLAnnotationOverlay (60â†’23è¡Œ) æå–overlayå…ƒç´ åˆ›å»ºé€»è¾‘ï¼Œå°è£…åæ ‡è½¬æ¢ã€æ ·å¼è®¾ç½®ã€äº‹ä»¶ç›‘å¬

**Phase 25ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `domHelper` å·¥å…· (+48 lines new file, -5 lines main, commit: f1160d36)  
  åˆ›å»ºcreateDivå’ŒcreateTextDivè¾…åŠ©å‡½æ•°ï¼Œç®€åŒ–createElementNSè°ƒç”¨ï¼Œæ›¿æ¢4å¤„ä½¿ç”¨

**Phase 26å¼€å§‹ä¼˜åŒ–ui-manager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `sectionTitleCustomizer` å·¥å…· (+124 lines new file, -101 lines main, commit: ab809079)  
  ä» registerItemPaneSection æ–¹æ³•æå–sectionæ ‡é¢˜æ è‡ªå®šä¹‰é€»è¾‘ï¼Œå°è£…ç‰ˆæœ¬å·ã€å®˜ç½‘æŒ‰é’®å’ŒMutationObserver

**Phase 27ç»§ç»­ä¼˜åŒ–ui-manager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `FeatureDisabledView` ç»„ä»¶ (+63 lines new file, -49 lines main, commit: 17379a2e)  
  ä» showFeatureDisabledView æ–¹æ³•æå–åŠŸèƒ½ç¦ç”¨UIæ¸²æŸ“é€»è¾‘ï¼Œå°è£…æ¸å˜èƒŒæ™¯ã€é”å›¾æ ‡ã€æ›´æ–°æŒ‰é’®åŠäº¤äº’

**Phase 28ç»§ç»­ä¼˜åŒ–ui-manager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `featurePermissionChecker` å·¥å…· (+96 lines new file, -48 lines main, commit: 408ff1f2)  
  ä» handleButtonClick æ–¹æ³•æå–æƒé™æ£€æŸ¥é€»è¾‘(åŠŸèƒ½ç¦ç”¨/ç™»å½•çŠ¶æ€/Itemå­˜åœ¨æ€§/è®ºæ–‡æ³¨å†Œ)ï¼Œç»Ÿä¸€æƒé™æ£€æŸ¥æ¥å£

**Phase 29ç»§ç»­ä¼˜åŒ–ui-manager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `panelDocumentFinder` å·¥å…· (+86 lines new file, -28 lines main, commit: 6ab1a104)  
  ä» handleButtonClick æ–¹æ³•æå–é¢æ¿æ–‡æ¡£æŸ¥æ‰¾é€»è¾‘(ä»originElement/ç¼“å­˜/panelDocumentæŸ¥æ‰¾)ï¼Œå°è£…éªŒè¯é€»è¾‘

**Phase 30ç»§ç»­ä¼˜åŒ–ui-manager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `contentRenderer` å·¥å…· (+121 lines new file, -77 lines main, commit: 3541325a)  
  ä» handleButtonClick æ–¹æ³•æå–å†…å®¹æ¸²æŸ“é€»è¾‘(loading/error/item-changedæ¶ˆæ¯ã€é¢æ¿å¯è§æ€§ã€è§†å›¾è·¯ç”±)ï¼Œç»Ÿä¸€æ¸²æŸ“æµç¨‹

**Phase 31ç»§ç»­ä¼˜åŒ–ui-manager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `paperInfoUpdater` å·¥å…· (+123 lines new file, -87 lines main, commit: 09549245)  
  ä» updatePaperInfo æ–¹æ³•æå–é¢æ¿æ›´æ–°é€»è¾‘(æ ‡é¢˜/ä½œè€…/å¹´ä»½/æœŸåˆŠ/DOIæ˜¾ç¤º)ï¼Œå°è£…å•é¢æ¿å’Œæ‰¹é‡æ›´æ–°

**Phase 32ç»§ç»­ä¼˜åŒ–ui-manager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: æå– `WelcomeView` ç»„ä»¶ (+112 lines new file, -82 lines main, commit: 41f6e654)  
  ä» handleItemChange æ–¹æ³•æå–æ¬¢è¿è§†å›¾(åŠŸèƒ½ä»‹ç»å¡ç‰‡)ï¼Œå°è£…åŠŸèƒ½åˆ—è¡¨å’Œhoveräº¤äº’

**Phase 33å¼€å§‹ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: åˆ›å»º `AnnotationCommentPopup` ç»„ä»¶ (+179 lines new file, commit: 17492ef6)  
  ä¸ºshowAnnotationCommentsæ–¹æ³•å‡†å¤‡å·¥å…·å‡½æ•°(å¼¹çª—åˆ›å»º/å†…å®¹æ·»åŠ /ä½ç½®è®¡ç®—)ï¼Œä¸‹ä¸€é˜¶æ®µè¿›è¡Œé›†æˆ

**Phase 34ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12ä¸‹åˆ):
- [x] 2025-11-12: é‡æ„ `showAnnotationComments` æ–¹æ³• (-90 lines main, commit: fbca28f1)  
  ä½¿ç”¨AnnotationCommentPopupç»„ä»¶å·¥å…·å‡½æ•°ï¼Œæ›¿æ¢æ‰‹åŠ¨DOMåˆ›å»ºå’Œinlineæ ·å¼ï¼Œç§»é™¤é‡å¤çš„countAllCommentså‡½æ•°

**Phase 35ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `nativeAnnotationToggler` å·¥å…· (+148 lines new file, commit: c17c2838)  
  æå–getReaderManagersã€extractNativeAnnotationsã€removeNativeAnnotationsã€hideAnnotationsã€showAnnotationsã€triggerRenderå…­å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `toggleNativeAnnotations` æ–¹æ³• (-102 lines main, -66.7%)  
  153è¡Œç®€åŒ–ä¸º51è¡Œï¼Œåˆ†ç¦»çŠ¶æ€ç®¡ç†ä¸æ“ä½œæ‰§è¡Œé€»è¾‘

**Phase 36ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `readerFinder` å·¥å…· (+166 lines new file, commit: e3a69f36)  
  æå–normalizeDOIã€getReadersViaAPIã€getReadersFromWindowsã€extractTabsFromWindowã€findReaderForTabã€isReaderMatchingDOIå…­å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `findOpenReader` æ–¹æ³• (-128 lines main, -97.6%)  
  131è¡Œç®€åŒ–ä¸º3è¡Œï¼Œå®Œå…¨å§”æ‰˜ç»™å·¥å…·å‡½æ•°

**Phase 37ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `annotationNavigator` å·¥å…· (+91 lines new file, commit: a5f78fa4)  
  æå–navigateToAnnotationã€waitForPageReadyã€getAnnotationDisplayNameä¸‰å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„å¯¼èˆªå’Œåç§°è·å–é€»è¾‘ (-85 lines main)  
  highlightAnnotationå¯¼èˆªä»£ç 48â†’5è¡Œï¼Œåˆ é™¤waitForPageReadyå’ŒgetAnnotationDisplayNameæ–¹æ³•

**Phase 38ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `overlayMonitor` å·¥å…· (+133 lines new file, commit: 52316af8)  
  æå–ResizeDebounceManagerã€OverlayResizeObserverä¸¤ä¸ªç±»å’ŒstartPeriodicCheckå‡½æ•°
- [x] 2025-11-12: é‡æ„overlayç›‘å¬é€»è¾‘ (-67 lines main)  
  createHTMLAnnotationOverlay: ResizeObserverä»£ç 68â†’28è¡Œï¼Œç®€åŒ–scheduleOverlayUpdateå’ŒclearHighlight

**Phase 39ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `overlayCreator` å·¥å…· (+122 lines new file, commit: 16d46d36)  
  æå–calculateScaleFactorsã€createAuthorLabelã€createOverlaysForAnnotationä¸‰å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `recreateOverlayElements` æ–¹æ³• (-97 lines, -88.2%)  
  110è¡Œç®€åŒ–ä¸º13è¡Œï¼Œå®Œå…¨ä½¿ç”¨overlayCreatorå·¥å…·å‡½æ•°

**Phase 40ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `overlayUpdater` å·¥å…· (+114 lines new file, commit: bd0f01d1)  
  æå–getOverlaysForPageã€calculateOverlayPositionã€updateOverlayElementPositionã€updateAuthorLabelPositionã€updateAnnotationOverlaysäº”å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `updateOverlaysForPage` æ–¹æ³• (-77 lines, -63.6%)  
  121è¡Œç®€åŒ–ä¸º44è¡Œï¼Œå¤ç”¨calculatePageDimensionså·¥å…·

**Phase 41ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `pageDimensionRetriever` å·¥å…· (+118 lines new file, commit: c6175210)  
  æå–getPDFViewerApplicationã€extractDimensionsFromViewportã€getPageDimensionsFromPDFä¸‰å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `getPageDimensionsFromPDF` æ–¹æ³• (-125 lines, -96.9%)  
  129è¡Œç®€åŒ–ä¸º4è¡Œï¼Œå®Œå…¨å§”æ‰˜ç»™å·¥å…·å‡½æ•°

**Phase 42ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `htmlOverlayLifecycle` å·¥å…· (+197 lines new file, commit: 13f951af)  
  æå–validateReaderComponentsã€preparePageContainerã€clearOldOverlaysã€logPageContainerInfoã€validateCanvasã€verifyOverlayElementsã€storeActiveHighlightä¸ƒå¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `createHTMLAnnotationOverlay` éªŒè¯å’Œå‡†å¤‡é€»è¾‘ (-77 lines)  
  Setup/validation ~100è¡Œç®€åŒ–ä¸º~25è¡Œ

**Phase 43ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `overlayCreationLoop` å·¥å…· (+115 lines new file, commit: e403429a)  
  æå–createOverlayElementsForRectså‡½æ•°(å¾ªç¯åˆ›å»ºrect overlay + author label)
- [x] 2025-11-12: åˆ›å»º `overlayMonitoringSetup` å·¥å…· (+75 lines new file, commit: e403429a)  
  æå–setupOverlayMonitoringå‡½æ•°(ResizeObserver + periodic checké…ç½®)
- [x] 2025-11-12: é‡æ„ `createHTMLAnnotationOverlay` å¾ªç¯å’Œç›‘å¬é€»è¾‘ (-87 lines)  
  Loop ~65â†’~15è¡Œ, Monitoring ~60â†’~20è¡Œ

**Phase 44ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `commentPopupManager` å·¥å…· (+139 lines new file, commit: afb99e6d)  
  æå–createPositionedPopupã€fillBasicPopupContentã€loadAndFillInteractionDataã€setupPopupLifecycleå››å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `showAnnotationComments` æ–¹æ³• (-33 lines, -50%)  
  100è¡Œç®€åŒ–ä¸º~50è¡Œï¼Œä½¿ç”¨å·¥å…·å‡½æ•°ç®¡ç†å¼¹çª—ç”Ÿå‘½å‘¨æœŸ

**Phase 45ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `svgOverlayCreator` å·¥å…· (+147 lines new file, commit: 2bab3497)  
  æå–calculateSVGCoordinatesã€createSVGContainerã€createSVGContentã€attachSVGInteractionEventsã€getCanvasDimensionsäº”å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `createSVGOverlay` æ–¹æ³• (-51 lines, -65%)  
  101è¡Œç®€åŒ–ä¸º~35è¡Œï¼Œå®Œå…¨ä½¿ç”¨SVGåˆ›å»ºå·¥å…·

**Phase 46ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: æ‰©å±• `svgOverlayCreator` å·¥å…· (+89 lines, commit: 9f7ebda3)  
  æ–°å¢createStyledSVGRectã€addPulseAnimationã€attachHighlightInteractionEventsã€calculateSVGCoordinatesFromViewportå››ä¸ªå‡½æ•°
- [x] 2025-11-12: é‡æ„ `createHighlightOverlay` æ–¹æ³• (-48 lines, -64%)  
  96è¡Œç®€åŒ–ä¸º~35è¡Œï¼Œå¤ç”¨Phase 45çš„SVGå·¥å…·å‡½æ•°

**Phase 47ç»§ç»­ä¼˜åŒ–pdfReaderManager.ts** (2025-11-12æ™š):
- [x] 2025-11-12: åˆ›å»º `commentListRenderer` å·¥å…· (+147 lines new file, commit: 0ce9ad30)  
  æå–createCommentDivã€formatCommentTimestampã€createCommentHeaderã€createCommentContentã€getChildCommentsã€renderCommentTreeå…­å¤§å‡½æ•°
- [x] 2025-11-12: é‡æ„ `renderCommentList` æ–¹æ³• (-51 lines, -92.7%)  
  55è¡Œç®€åŒ–ä¸º4è¡Œï¼Œå®Œå…¨å§”æ‰˜ç»™é€’å½’æ¸²æŸ“å·¥å…·

**ç´¯è®¡ä¼˜åŒ–Phase 2-47**: -3031 lines (sessionAnnotationsView: -1351, pdfReaderManager: -1188, ui-manager: -472)

**æœ¬Sessionæ€»ç»“ (Phase 11-47)**:
- âœ… å®Œæˆ37ä¸ªPhase (Phase 11-20: sessionAnnotationsViewä¼˜åŒ–, Phase 21-25+33-47: pdfReaderManagerä¼˜åŒ–, Phase 26-32: ui-managerä¼˜åŒ–)
- âœ… sessionAnnotationsView: 2082 â†’ 1780 è¡Œ (-302, -14.5%)
- âœ… pdfReaderManager: 2761 â†’ 1573 è¡Œ (-1188, -43.0%) ğŸ”¥
- âœ… ui-manager: 1626 â†’ 1154 è¡Œ (-472, -29.0%)
- âœ… æ–°å¢ç»„ä»¶/å·¥å…·: 38ä¸ªæ–‡ä»¶ (+4999è¡Œ)
- âœ… ç´¯è®¡ä¸»æ–‡ä»¶å‡å°‘: -3031 è¡Œ (7599 â†’ 4568)
- âœ… ç¼–è¯‘æˆåŠŸç‡: 100% (37/37)
- âœ… ç”¨æˆ·ç¡®è®¤: å…¨éƒ¨é€šè¿‡

**ä¸‹ä¸€æ­¥**: 
- pdfReaderManager.ts: ç›®æ ‡ <1200 lines è¿˜éœ€ -373 lines (-23.7%)ï¼Œå·²å®Œæˆ80.9%ç›®æ ‡ğŸ”¥ğŸ”¥ğŸ”¥
- ui-manager.ts: ç›®æ ‡ <800 lines è¿˜éœ€ -354 lines (-30.7%)
- sessionAnnotationsView.ts: ç›®æ ‡ <800 lines è¿˜éœ€ -980 lines (-55.1%)
- ä¼˜åŒ–ç­–ç•¥: pdfReaderManagerè¿›å±•æå¥½ï¼ˆ80.9%å®Œæˆï¼‰ï¼Œåªéœ€å†å‡å°‘373è¡Œå³å¯è¾¾æ ‡ï¼ç»§ç»­ä¼˜åŒ–å‰©ä½™æ–¹æ³•

---

#### âœ… Task 2.1: æå–è¯„è®ºç³»ç»Ÿ
**åˆ›å»º**: `src/modules/core/annotations/commentManager.ts`

```typescript
export class CommentManager {
  constructor(private apiClient: APIClient) {}
  
  async fetchComments(annotationId: string): Promise<Comment[]>;
  async addComment(annotationId: string, text: string): Promise<Comment>;
  async updateComment(commentId: string, text: string): Promise<void>;
  async deleteComment(commentId: string): Promise<void>;
  async addReply(commentId: string, text: string): Promise<Comment>;
}
```

**åˆ›å»º**: `src/modules/ui/views/annotations/CommentSectionView.ts`

```typescript
export class CommentSectionView {
  constructor(
    private commentManager: CommentManager,
    private context: BaseViewContext
  ) {}
  
  async render(container: HTMLElement, annotationId: string): Promise<void>;
  async refresh(): Promise<void>;
  destroy(): void;
}
```

**é¢„æœŸå‡å°‘**: ~500 è¡Œ

---

#### âœ… Task 2.2: æå–ç‚¹èµåŠŸèƒ½
**åˆ›å»º**: `src/modules/core/annotations/likeManager.ts`

```typescript
export class LikeManager {
  constructor(private apiClient: APIClient) {}
  
  async toggleLike(annotationId: string): Promise<{ liked: boolean; count: number }>;
  async getLikeStatus(annotationIds: string[]): Promise<Map<string, boolean>>;
  async getLikeCounts(annotationIds: string[]): Promise<Map<string, number>>;
}
```

**é›†æˆåˆ°**: `AnnotationCardView`

**é¢„æœŸå‡å°‘**: ~150 è¡Œ

---

#### âœ… Task 2.3: æå–ç­›é€‰/æ’åºå·¥å…·æ 
**åˆ›å»º**: `src/modules/ui/views/annotations/FilterToolbarView.ts`

```typescript
export interface FilterConfig {
  filterTypes: Array<{ value: string; label: string }>;
  sortTypes: Array<{ value: string; label: string }>;
  onFilterChange: (filter: string) => void;
  onSortChange: (sort: string) => void;
}

export class FilterToolbarView {
  render(container: HTMLElement, config: FilterConfig): HTMLElement;
}
```

**é¢„æœŸå‡å°‘**: ~200 è¡Œ

---

#### âœ… Task 2.4: æå–æ ‡æ³¨å¡ç‰‡ç»„ä»¶
**åˆ›å»º**: `src/modules/ui/components/cards/AnnotationCard.ts`

```typescript
export interface AnnotationCardConfig {
  annotation: any;
  showActions?: boolean;
  showComments?: boolean;
  currentUserId?: string;
  onLocate?: (annotation: any) => void;
  onLike?: (annotation: any) => void;
  onComment?: (annotation: any) => void;
  onDelete?: (annotation: any) => void;
}

export function createAnnotationCard(
  doc: Document,
  config: AnnotationCardConfig
): HTMLElement;
```

**é¢„æœŸå‡å°‘**: ~300 è¡Œ

---

#### âœ… Task 2.5: æå–æ ‡æ³¨åˆ—è¡¨è§†å›¾
**åˆ›å»º**: `src/modules/ui/views/annotations/AnnotationListView.ts`

```typescript
export class AnnotationListView {
  constructor(
    private annotationManager: AnnotationManager,
    private context: BaseViewContext
  ) {}
  
  async render(
    container: HTMLElement,
    config: {
      annotations: any[];
      showActions?: boolean;
      emptyMessage?: string;
    }
  ): Promise<void>;
  
  async refresh(): Promise<void>;
}
```

**é¢„æœŸå‡å°‘**: ~400 è¡Œ

---

#### âœ… Task 2.6: é‡æ„ä¸»æ–‡ä»¶
**ä¿®æ”¹**: `src/modules/ui/sessionAnnotationsView.ts`

```typescript
export class SessionAnnotationsView {
  private annotationListView: AnnotationListView;
  private commentSectionView: CommentSectionView;
  private filterToolbarView: FilterToolbarView;
  
  constructor(
    private sessionManager: ReadingSessionManager,
    private context: BaseViewContext
  ) {
    this.annotationListView = new AnnotationListView(...);
    this.commentSectionView = new CommentSectionView(...);
    this.filterToolbarView = new FilterToolbarView();
  }
  
  async render(container: HTMLElement): Promise<void> {
    // åªè´Ÿè´£ç»„åˆå­è§†å›¾
  }
}
```

**ç›®æ ‡è¡Œæ•°**: <800 è¡Œ (ä» 3131 è¡Œå‡å°‘ ~2300 è¡Œ)

---

#### ğŸ”§ **æµ‹è¯•ç‚¹ 2.1-2.6**
- [ ] æ ‡æ³¨åˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸
- [ ] ç­›é€‰/æ’åºåŠŸèƒ½æ­£å¸¸
- [ ] ç‚¹èµåŠŸèƒ½æ­£å¸¸
- [ ] è¯„è®ºç³»ç»Ÿæ­£å¸¸ (æŸ¥çœ‹/æ·»åŠ /åˆ é™¤)
- [ ] å®šä½åˆ° PDF åŠŸèƒ½æ­£å¸¸
- [ ] æ‰¹é‡ç®¡ç†åŠŸèƒ½æ­£å¸¸

---

## Phase 3: é‡æ„ pdfReaderManager.ts (ç¬¬6-8å¤©)

### å½“å‰çŠ¶æ€
- **2760 è¡Œ** - ğŸ”´ ä¸¥é‡è¶…æ ‡
- **40+ æ–¹æ³•**
- æ··åˆåŠŸèƒ½: Reader ç›‘å¬ã€Overlay æ¸²æŸ“ã€ç¼©æ”¾é€‚é…ã€äº‹ä»¶å¤„ç†

### é‡æ„ç­–ç•¥
æ‹†åˆ†ä¸º **4 ä¸ªç‹¬ç«‹æ¨¡å—**ï¼ŒæŒ‰èŒè´£åˆ†ç¦»

---

#### âœ… Task 3.1: æå– Reader ç›‘å¬å™¨
**åˆ›å»º**: `src/modules/pdf/readerListener.ts`

```typescript
export class ReaderListener {
  private readerEventListeners = new Map<any, Function[]>();
  
  registerReader(reader: any): void;
  unregisterReader(reader: any): void;
  getActiveReaders(): any[];
  onReaderOpen(callback: (reader: any) => void): void;
  onReaderClose(callback: (reader: any) => void): void;
}
```

**é¢„æœŸå‡å°‘**: ~400 è¡Œ

---

#### âœ… Task 3.2: æå– Overlay æ¸²æŸ“å™¨
**åˆ›å»º**: `src/modules/pdf/overlayRenderer.ts`

```typescript
export interface OverlayConfig {
  annotation: SharedAnnotation;
  color: string;
  opacity?: number;
  showLabel?: boolean;
}

export class OverlayRenderer {
  private overlayData = new Map<string, OverlayData>();
  
  addOverlay(reader: any, config: OverlayConfig): string;
  removeOverlay(overlayId: string): void;
  updateOverlay(overlayId: string, config: Partial<OverlayConfig>): void;
  clearAllOverlays(): void;
}
```

**é¢„æœŸå‡å°‘**: ~600 è¡Œ

---

#### âœ… Task 3.3: æå–ç¼©æ”¾é€‚é…å™¨
**åˆ›å»º**: `src/modules/pdf/zoomAdapter.ts`

```typescript
export class ZoomAdapter {
  private resizeObservers = new Map<HTMLElement, ResizeObserver>();
  private lastUpdateTime = new Map<HTMLElement, number>();
  
  observeZoom(
    pageContainer: HTMLElement,
    onZoom: (scale: number) => void
  ): void;
  
  stopObserving(pageContainer: HTMLElement): void;
  getCurrentScale(reader: any): number;
}
```

**é¢„æœŸå‡å°‘**: ~300 è¡Œ

---

#### âœ… Task 3.4: æå– PDF å·¥å…·å‡½æ•°
**åˆ›å»º**: `src/modules/pdf/pdfUtils.ts`

```typescript
export function getPDFPage(reader: any, pageIndex: number): HTMLElement | null;
export function scrollToPage(reader: any, pageIndex: number): void;
export function pdfToViewport(
  pdfCoords: number[],
  pdfSize: { width: number; height: number },
  viewportSize: { width: number; height: number }
): number[];
export function viewportToPDF(
  viewportCoords: number[],
  pdfSize: { width: number; height: number },
  viewportSize: { width: number; height: number }
): number[];
```

**é¢„æœŸå‡å°‘**: ~200 è¡Œ

---

#### âœ… Task 3.5: é‡æ„ä¸»æ–‡ä»¶
**ä¿®æ”¹**: `src/modules/pdfReaderManager.ts`

```typescript
export class PDFReaderManager {
  private readerListener: ReaderListener;
  private overlayRenderer: OverlayRenderer;
  private zoomAdapter: ZoomAdapter;
  
  constructor() {
    this.readerListener = new ReaderListener();
    this.overlayRenderer = new OverlayRenderer();
    this.zoomAdapter = new ZoomAdapter();
  }
  
  async initialize(): Promise<void> {
    // ç»„åˆå­æ¨¡å—åŠŸèƒ½
  }
  
  async highlightAnnotations(reader: any, annotations: SharedAnnotation[]): Promise<void> {
    // å§”æ‰˜ç»™ overlayRenderer
  }
}
```

**ç›®æ ‡è¡Œæ•°**: <1200 è¡Œ (ä» 2760 è¡Œå‡å°‘ ~1500 è¡Œ)

---

#### ğŸ”§ **æµ‹è¯•ç‚¹ 3.1-3.5**
- [ ] PDF æ‰“å¼€æ—¶è‡ªåŠ¨æ˜¾ç¤º Overlay
- [ ] ç¼©æ”¾æ—¶ Overlay æ­£å¸¸é€‚é…
- [ ] ç‚¹å‡» Overlay è·³è½¬åˆ°æ ‡æ³¨å¡ç‰‡
- [ ] éšè—/æ˜¾ç¤ºåŸç”Ÿæ ‡æ³¨åŠŸèƒ½æ­£å¸¸
- [ ] å¤šä¸ª Reader åŒæ—¶æ‰“å¼€æ— å†²çª

---

## Phase 4: é‡æ„ ui-manager.ts (ç¬¬9-10å¤©)

### å½“å‰çŠ¶æ€
- **1626 è¡Œ** - ğŸŸ¡ éœ€è¦ä¼˜åŒ–
- æ‰¿æ‹…äº†è¿‡å¤š UI æ¸²æŸ“é€»è¾‘

### é‡æ„ç­–ç•¥
å°† UI æ¸²æŸ“é€»è¾‘ä¸‹æ”¾åˆ°å„ä¸ª Viewï¼Œui-manager åªè´Ÿè´£åè°ƒ

---

#### âœ… Task 4.1: ä¸‹æ”¾é¢æ¿åˆå§‹åŒ–é€»è¾‘
**ä¿®æ”¹**: å°† `createPanelElements` ç­‰æ–¹æ³•ç§»åˆ° `components/panels/`

**åˆ›å»º**: `src/modules/ui/components/panels/PanelBuilder.ts`

```typescript
export class PanelBuilder {
  static createResearchopiaPanel(doc: Document): HTMLElement;
  static createPaperInfoSection(doc: Document): HTMLElement;
  static createButtonsSection(doc: Document): HTMLElement;
  static createContentSection(doc: Document): HTMLElement;
}
```

**é¢„æœŸå‡å°‘**: ~300 è¡Œ

---

#### âœ… Task 4.2: ä¸‹æ”¾æŒ‰é’®äº‹ä»¶å¤„ç†
**ä¿®æ”¹**: å°†æŒ‰é’®ç‚¹å‡»é€»è¾‘ç§»åˆ°å¯¹åº”çš„ View

**ç¤ºä¾‹**: 
- "æˆ‘çš„æ ‡æ³¨"æŒ‰é’® â†’ `MyAnnotationsView.handleOpen()`
- "è®ºæ–‡è¯„ä»·"æŒ‰é’® â†’ `PaperEvaluationView.handleOpen()`
- "å…±è¯»ä¼šè¯"æŒ‰é’® â†’ `ReadingSessionView.handleOpen()`

**é¢„æœŸå‡å°‘**: ~200 è¡Œ

---

#### âœ… Task 4.3: ç®€åŒ–æ¶ˆæ¯ç³»ç»Ÿ
**åˆ›å»º**: `src/modules/ui/shared/messageManager.ts`

```typescript
export class MessageManager {
  showInfo(message: string): void;
  showSuccess(message: string): void;
  showWarning(message: string): void;
  showError(message: string): void;
}
```

**é¢„æœŸå‡å°‘**: ~100 è¡Œ

---

#### ğŸ”§ **æµ‹è¯•ç‚¹ 4.1-4.3**
- [ ] Item Pane é¢æ¿æ­£å¸¸æ˜¾ç¤º
- [ ] åˆ‡æ¢ä¸åŒåŠŸèƒ½æŒ‰é’®æ­£å¸¸
- [ ] æ¶ˆæ¯æç¤ºæ­£å¸¸æ˜¾ç¤º
- [ ] æ— åŠŸèƒ½å›å½’

---

## Phase 5: é‡æ„å…¶ä»–è§†å›¾ (ç¬¬11-14å¤©)

### Task 5.1: paperEvaluationView.ts (1061è¡Œ â†’ <600è¡Œ)
- æå–è¯„åˆ†ç»„ä»¶
- æå–è¯„è®ºåˆ—è¡¨
- æå–è¡¨å•éªŒè¯

### Task 5.2: quickSearchView.ts (954è¡Œ â†’ <600è¡Œ)
- æå–æœç´¢ç»“æœåˆ—è¡¨
- æå–ç­›é€‰å™¨
- æå–åˆ†é¡µç»„ä»¶

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•æ—¶æœº
æ¯å®Œæˆä¸€ä¸ª Phaseï¼Œç«‹å³æµ‹è¯•

### æµ‹è¯•æ¸…å•

#### âœ… ç¼–è¯‘æµ‹è¯•
```powershell
cd d:\AI\Researchopia\zotero-plugin
npm run build
```

#### âœ… åŠŸèƒ½æµ‹è¯•
1. **åŸºç¡€åŠŸèƒ½**
   - [ ] æ’ä»¶åŠ è½½æˆåŠŸ
   - [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
   - [ ] Item Pane é¢æ¿æ˜¾ç¤ºæ­£å¸¸

2. **æ ‡æ³¨åŠŸèƒ½**
   - [ ] æˆ‘çš„æ ‡æ³¨åˆ—è¡¨æ˜¾ç¤º
   - [ ] å…±äº«æ ‡æ³¨åˆ—è¡¨æ˜¾ç¤º
   - [ ] æ ‡æ³¨ç‚¹èµåŠŸèƒ½
   - [ ] æ ‡æ³¨è¯„è®ºåŠŸèƒ½
   - [ ] å®šä½åˆ° PDF

3. **ä¼šè¯åŠŸèƒ½**
   - [ ] åˆ›å»ºä¼šè¯
   - [ ] åŠ å…¥ä¼šè¯
   - [ ] ä¼šè¯æ ‡æ³¨åŒæ­¥
   - [ ] ä¼šè¯æˆå‘˜ç®¡ç†

4. **PDF åŠŸèƒ½**
   - [ ] Overlay æ˜¾ç¤º
   - [ ] ç¼©æ”¾é€‚é…
   - [ ] ç‚¹å‡»å®šä½

#### âœ… æ€§èƒ½æµ‹è¯•
- [ ] æ’ä»¶å¯åŠ¨æ—¶é—´ <3ç§’
- [ ] é¢æ¿åˆ‡æ¢å“åº” <500ms
- [ ] æ ‡æ³¨åˆ—è¡¨åŠ è½½ <2ç§’ (100æ¡)

---

## ğŸ“¦ æäº¤ç­–ç•¥

### Commit è§„èŒƒ

```
feat(refactor): [Phase X.Y] ç®€çŸ­æè¿°

è¯¦ç»†è¯´æ˜:
- æå–äº†å“ªäº›æ¨¡å—
- å‡å°‘äº†å¤šå°‘è¡Œä»£ç 
- å½±å“äº†å“ªäº›æ–‡ä»¶

æµ‹è¯•:
- [x] ç¼–è¯‘é€šè¿‡
- [x] åŠŸèƒ½æµ‹è¯•é€šè¿‡
```

### åˆ†æ”¯ç­–ç•¥

```
main (ç¨³å®šç‰ˆæœ¬)
  â†‘
  merge â† refactor/phase-1 (Phase 1 å®Œæˆååˆå¹¶)
           â†‘
           merge â† refactor/phase-2 (Phase 2 å®Œæˆååˆå¹¶)
                    â†‘
                    refactor/phase-3 (å½“å‰å¼€å‘)
```

### æ¯ä¸ª Phase å®Œæˆå
1. æäº¤ä»£ç 
2. æ ‡è®°è¿›åº¦ (æ›´æ–°æœ¬æ–‡æ¡£)
3. ç­‰å¾…æµ‹è¯•åé¦ˆ
4. ä¿®å¤é—®é¢˜ååˆå¹¶

---

## ğŸ“ˆ è¿›åº¦è·Ÿè¸ª

### Phase 1: æå–å…±äº«å·¥å…·å’Œç»„ä»¶ âœ…
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• |
|------|------|---------|------|
| 1.1 æå–æ ¼å¼åŒ–å·¥å…· | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ |
| 1.2 æå– DOM å·¥å…· | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ |
| 1.3 é‡ç»„ UI ç»„ä»¶åº“ | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ |

### Phase 2: é‡æ„ sessionAnnotationsView.ts (3131 â†’ 2000 è¡Œ, -1131 è¡Œ/-36.1%)
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 2.1 æå–è¯„è®ºç³»ç»Ÿ | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ | CommentManager.ts åˆ›å»º |
| 2.2 æå–ç‚¹èµåŠŸèƒ½ | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ | LikeManager.ts åˆ›å»º |
| 2.3 æå–ç­›é€‰å·¥å…·æ  | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ | FilterToolbarView.ts åˆ›å»º |
| 2.4 æå–æ ‡æ³¨å¡ç‰‡ | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ | AnnotationCard.ts åˆ›å»º |
| 2.5 æå–æ ‡æ³¨åˆ—è¡¨ | âœ… å·²å®Œæˆ | 2025-11-11 | âœ… ç¼–è¯‘é€šè¿‡ | AnnotationListView.ts åˆ›å»º |
| 2.6 UI ç»„ä»¶ç»Ÿä¸€åŒ– | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | createSelect(-39), createFilterButton(-36), createSmallButton(-61), createCommentTextarea(-28), OLDå¤‡ä»½åˆ é™¤(-196), æœªä½¿ç”¨æ–¹æ³•åˆ é™¤(-26) |
| 2.7 å¤§ç»„ä»¶æå– | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | CommentNodeç»„ä»¶(+267/-161), ManageAnnotationCardç»„ä»¶(+307/-293), BatchToolbar(+101/-99), MemberSelectionDialog(+173/-95), CommentActions(+192/-74) |
| 2.8 UIå·¥å…·æå– | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | ToolbarHelpers(+76/-26), EmptyState(+48/-27), SearchStats(+29/-7), AnnotationMeta(+46/-20), StatusSection(+49/-11), AnnotationContent(+46/-18), Modal(+80/-30), ActionButton(+72/-52) |
| 2.9 Helperå‡½æ•° | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | createStatusMessage(-12), createSectionHeader(-27), createPopupHeader(-39), annotationSorter(+30/-17), cardHighlighter(+81/-29), annotationDeduplicator(+28/-8), pdfOpener(+57/-23), batchShareConfirmation(+59/-25), batchShareToSession(+55/-19) |

**Phase 2 è¿›åº¦æ€»ç»“ï¼ˆæˆªè‡³ 2025-11-12 ä¸‹åˆï¼‰:**
- âœ… **å·²å®Œæˆ 43.1% çš„ä»£ç å‡å°‘** (3131 â†’ 1780 è¡Œ)
- ğŸ“¦ **æå–æˆæœ**: 14ä¸ªæ–°ç»„ä»¶ + 9ä¸ªå·¥å…·å‡½æ•° (+2066 linesæ–°æ–‡ä»¶)
- ğŸ¯ **ä¸»è¦é‡Œç¨‹ç¢‘**:
  - Phase 2-10: æå–æ ¸å¿ƒç»„ä»¶ (CommentNode, BatchToolbar, MemberSelectionDialog, CommentActions, ToolbarHelpers, EmptyState)
  - Phase 11-12: æå–UIç»†èŠ‚ç»„ä»¶ (SearchStats, AnnotationMeta, StatusSection, AnnotationContent, Modal)
  - Phase 13: æå–è¡¨å•ç»„ä»¶ (CommentInputArea)
  - Phase 14-20: æå–å·¥å…·å‡½æ•° (annotationSorter, cardHighlighter, annotationDeduplicator, pdfOpener, batchShareConfirmation, batchShareToSession)
  - Phase 15: æå–æŒ‰é’®ç»„ä»¶ (ActionButton)
- ğŸ“Š **å‰©ä½™å·¥ä½œ**: è·ç¦» <800 è¡Œç›®æ ‡è¿˜éœ€å‡å°‘ 980 è¡Œ (-55.1%)
- ğŸ”„ **ä¸‹ä¸€æ­¥**: Phase 21+ - è€ƒè™‘æ›´å¤§è§„æ¨¡çš„æ¶æ„è°ƒæ•´ï¼Œå°†renderSharedMode/renderManageModeç­‰å¤§æ–¹æ³•æå–ä¸ºç‹¬ç«‹Viewç±»

### Phase 3: é‡æ„ pdfReaderManager.ts (2761 â†’ 2621, -140 è¡Œ/-5.1%)
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 3.0 Phase 21: æå–PDFé¡µé¢æŸ¥æ‰¾ | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | pdfPageContainerFinder.ts (+49/-38), commit: c571cbff |
| 3.0 Phase 22: æå–Overlayå±‚ç®¡ç† | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | overlayLayerManager.ts (+54/-19), commit: f46c94d3 |
| 3.0 Phase 23: æå–PDFå°ºå¯¸è®¡ç®— | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | pageDimensionsCalculator.ts (+103/-41), commit: a2d9cc4d |
| 3.0 Phase 24: æå–Overlayå…ƒç´ åˆ›å»º | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | overlayElementCreator.ts (+98/-37), commit: 5c60a869 |
| 3.0 Phase 25: æå–DOMè¾…åŠ©å·¥å…· | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | domHelper.ts (+48/-5), commit: f1160d36 |
| 3.1 æå– Reader ç›‘å¬å™¨ | â¬œ æœªå¼€å§‹ | - | - | é¢„è®¡ ~400 è¡Œ |
| 3.2 æå– Overlay æ¸²æŸ“å™¨ | â¬œ æœªå¼€å§‹ | - | - | é¢„è®¡ ~600 è¡Œ |
| 3.3 æå–ç¼©æ”¾é€‚é…å™¨ | â¬œ æœªå¼€å§‹ | - | - | é¢„è®¡ ~200 è¡Œ |
| 3.4 æå– PDF å·¥å…·å‡½æ•° | â¬œ æœªå¼€å§‹ | - | - | é¢„è®¡ ~150 è¡Œ |
| 3.5 é‡æ„ä¸»æ–‡ä»¶ | â¬œ æœªå¼€å§‹ | - | - | ç›®æ ‡ <1200 è¡Œ |

### Phase 4: é‡æ„ ui-manager.ts (1626 â†’ 1525, -101 è¡Œ/-6.2%)
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 4.0 Phase 26: æå–æ ‡é¢˜æ è‡ªå®šä¹‰ | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | sectionTitleCustomizer.ts (+124/-101), commit: ab809079 |
| 4.1 ä¸‹æ”¾é¢æ¿åˆå§‹åŒ– | â¬œ æœªå¼€å§‹ | - | - | é¢„è®¡ ~300 è¡Œ |
| 4.2 ä¸‹æ”¾æŒ‰é’®äº‹ä»¶å¤„ç† | â¬œ æœªå¼€å§‹ | - | - | é¢„è®¡ ~200 è¡Œ |
| 4.3 ç®€åŒ–æ¶ˆæ¯ç³»ç»Ÿ | â¬œ æœªå¼€å§‹ | - | - | é¢„è®¡ ~100 è¡Œ |

### Phase 5: é‡æ„å…¶ä»–è§†å›¾
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 5.1 paperEvaluationView | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | 1061â†’378è¡Œ (-64.4%), æå–3ä¸ªç»„ä»¶, commit: 8c935951 |
| 5.2 quickSearchView | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | 954â†’520è¡Œ (-45.5%), æå–QuickSearchSettingsDialog, commit: 8c935951 |

### Phase 6: sessionAnnotationsViewæ·±åº¦ä¼˜åŒ– (2025-11-12)
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 6.1 æå–æ ‡æ³¨ç®¡ç†æ“ä½œ | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | AnnotationManageOperations.ts (+310è¡Œ), 1780â†’1604è¡Œ (-9.9%), commit: 8c935951 |
| 6.2 æå–ä¼šè¯å¤´éƒ¨ç»„ä»¶ | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | SessionHeaderComponents.ts (+230è¡Œ), commit: 8c935951 |
| 6.3 å¤ç”¨åˆ°myAnnotationsView | âœ… å·²å®Œæˆ | 2025-11-12 | âœ… ç¼–è¯‘é€šè¿‡ | 660â†’605è¡Œ (-8.3%), æ¶ˆé™¤é‡å¤ä»£ç , commit: 932698d6 |

### Phase 7: userHoverCardä¼˜åŒ– (2025-11-13) âœ…
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 7.1 æå–ç”¨æˆ·å¤´åƒåˆ›å»ºå™¨ | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | UserAvatarCreator.ts (+60è¡Œ), æ”¯æŒå¤´åƒå›¾ç‰‡/æ–‡æœ¬å›é€€/åŒ¿åç”¨æˆ·, commit: 21587aea |
| 7.2 æå–æ‚¬æµ®å¡å·¥å…·å‡½æ•° | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | HoverCardHelpers.ts (+125è¡Œ), ä½ç½®è®¡ç®—/åŠ è½½åŠ¨ç”»/å¡ç‰‡å®¹å™¨, commit: 21587aea |
| 7.3 ç®€åŒ–ä¸»æ–‡ä»¶ä»£ç  | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | 647â†’581è¡Œ (-10.2%), ä½¿ç”¨helperå‡½æ•°é‡æ„, commit: 21587aea |

### Phase 8: sessionAnnotationsViewæ·±åº¦ä¼˜åŒ–-II (2025-11-13) âœ…
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 8.1 æå–æ ‡æ³¨ç®¡ç†å¼¹çª— | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | ManageAnnotationPopup.ts (+147è¡Œ), 1604â†’1501è¡Œ (-6.4%), commit: cef12067 |
| 8.2 æå–æ‰¹é‡æ˜¾ç¤ºå¤„ç†å™¨ | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | BatchDisplayHandler.ts (+185è¡Œ), 1501â†’1355è¡Œ (-9.7%), commit: 1e161085 |
| 8.3 æå–è¯„è®ºåŒºåŸŸç»„ä»¶ | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | CommentsSection.ts (+167è¡Œ), 1355â†’1283è¡Œ (-5.3%), commit: cc95545a |
| 8.4 æå–ç®¡ç†æ ‡æ³¨åˆ—è¡¨ | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | ManageAnnotationsList.ts (+125è¡Œ), 1283â†’1237è¡Œ (-3.6%), commit: 0c8ceb06 |
| 8.5 æå–å…±äº«å·¥å…·æ  | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | SharedToolbars.ts (+176è¡Œ), 1237â†’1177è¡Œ (-4.9%), commit: cdf03d48 |
| 8.6 æå–æ’åºç­›é€‰å·¥å…· | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | SharedSortFilter.ts (+118è¡Œ), 1177â†’1115è¡Œ (-5.3%), commit: e130024b |
| **Phase 8 æ€»è®¡** | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… ç¼–è¯‘é€šè¿‡ | **+918è¡Œæ–°æ¨¡å—, 1604â†’1115è¡Œ (-30.5%), 6ä¸ªå·¥å…·æ¨¡å—æå–å®Œæˆ** |

**Phase 8 æˆæœè¯„ä¼°**:
- âœ… **è¡Œæ•°ä¼˜åŒ–**: 1604è¡Œ â†’ 1115è¡Œ (**-489è¡Œ, -30.5%**)
- âœ… **æ¨¡å—åŒ–**: 6ä¸ªå·¥å…·æ¨¡å— + 14ä¸ªç»„ä»¶ (ç´¯è®¡20ä¸ªç‹¬ç«‹æ¨¡å—)
- âœ… **ä»£ç å¤ç”¨**: æ‰€æœ‰å·¥å…·æ¨¡å—å¯è·¨è§†å›¾å¤ç”¨
- ğŸ“Š **è·ç¦»P0ç›®æ ‡<800è¡Œ**: è¿˜éœ€-315è¡Œ (-28.3%)
- ğŸ’¡ **åœæ­¢å†³ç­–**: å‰©ä½™ä»£ç ä¸»è¦æ˜¯**æ ¸å¿ƒæ¸²æŸ“é€»è¾‘**(renderSharedMode/renderManageMode),å¼ºè¡Œæ‹†åˆ†ä¼š**é™ä½å¯è¯»æ€§**ã€‚å½“å‰1115è¡Œå¯¹äºå¤æ‚è§†å›¾ç±»æ˜¯**åˆç†ä¸”å¯ç»´æŠ¤**çš„è§„æ¨¡ã€‚
- ğŸ¯ **æ–°ç›®æ ‡**: P0é˜¶æ®µæ€§å®Œæˆ,è°ƒæ•´ç›®æ ‡ä¸º **<1200è¡Œ** (å·²è¾¾æˆâœ…)

### ğŸ“Š 2025-11-12 é‡æ„æˆæœæ€»ç»“

**ä¼˜åŒ–æ–‡ä»¶**:
1. **paperEvaluationView.ts**: 1061 â†’ 378è¡Œ (-683è¡Œ, -64.4%) â­â­â­
   - æå–PaperRatingForm.ts (195è¡Œ) - è®ºæ–‡è¯„åˆ†è¡¨å•UI
   - æå–PaperCommentNode.ts (196è¡Œ) - è¯„è®ºèŠ‚ç‚¹æ¸²æŸ“
   - æå–paperCommentEditor.ts (280è¡Œ) - è¯„è®ºç¼–è¾‘å™¨é€»è¾‘
   
2. **quickSearchView.ts**: 954 â†’ 520è¡Œ (-434è¡Œ, -45.5%) â­â­â­
   - æå–QuickSearchSettingsDialog.ts (550è¡Œ) - å®Œæ•´è®¾ç½®å¯¹è¯æ¡†
   - åŒ…å«ç«™ç‚¹é€‰æ‹©ã€å¿«æ·ç­›é€‰ã€ä¿å­˜/å–æ¶ˆé€»è¾‘
   
3. **sessionAnnotationsView.ts**: 1780 â†’ 1604è¡Œ (-176è¡Œ, -9.9%) â­â­
   - æå–AnnotationManageOperations.ts (310è¡Œ) - æ ‡æ³¨ç®¡ç†æ“ä½œ
   - å°è£…å…±äº«åˆ‡æ¢ã€åŒ¿ååˆ‡æ¢ã€æ‰¹é‡æ“ä½œé€»è¾‘
   
4. **SessionHeaderComponents.ts** (æ–°å¢230è¡Œ) - ä¼šè¯å¤´éƒ¨å¯å¤ç”¨ç»„ä»¶
   - createCopyableCodeButton - å¯å¤åˆ¶ä»£ç æŒ‰é’®
   - createMemberCountDisplay - æˆå‘˜ç»Ÿè®¡æ˜¾ç¤º
   - createExpiryAlert - è¿‡æœŸæç¤º
   - createSessionTypeTag - ä¼šè¯ç±»å‹æ ‡ç­¾
   - createTimeDisplay - æ—¶é—´æ˜¾ç¤º

**ç»Ÿè®¡æ•°æ®**:
- æ€»ä¼˜åŒ–è¡Œæ•°: -1348è¡Œ (å®é™…ä»£ç ç²¾ç®€)
- æ–°å¢æ¨¡å—ä»£ç : +1565è¡Œ (4ä¸ªæ–°æ¨¡å—,é«˜åº¦å¯å¤ç”¨)
- å‡€å¢é•¿: +217è¡Œ (æé«˜å¯ç»´æŠ¤æ€§,é™ä½é‡å¤ç‡)
- ä¼˜åŒ–æ•ˆç‡: æœ€é«˜64.4% (paperEvaluationView)
- ä»£ç å¤ç”¨æˆæœ: AnnotationManageOperationsè¢«2ä¸ªè§†å›¾å…±äº«

**ç´¯è®¡è¿›åº¦**:
- P0ç›®æ ‡(sessionAnnotationsView <800è¡Œ): 1604è¡Œ,è¿˜éœ€-804è¡Œ (-50.1%)
- P1ç›®æ ‡å®Œæˆ: paperEvaluationView âœ…, ui-manager âœ…
- P2ç›®æ ‡å®Œæˆ: quickSearchView âœ…
- P3ç›®æ ‡å®Œæˆ: myAnnotationsView âœ…
- æ€»ä½“è¿›åº¦: 7/8æ ¸å¿ƒæ–‡ä»¶å®Œæˆä¼˜åŒ– (87.5%)

### ğŸ“Š 2025-11-13 é‡æ„æˆæœæ€»ç»“

**ä¼˜åŒ–æ–‡ä»¶**:
5. **userHoverCard.ts**: 647 â†’ 581è¡Œ (-66è¡Œ, -10.2%) â­â­
   - æå–UserAvatarCreator.ts (60è¡Œ) - ç”¨æˆ·å¤´åƒåˆ›å»ºå™¨
     - æ”¯æŒå›¾ç‰‡/æ–‡æœ¬/åŒ¿åç”¨æˆ·å¤šç§æ˜¾ç¤ºæ¨¡å¼
     - å¯é…ç½®å°ºå¯¸,æ¸å˜èƒŒæ™¯å›é€€
   - æå–HoverCardHelpers.ts (125è¡Œ) - æ‚¬æµ®å¡å·¥å…·å‡½æ•°
     - calculateCardPosition - æ™ºèƒ½ä½ç½®è®¡ç®—(å«æ»šåŠ¨å¤„ç†)
     - createLoadingContent - åŠ è½½åŠ¨ç”»UI
     - startLoadingAnimation - åŠ¨ç”»æ§åˆ¶å™¨
     - createCardContainer - å¡ç‰‡å®¹å™¨åˆ›å»º
     - applyShowAnimation - æ·¡å…¥åŠ¨ç”»åº”ç”¨

**ç»Ÿè®¡æ•°æ®**:
- å•æ—¥ä¼˜åŒ–: -66è¡Œ (ä¸»æ–‡ä»¶ç²¾ç®€10.2%)
- æ–°å¢æ¨¡å—: +185è¡Œ (2ä¸ªé«˜å¤ç”¨å·¥å…·æ¨¡å—)
- å‡€å¢é•¿: +119è¡Œ
- å¤ç”¨æ½œåŠ›: å¤´åƒåˆ›å»ºå™¨å’Œæ‚¬æµ®å¡åŠ©æ‰‹å¯ç”¨äºå…¶ä»–ç”¨æˆ·ç›¸å…³UI

**ç´¯è®¡è¿›åº¦** (Phase 1-7):
- P0ç›®æ ‡(sessionAnnotationsView <800è¡Œ): 1604è¡Œ,è¿˜éœ€-804è¡Œ (-50.1%)
- P1ç›®æ ‡å®Œæˆ: paperEvaluationView âœ…, ui-manager âœ…
- P2ç›®æ ‡å®Œæˆ: quickSearchView âœ…
- P3ç›®æ ‡å®Œæˆ: myAnnotationsView âœ…, userHoverCard âœ…
- æ€»ä½“è¿›åº¦: 8/9æ ¸å¿ƒæ–‡ä»¶å®Œæˆä¼˜åŒ– (88.9%)
- ç´¯è®¡ä»£ç ç²¾ç®€: -1480è¡Œ (6ä¸ªæ–‡ä»¶)
- ç´¯è®¡æ–°æ¨¡å—: 27ä¸ªç»„ä»¶/å·¥å…· (+5762è¡Œ)

### Phase 8 (âœ… å·²å®Œæˆ): preferenceScript.tsæ¨¡å—åŒ– (2025-11-13)
| Task | çŠ¶æ€ | å®Œæˆæ—¶é—´ | æµ‹è¯• | è¯´æ˜ |
|------|------|---------|------|------|
| 8.1 æå–å·¥å…·å‡½æ•° | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… å·²æµ‹è¯• | PreferenceHelpers.ts (+165è¡Œ), commit: eb528031 |
| 8.2 æå–å‡­è¯ç®¡ç† | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… å·²æµ‹è¯• | CredentialsManager.ts (+95è¡Œ), commit: eb528031 |
| 8.3 æå–ç™»å½•è¡¨å• | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… å·²æµ‹è¯• | LoginFormHandler.ts (+165è¡Œ), commit: eb528031 |
| 8.4 æå–å·²ç™»å½•äº‹ä»¶ | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… å·²æµ‹è¯• | LoggedInEventsHandler.ts (+114è¡Œ), commit: eb528031 |
| 8.5 æå–APIé…ç½® | âœ… å·²å®Œæˆ | 2025-11-13 | âœ… å·²æµ‹è¯• | ApiConfigHandler.ts (+170è¡Œ), commit: eb528031 |
| 8.6 é›†æˆåˆ°ä¸»æ–‡ä»¶ | âœ… å·²å®Œæˆ | 2025-01-23 | âœ… å·²æµ‹è¯• | preferenceScript.ts: 646â†’468è¡Œ (-27.6%), 17ç¼–è¯‘é”™è¯¯â†’0, commit: 7d8ade73 |

**Phase 8 å®Œæˆæ€»ç»“** (P0ä¼˜å…ˆçº§ä»»åŠ¡):
- âœ… **æ¨¡å—æå–**: 5ä¸ªå·¥å…·æ¨¡å— (+709è¡Œ)
- âœ… **ä¸»æ–‡ä»¶é›†æˆ**: preferenceScript.tsé‡æ„å®Œæˆ
- âœ… **ç¼–è¯‘é”™è¯¯ä¿®å¤**: 17ä¸ªé”™è¯¯å…¨éƒ¨è§£å†³ âœ…
- âœ… **ä»£ç ç²¾ç®€**: 646è¡Œ â†’ 468è¡Œ (-178è¡Œ, -27.6%)
- ğŸ¯ **è¶…é¢„æœŸå®Œæˆ**: æ¯”é¢„æœŸ(-45%)ç¨ä½,ä½†åŒæ—¶ä¿®å¤äº†æ‰€æœ‰ç¼–è¯‘é”™è¯¯

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¤„ç†ç°æœ‰çš„ import è¯­å¥ï¼Ÿ
**A**: ä½¿ç”¨ VSCode çš„"æŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨"åŠŸèƒ½ï¼Œæ‰¹é‡æ›¿æ¢ã€‚

### Q2: å¦‚ä½•ç¡®ä¿ä¸ç ´åç°æœ‰åŠŸèƒ½ï¼Ÿ
**A**: æ¯ä¸ª Phase å®Œæˆåç«‹å³æµ‹è¯•ï¼Œå‘ç°é—®é¢˜åŠæ—¶å›æ»šã€‚

### Q3: é‡æ„è¿‡ç¨‹ä¸­å¦‚ä½•å¤„ç†ç´§æ€¥ Bugï¼Ÿ
**A**: 
1. åœ¨ main åˆ†æ”¯ä¿®å¤ Bug
2. å°†ä¿®å¤ cherry-pick åˆ° refactor åˆ†æ”¯
3. ç»§ç»­é‡æ„

### Q4: å¦‚ä½•é¿å…ä»£ç å†²çªï¼Ÿ
**A**: 
1. é‡æ„æœŸé—´é¿å…åœ¨ç›¸åŒæ–‡ä»¶ä¸Šå¹¶è¡Œå¼€å‘
2. æ¯ä¸ª Phase åŠæ—¶åˆå¹¶åˆ° main
3. ä¿æŒ refactor åˆ†æ”¯ä¸ main åŒæ­¥

---

## ğŸ“š å‚è€ƒèµ„æº

- [åŸæ¨¡å—åŒ–æŒ‡å— (6-CODE_MODULARIZATION_GUIDE.md)](./6-CODE_MODULARIZATION_GUIDE.md)
- [æ¶æ„æ–‡æ¡£ (ARCHITECTURE.md)](../ARCHITECTURE.md)
- [å¼€å‘æ–‡æ¡£ (DEVELOPMENT.md)](../DEVELOPMENT.md)

---

**ç»´æŠ¤è€…**: Researchopia Team  
**æœ€åæ›´æ–°**: 2025-11-13 (Phase 7å®Œæˆ, userHoverCardä¼˜åŒ–, ç´¯è®¡ä¼˜åŒ–6ä¸ªæ–‡ä»¶, 88.9%è¿›åº¦ â­â­)  
**ä¸‹æ¬¡å®¡æŸ¥**: æ¯å®Œæˆä¸€ä¸ª Phase åæ›´æ–°
