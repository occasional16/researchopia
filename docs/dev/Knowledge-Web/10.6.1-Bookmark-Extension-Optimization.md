# 10.6.1 æµè§ˆå™¨æ‰©å±•æ”¶è—åŠŸèƒ½ä¼˜åŒ–è®¡åˆ’

## æ¦‚è¿°

æœ¬æ–‡æ¡£åˆ—å‡ºäº†æµè§ˆå™¨æ‰©å±• popup ä¸­æ”¶è—åŠŸèƒ½ï¼ˆ`extension/popup.html`ï¼‰çš„è®¡åˆ’ä¼˜åŒ–é¡¹ã€‚

**ç›¸å…³æ–‡æ¡£ï¼š**
- [10.6-Bookmarks-and-Related-Links-Design.md](./10.6-Bookmarks-and-Related-Links-Design.md) - ä¸»è®¾è®¡æ–‡æ¡£
- [DEVELOPMENT.md - æµè§ˆå™¨æ‰©å±•](../../DEVELOPMENT.md#ç¬¬ä¸‰éƒ¨åˆ†æµè§ˆå™¨æ‰©å±•) - å¼€å‘æŒ‡å—

**çŠ¶æ€ï¼š** è¿›è¡Œä¸­  
**åˆ›å»ºæ—¥æœŸï¼š** 2025-01-03  
**æœ€åæ›´æ–°ï¼š** 2025-01-17

---

## è®¡åˆ’ä¼˜åŒ–é¡¹

### ä¼˜å…ˆçº§ 1ï¼šé«˜ï¼ˆæ¨èå®ç°ï¼‰

#### 1.1 æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
- **æè¿°ï¼š** æ‰“å¼€ popup æ—¶æ£€æŸ¥å½“å‰é¡µé¢ URL æ˜¯å¦å·²è¢«æ”¶è—
- **ç”¨æˆ·ä»·å€¼ï¼š** é˜²æ­¢é‡å¤æ”¶è—ï¼Œæ˜¾ç¤ºå·²æœ‰æ”¶è—ä¿¡æ¯
- **å®ç°æ–¹å¼ï¼š**
  ```typescript
  // åœ¨ BookmarkPanel.init() ä¸­
  async checkIfBookmarked(): Promise<void> {
    const response = await fetch(`${this.researchopiaUrl}/api/bookmarks/items/check?url=${encodeURIComponent(this.state.pageUrl)}`);
    // å¦‚æœå·²æ”¶è—ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤¹åå’Œ"å·²ä¿å­˜"çŠ¶æ€
  }
  ```
- **éœ€è¦ APIï¼š** `GET /api/bookmarks/items/check?url=<url>`
- **UI å˜æ›´ï¼š**
  - å·²æ”¶è—æ—¶æ˜¾ç¤º "âœ… å·²æ”¶è—åˆ°ï¼š[æ–‡ä»¶å¤¹å]"
  - ä¿å­˜æŒ‰é’®æ”¹ä¸º"æ›´æ–°æ”¶è—"
- **çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ

#### 1.2 ä¿å­˜åè‡ªåŠ¨å…³é—­ Popup
- **æè¿°ï¼š** æ˜¾ç¤ºæˆåŠŸçŠ¶æ€ 1.5 ç§’åè‡ªåŠ¨å…³é—­ popup
- **ç”¨æˆ·ä»·å€¼ï¼š** æ›´å¿«çš„å·¥ä½œæµç¨‹ï¼Œå‡å°‘ç‚¹å‡»
- **å®ç°æ–¹å¼ï¼š**
  ```typescript
  // ä¿å­˜æˆåŠŸå
  showToast('å·²æ”¶è—', 'success');
  setTimeout(() => window.close(), 1500);
  ```
- **çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ (2025-01-17)

#### 1.3 æ–‡ä»¶å¤¹å±‚çº§æ˜¾ç¤ºä¼˜åŒ–
- **æè¿°ï¼š** æ”¹è¿›æ–‡ä»¶å¤¹ä¸‹æ‹‰æ¡†çš„è§†è§‰å±‚çº§æ˜¾ç¤º
- **å½“å‰å®ç°ï¼š** ä½¿ç”¨ `'â€”'.repeat(depth)` ç¼©è¿›
- **å»ºè®®æ”¹è¿›ï¼š** æ·»åŠ æ–‡ä»¶å¤¹å›¾æ ‡åŒºåˆ†æ ¹ç›®å½•å’Œå­ç›®å½•
  ```
  ğŸ“ å·¥ä½œ
  â”— ğŸ“‚ é¡¹ç›®A
  â”— ğŸ“‚ é¡¹ç›®B
  ğŸ“ ä¸ªäºº
  ```
- **çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ (2025-01-17)

---

### ä¼˜å…ˆçº§ 2ï¼šä¸­ï¼ˆä½“éªŒæå‡ï¼‰

#### 2.1 å¿«æ·é”®æ”¶è—
- **æè¿°ï¼š** æ·»åŠ  `Ctrl+B` å¿«æ·é”®ä¸€é”®ä¿å­˜åˆ°é»˜è®¤/ä¸Šæ¬¡ä½¿ç”¨çš„æ–‡ä»¶å¤¹
- **ç”¨æˆ·ä»·å€¼ï¼š** é«˜æ•ˆç”¨æˆ·ä½“éªŒ
- **å®ç°æ–¹å¼ï¼š**
  - åœ¨ `manifest.json` çš„ `commands` ä¸­æ³¨å†Œå¿«æ·é”®
  - background script ç›‘å¬å¹¶è§¦å‘ä¿å­˜
- **æ¶‰åŠæ–‡ä»¶ï¼š**
  - `extension/manifest.json`
  - `extension/src/background.ts`
  - `extension/src/background/quick-bookmark.ts` (æ–°å¢)
- **çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ (2025-01-17)

#### 2.2 è®°ä½ä¸Šæ¬¡ä½¿ç”¨çš„æ–‡ä»¶å¤¹
- **æè¿°ï¼š** å°†ä¸Šæ¬¡é€‰æ‹©çš„æ–‡ä»¶å¤¹å­˜å‚¨åœ¨ `chrome.storage.local`ï¼Œä¸‹æ¬¡æ‰“å¼€æ—¶è‡ªåŠ¨é€‰ä¸­
- **ç”¨æˆ·ä»·å€¼ï¼š** åŠ å¿«é‡å¤æ”¶è—æ“ä½œ
- **å®ç°æ–¹å¼ï¼š**
  ```typescript
  // é€‰æ‹©æ–‡ä»¶å¤¹æ—¶
  chrome.storage.local.set({ lastFolderId: folderId });
  
  // åˆå§‹åŒ–æ—¶
  const { lastFolderId } = await chrome.storage.local.get('lastFolderId');
  if (lastFolderId) folderSelect.value = lastFolderId;
  ```
- **çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ (2025-01-17)

#### 2.3 å†…è”æ–°å»ºæ–‡ä»¶å¤¹
- **æè¿°ï¼š** åœ¨ä¸‹æ‹‰æ¡†åº•éƒ¨æ·»åŠ "+ æ–°å»ºæ–‡ä»¶å¤¹"é€‰é¡¹
- **ç”¨æˆ·ä»·å€¼ï¼š** æ— éœ€ç¦»å¼€ popup å³å¯åˆ›å»ºæ–‡ä»¶å¤¹
- **å®ç°æ–¹å¼ï¼š**
  - æ·»åŠ å€¼ä¸º `__new__` çš„ç‰¹æ®Šé€‰é¡¹
  - é€‰ä¸­æ—¶æ˜¾ç¤ºå†…è”è¾“å…¥æ¡†
  - è°ƒç”¨ `POST /api/bookmarks/folders` åˆ›å»º
  - åˆ·æ–°æ–‡ä»¶å¤¹åˆ—è¡¨å¹¶é€‰ä¸­æ–°æ–‡ä»¶å¤¹
- **çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ (2025-01-17)

---

### ä¼˜å…ˆçº§ 3ï¼šä½ï¼ˆåæœŸè€ƒè™‘ï¼‰

#### 3.1 æ‰¹é‡æ”¶è—å¤šä¸ªæ ‡ç­¾é¡µ
- **æè¿°ï¼š** æ”¯æŒä¸€æ¬¡æ”¶è—å½“å‰çª—å£çš„æ‰€æœ‰æ ‡ç­¾é¡µ
- **ç”¨æˆ·ä»·å€¼ï¼š** ç ”ç©¶å·¥ä½œæµæ•ˆç‡
- **å®ç°æ–¹å¼ï¼š**
  - æ·»åŠ "ä¿å­˜æ‰€æœ‰æ ‡ç­¾é¡µ"æŒ‰é’®
  - ä½¿ç”¨ `chrome.tabs.query({ currentWindow: true })`
  - æ‰¹é‡ API è°ƒç”¨æˆ–å¾ªç¯
- **çŠ¶æ€ï¼š** ğŸ”² æœªå¼€å§‹

#### 3.2 æœç´¢æ–‡ä»¶å¤¹
- **æè¿°ï¼š** å½“æ–‡ä»¶å¤¹æ•°é‡ > 10 æ—¶æ·»åŠ æœç´¢è¾“å…¥æ¡†
- **ç”¨æˆ·ä»·å€¼ï¼š** æ›´å¿«é€‰æ‹©æ–‡ä»¶å¤¹
- **å®ç°æ–¹å¼ï¼š**
  - åœ¨ keyup æ—¶è¿‡æ»¤ä¸‹æ‹‰é€‰é¡¹
  - ä½¿ç”¨ datalist æˆ–è‡ªå®šä¹‰ä¸‹æ‹‰æ¡†
- **çŠ¶æ€ï¼š** ğŸ”² æœªå¼€å§‹

#### 3.3 æ ‡ç­¾æ”¯æŒ
- **æè¿°ï¼š** æ”¶è—æ—¶å…è®¸æ·»åŠ æ ‡ç­¾
- **ç”¨æˆ·ä»·å€¼ï¼š** æ›´å¥½çš„ç»„ç»‡ï¼Œè·¨æ–‡ä»¶å¤¹å‘ç°
- **éœ€è¦ï¼š**
  - æ•°æ®åº“ï¼š`bookmark_tags` è¡¨
  - APIï¼šæ ‡ç­¾ CRUD ç«¯ç‚¹
  - UIï¼šæ ‡ç­¾è¾“å…¥ç»„ä»¶ï¼ˆé€—å·åˆ†éš”æˆ–æ ‡ç­¾ç‰‡ï¼‰
- **çŠ¶æ€ï¼š** ğŸ”² æœªå¼€å§‹

---

## æŠ€æœ¯è¯´æ˜

### å½“å‰æ–‡ä»¶ç»“æ„
```
extension/
â”œâ”€â”€ popup.html                    # ä¸» popup HTML
â”œâ”€â”€ styles/popup.css              # Popup æ ·å¼
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ popup.ts                  # Popup å…¥å£
â”‚   â””â”€â”€ popup/
â”‚       â””â”€â”€ bookmark-panel.ts     # æ”¶è—é¢æ¿æ¨¡å—
```

### çŠ¶æ€ç®¡ç†
BookmarkPanel ä½¿ç”¨å†…éƒ¨çŠ¶æ€å¯¹è±¡ï¼š
```typescript
interface BookmarkPanelState {
  pageUrl: string;
  pageTitle: string;
  isLoggedIn: boolean;
  isSaving: boolean;
  isLoading: boolean;
  folders: BookmarkFolder[];
  selectedFolderId: string | null;
  customTitle: string;
  note: string;
  isBookmarked: boolean;
}
```

### è®¤è¯æ–¹å¼
- Token å­˜å‚¨åœ¨ `chrome.storage.sync` ä¸­ï¼Œé”®åä¸º `authToken`
- ä½¿ç”¨ `getSyncStorage(['authToken'])` è·å–
- è¯·æ±‚å¤´æ·»åŠ  `Authorization: Bearer ${token}`

---

## å®ç°æ¸…å•

å®ç°æŸä¸ªä¼˜åŒ–é¡¹æ—¶ï¼š
1. [ ] å°†æœ¬æ–‡æ¡£ä¸­è¯¥é¡¹çŠ¶æ€æ›´æ–°ä¸º "ğŸ”„ è¿›è¡Œä¸­"
2. [ ] å¦‚é€‚ç”¨ï¼Œç¼–å†™/æ›´æ–°æµ‹è¯•
3. [ ] å®ç°åŠŸèƒ½
4. [ ] åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•
5. [ ] åœ¨ `/extension` ç›®å½•æ‰§è¡Œ `npm run build` ç¼–è¯‘æ‰©å±•
6. [ ] å°†çŠ¶æ€æ›´æ–°ä¸º "âœ… å·²å®Œæˆ"
7. [ ] å¦‚éœ€è¦ï¼Œæ›´æ–°ä¸»è®¾è®¡æ–‡æ¡£

---

## å˜æ›´æ—¥å¿—

### 2025-01-03
- åˆ›å»ºåˆå§‹æ–‡æ¡£
- åˆ—å‡ºå·²å®Œæˆå’Œè®¡åˆ’ä¼˜åŒ–é¡¹
