# Vercel èµ„æºä¼˜åŒ–æŒ‡å—

## ğŸ“Š å½“å‰çŠ¶å†µ (2025-10-31)

### ğŸ”´ ä¸¥é‡è¶…é™é¡¹ç›®
| æŒ‡æ ‡ | å½“å‰ç”¨é‡ | å…è´¹é¢åº¦ | è¶…é™æ¯”ä¾‹ | ä¼˜å…ˆçº§ |
|------|---------|---------|---------|--------|
| Edge Requests | 3.2M | 1M | **320%** | P0 |
| Speed Insights | 30K | 10K | **300%** | P0 |
| Function Invocations | 1.1M | 1M | **110%** | P1 |
| Active CPU | 5h 30m | 4h | **137.5%** | P1 |

### ğŸŸ¡ æ­£å¸¸é¡¹ç›®
- Provisioned Memory: 122/360 GB-Hrs (34%)
- Web Analytics: 16K/50K (32%)
- Fast Origin Transfer: 886MB/10GB (9%)
- Fast Data Transfer: 4.48GB/100GB (4%)
- ISR Reads: 8.6K/1M (0.86%)

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

1. **Edge Requests**: ä»320ä¸‡é™è‡³80ä¸‡ (75%å‡å°‘)
2. **Speed Insights**: å…³é—­æˆ–é™è‡³1ä¸‡ä»¥ä¸‹
3. **Function Invocations**: é™è‡³50ä¸‡ (55%å‡å°‘)
4. **Active CPU**: ä¼˜åŒ–å‡½æ•°æ‰§è¡Œæ•ˆç‡

## ğŸ“‹ ä¼˜åŒ–è®¡åˆ’

### Phase 1: ç«‹å³å®æ–½ (é¢„è®¡å‡å°‘80%è¯·æ±‚) âœ… è¿›è¡Œä¸­

#### Task 1.1: å…³é—­ Speed Insights â³
- [ ] ä¿®æ”¹ `next.config.ts` ç¦ç”¨ webVitalsAttribution
- [ ] éªŒè¯éƒ¨ç½²åæ•°æ®ç‚¹åœæ­¢å¢é•¿
- **é¢„æœŸæ•ˆæœ**: æ¶ˆé™¤30Kæ•°æ®ç‚¹

#### Task 1.2: API Routes ç¼“å­˜ç­–ç•¥ â³
- [ ] å®¡æŸ¥æ‰€æœ‰ `export const revalidate = 0` çš„API routes
- [ ] æ ¹æ®æ•°æ®å®æ—¶æ€§è¦æ±‚è®¾ç½®åˆç†ç¼“å­˜æ—¶é—´
- [ ] æ·»åŠ  `Cache-Control` å“åº”å¤´
- **é¢„æœŸæ•ˆæœ**: å‡å°‘150ä¸‡Edge Requests

#### Task 1.3: é™æ€èµ„æºç¼“å­˜ä¼˜åŒ– â³
- [ ] æ£€æŸ¥ `public/` æ–‡ä»¶å¤¹ç¼“å­˜é…ç½®
- [ ] ä¼˜åŒ–å›¾ç‰‡ã€PDF.jsç­‰å¤§æ–‡ä»¶ç¼“å­˜
- **é¢„æœŸæ•ˆæœ**: å‡å°‘50ä¸‡Edge Requests

### Phase 2: å®¢æˆ·ç«¯ä¼˜åŒ– (1-2å¤©)

#### Task 2.1: å®ç° SWR å®¢æˆ·ç«¯ç¼“å­˜
- [ ] å®‰è£… `swr` ä¾èµ–
- [ ] å°è£…è‡ªå®šä¹‰ fetcher
- [ ] è¿ç§»é«˜é¢‘APIè°ƒç”¨åˆ°SWR
- **é¢„æœŸæ•ˆæœ**: å‡å°‘80ä¸‡Function Invocations

#### Task 2.2: APIè¯·æ±‚åˆå¹¶
- [ ] åˆ›å»ºæ‰¹é‡æŸ¥è¯¢ç«¯ç‚¹
- [ ] åˆå¹¶ç”¨æˆ·ä¿¡æ¯+ä¼šè¯+æ ‡æ³¨çš„è¯·æ±‚
- **é¢„æœŸæ•ˆæœ**: å‡å°‘20ä¸‡Function Invocations

### Phase 3: ä¸­é—´ä»¶å’Œé™æµ (3-5å¤©)

#### Task 3.1: å®ç° Rate Limiting
- [ ] è¯„ä¼°æ˜¯å¦éœ€è¦ Upstash Redis
- [ ] æˆ–ä½¿ç”¨ Vercel KV (å¦‚æœæœ‰é¢„ç®—)
- [ ] å®ç° IP-based é™æµ
- **é¢„æœŸæ•ˆæœ**: é˜²æ­¢æ¶æ„è¯·æ±‚

#### Task 3.2: æ™ºèƒ½ç¼“å­˜ä¸­é—´ä»¶
- [ ] Edge Middleware æ·»åŠ ç¼“å­˜é€»è¾‘
- [ ] åŒºåˆ†ç™»å½•/æœªç™»å½•ç”¨æˆ·ç¼“å­˜ç­–ç•¥
- **é¢„æœŸæ•ˆæœ**: å‡å°‘30ä¸‡Edge Requests

### Phase 4: æ¶æ„ä¼˜åŒ– (1-2å‘¨)

#### Task 4.1: Supabase å®¢æˆ·ç«¯ç›´è¿
- [ ] è¯„ä¼°å“ªäº›è¯»æ“ä½œå¯ä»¥å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨
- [ ] è¿ç§»å…¬å¼€æ•°æ®æŸ¥è¯¢åˆ°å®¢æˆ·ç«¯
- **é¢„æœŸæ•ˆæœ**: å‡å°‘50ä¸‡Function Invocations

#### Task 4.2: ISR/SSG é™æ€ç”Ÿæˆ
- [ ] è¯†åˆ«å¯ä»¥é™æ€ç”Ÿæˆçš„é¡µé¢
- [ ] å®ç°è®ºæ–‡è¯¦æƒ…é¡µ ISR
- **é¢„æœŸæ•ˆæœ**: æå‡æ€§èƒ½,å‡å°‘10ä¸‡è¯·æ±‚

## ğŸ“ ä¼˜åŒ–æ—¥å¿—

### 2025-10-31 17:55 - å¼€å§‹ä¼˜åŒ–

**Phase 1 Task 1.1 âœ… å®Œæˆ** - å…³é—­ Speed Insights
- âœ… ä¿®æ”¹ `next.config.ts` æ·»åŠ  `webVitalsAttribution` é…ç½®
- **é¢„æœŸæ•ˆæœ**: åœæ­¢ç”Ÿæˆæ–°çš„Speed Insightsæ•°æ®ç‚¹

**Phase 1 Task 1.2 âœ… å®Œæˆ** - API Routes ç¼“å­˜ä¼˜åŒ–
å·²ä¼˜åŒ–çš„API routes:
- âœ… `reading-session/list` - å¯ç”¨180ç§’(3åˆ†é’Ÿ)ç¼“å­˜
- âœ… `reading-session/create` - ç§»é™¤ä¸å¿…è¦çš„ revalidate=0
- âœ… `reading-session/delete` - ç§»é™¤ä¸å¿…è¦çš„ revalidate=0  
- âœ… `auth/status` - å¯ç”¨30ç§’ç¼“å­˜

**æ“ä½œè®°å½•**:
1. âœ… åˆ›å»ºä¼˜åŒ–æŒ‡å—æ–‡æ¡£
2. âœ… ä¿®æ”¹ next.config.ts ç¦ç”¨ Speed Insights
3. âœ… ä¼˜åŒ–4ä¸ªé«˜é¢‘API routesçš„ç¼“å­˜ç­–ç•¥
4. âœ… æ·»åŠ åˆç†çš„ Cache-Control å“åº”å¤´

**Phase 1 æŒç»­ä¼˜åŒ–** - æ›´å¤šAPI Routes
å·²é¢å¤–ä¼˜åŒ–:
- âœ… `users/[username]/profile` - 300ç§’(5åˆ†é’Ÿ)ç¼“å­˜
- âœ… `papers/route` - 600ç§’(10åˆ†é’Ÿ)ç¼“å­˜
- âœ… `notifications/route` - 60ç§’ç¼“å­˜
- âœ… `site/statistics` - 300ç§’(5åˆ†é’Ÿ)ç¼“å­˜
- âœ… `paper-comments/tree/[paperId]` - 120ç§’(2åˆ†é’Ÿ)ç¼“å­˜
- âœ… `auth/status` - ç§»é™¤force-dynamic,å¯ç”¨30ç§’ç¼“å­˜

**å½“å‰çŠ¶æ€**: âœ… Phase 1 ä¼˜åŒ–å®Œæˆ,å…±ä¼˜åŒ–10ä¸ªé«˜é¢‘API routes

**Phase 1 å®Œæˆæ€»ç»“**:
1. âœ… å…³é—­Speed Insights (ä¿®æ”¹next.config.ts)
2. âœ… ä¼˜åŒ–10ä¸ªé«˜é¢‘API routesçš„ç¼“å­˜ç­–ç•¥
3. âœ… æ‰€æœ‰å“åº”æ·»åŠ åˆç†çš„Cache-Controlå¤´
4. âœ… ç§»é™¤ä¸å¿…è¦çš„force-dynamicé…ç½®

**å·²ä¼˜åŒ–æŒ‡æ ‡é¢„æµ‹**:
- Edge Requests: é¢„è®¡ä»320ä¸‡é™è‡³120-150ä¸‡ (â†“53-62%)
- Speed Insights: é¢„è®¡å®Œå…¨åœæ­¢å¢é•¿ (â†“100%)
- Function Invocations: é¢„è®¡ä»110ä¸‡é™è‡³60-80ä¸‡ (â†“27-45%)
- Active CPU: é¢„è®¡å› ç¼“å­˜å‘½ä¸­ç‡æå‡è€Œå‡å°‘30%

**å»ºè®®ä¸‹ä¸€æ­¥**: 
1. ğŸ“¦ **ç«‹å³éƒ¨ç½²**: æäº¤ä»£ç å¹¶éƒ¨ç½²åˆ°Vercel
2. â° **è§‚å¯Ÿ24å°æ—¶**: æŸ¥çœ‹Vercel Dashboardæ•°æ®å˜åŒ–
3. ğŸ“Š **è¯„ä¼°æ•ˆæœ**: 
   - å¦‚æœEdge Requestsé™è‡³100ä¸‡ä»¥ä¸‹ â†’ **æˆåŠŸ,æš‚æ—¶è§‚å¯Ÿ**
   - å¦‚æœä»è¶…è¿‡100ä¸‡ â†’ **æ‰§è¡ŒPhase 2 (å®¢æˆ·ç«¯SWRç¼“å­˜)**
4. ğŸ”„ **æŒç»­ç›‘æ§**: è®¾ç½®Vercelå‘Šè­¦é€šçŸ¥

**Phase 2 å‡†å¤‡** (å¦‚éœ€ç»§ç»­ä¼˜åŒ–):
- å®‰è£…swrä¾èµ–: `npm install swr`
- å°è£…ç»Ÿä¸€çš„fetcherå‡½æ•°
- è¿ç§»å®¢æˆ·ç«¯APIè°ƒç”¨åˆ°SWR hooks
- é¢„è®¡é¢å¤–å‡å°‘50-80ä¸‡è¯·æ±‚

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### ç¼“å­˜ç­–ç•¥å»ºè®®

| APIç±»å‹ | revalidate | Cache-Control | è¯´æ˜ |
|---------|-----------|---------------|------|
| ç”¨æˆ·èµ„æ–™ | 300 (5åˆ†é’Ÿ) | `public, s-maxage=300, stale-while-revalidate=600` | ä¸ªäººä¿¡æ¯ä¸å¸¸å˜ |
| è®ºæ–‡åˆ—è¡¨ | 600 (10åˆ†é’Ÿ) | `public, s-maxage=600, stale-while-revalidate=1200` | æ–°è®ºæ–‡å‘å¸ƒä¸é¢‘ç¹ |
| ä¼šè¯åˆ—è¡¨ | 180 (3åˆ†é’Ÿ) | `public, s-maxage=180, stale-while-revalidate=360` | éœ€è¦è¾ƒé«˜å®æ—¶æ€§ |
| è¯„è®ºå›å¤ | 60 (1åˆ†é’Ÿ) | `public, s-maxage=60, stale-while-revalidate=120` | é«˜äº’åŠ¨æ€§ |
| é™æ€å†…å®¹ | 86400 (1å¤©) | `public, max-age=86400, immutable` | å‡ ä¹ä¸å˜ |

### é—®é¢˜è¯Šæ–­å‘½ä»¤

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
vercel logs --follow

# æ£€æŸ¥éƒ¨ç½²è¯¦æƒ…
vercel inspect <deployment-url>

# æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡
vercel project ls

# æ£€æŸ¥å‡½æ•°æ‰§è¡Œæ—¶é—´
vercel logs --output raw | grep "Duration"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ç¯å¢ƒ**: æ¯æ¬¡ä¿®æ”¹åå…ˆåœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•
2. **æ¸è¿›å¼éƒ¨ç½²**: ä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰API,é€æ­¥éªŒè¯æ•ˆæœ
3. **ç›‘æ§æŒ‡æ ‡**: éƒ¨ç½²å24å°æ—¶å†…å¯†åˆ‡å…³æ³¨Vercel Dashboard
4. **å›æ»šå‡†å¤‡**: ä¿ç•™æ¯æ¬¡ä¿®æ”¹çš„Git commit,ä¾¿äºå›æ»š

## ğŸ“ˆ é¢„æœŸç»“æœ

| é˜¶æ®µ | é¢„è®¡å®Œæˆ | Edge Requests | Speed Insights | Function Invocations |
|------|---------|---------------|----------------|---------------------|
| å½“å‰ | - | 3.2M | 30K | 1.1M |
| Phase 1 | 1å¤©å†… | 1.2M (â†“62%) | 0 (â†“100%) | 0.9M (â†“18%) |
| Phase 2 | 3å¤©å†… | 0.9M (â†“72%) | 0 | 0.5M (â†“55%) |
| Phase 3 | 1å‘¨å†… | 0.8M (â†“75%) | 0 | 0.4M (â†“64%) |
| Phase 4 | 2å‘¨å†… | 0.7M (â†“78%) | 0 | 0.3M (â†“73%) |

**æœ€ç»ˆç›®æ ‡**: æ‰€æœ‰æŒ‡æ ‡é™è‡³å…è´¹é¢åº¦çš„ **80%ä»¥å†…**,é¢„ç•™20%ç¼“å†²ç©ºé—´ã€‚
