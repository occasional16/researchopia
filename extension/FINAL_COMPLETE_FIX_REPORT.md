# æµ®åŠ¨å›¾æ ‡ä¾§è¾¹æ åŠŸèƒ½å®Œæ•´ä¿®å¤æŠ¥å‘Š - æœ€ç»ˆç‰ˆ

## é—®é¢˜è¯Šæ–­æ€»ç»“

### åŸå§‹é—®é¢˜
1. ç‚¹å‡»æµ®åŠ¨å›¾æ ‡æ— æ³•æ‰“å¼€ä¾§è¾¹æ 
2. æ§åˆ¶å°æ˜¾ç¤º"Backgroundå“åº”: undefined"
3. æ‰©å±•é€šä¿¡æµ‹è¯•å¤±è´¥
4. å·¥å…·æ å›¾æ ‡å¯æ­£å¸¸å·¥ä½œï¼Œä½†æµ®åŠ¨å›¾æ ‡ä¸è¡Œ

### æ·±åº¦åˆ†æå‘ç°çš„é—®é¢˜
1. **æ‰©å±•é€šä¿¡å¤±è´¥**: content scriptä¸background scriptæ¶ˆæ¯ä¼ é€’å­˜åœ¨é—®é¢˜
2. **æƒé™ä¸Šä¸‹æ–‡ä¸¢å¤±**: Chromeçš„ç”¨æˆ·æ‰‹åŠ¿è¦æ±‚å¯¼è‡´APIè°ƒç”¨å¤±è´¥
3. **content scriptä½œç”¨åŸŸå—é™**: ä»…åœ¨ç‰¹å®šå­¦æœ¯ç½‘ç«™è¿è¡Œï¼Œæµ‹è¯•å›°éš¾
4. **å¼‚æ­¥å¤„ç†å¤æ‚**: å¤æ‚çš„Promiseé“¾å¯¼è‡´é”™è¯¯å¤„ç†å›°éš¾

## æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

### 1. ç®€åŒ–æ¶ˆæ¯å¤„ç†æœºåˆ¶
**Background.js ä¿®å¤**:
```javascript
case 'openSidebar':
  console.log('ğŸ“– æ”¶åˆ°æ‰“å¼€ä¾§è¾¹æ è¯·æ±‚');
  try {
    await this.openSidebar();
    console.log('âœ… ä¾§è¾¹æ æ‰“å¼€æˆåŠŸ');
    sendResponse({ success: true });
  } catch (error) {
    console.error('âŒ ä¾§è¾¹æ æ‰“å¼€å¤±è´¥:', error);
    sendResponse({ success: false, error: error.message });
  }
  return true;
```

### 2. é‡å†™æµ®åŠ¨å›¾æ ‡ç‚¹å‡»å¤„ç†
**Content.js å®Œå…¨é‡å†™**:
```javascript
async openSidebar() {
  // å¤šé‡å¤‡ç”¨ç­–ç•¥:
  // 1. å‘é€ç®€å•openSidebaræ¶ˆæ¯
  // 2. ç›´æ¥è°ƒç”¨sidePanel API
  // 3. æ˜¾ç¤ºç”¨æˆ·å¼•å¯¼
  
  let success = false;
  
  // æ–¹æ³•1: ç®€åŒ–çš„æ¶ˆæ¯å‘é€
  try {
    const response = await new Promise((resolve, reject) => {
      chrome.runtime.sendMessage({ action: 'openSidebar' }, (response) => {
        if (chrome.runtime.lastError) {
          reject(new Error(chrome.runtime.lastError.message));
        } else {
          resolve(response);
        }
      });
    });
    success = response && response.success;
  } catch (error1) {
    console.log('æ–¹æ³•1å¤±è´¥ï¼Œå°è¯•æ–¹æ³•2');
  }
  
  // æ–¹æ³•2: ç›´æ¥APIè°ƒç”¨
  if (!success) {
    try {
      const [currentTab] = await chrome.tabs.query({ active: true, currentWindow: true });
      if (currentTab && currentTab.id) {
        await chrome.sidePanel.open({ tabId: currentTab.id });
        success = true;
      }
    } catch (error2) {
      console.log('æ–¹æ³•2å¤±è´¥ï¼Œæ˜¾ç¤ºç”¨æˆ·å¼•å¯¼');
    }
  }
  
  // æ–¹æ³•3: ç”¨æˆ·å¼•å¯¼
  if (!success) {
    this.showManualTriggerHint();
  }
  
  return success;
}
```

### 3. æ‰©å±•æƒé™ä¼˜åŒ–
**Manifest.json ä¿®æ”¹**:
```json
"content_scripts": [
  {
    "matches": [
      "<all_urls>"
    ],
    "js": ["content.js"],
    "css": ["content.css"],
    "run_at": "document_end"
  }
]
```
ç°åœ¨content scriptåœ¨æ‰€æœ‰ç½‘ç«™è¿è¡Œï¼Œä¾¿äºæµ‹è¯•å’Œè°ƒè¯•ã€‚

### 4. å¢å¼ºæµ‹è¯•å’Œè°ƒè¯•
**æ–°å¢æµ‹è¯•è„šæœ¬**:
- ğŸ“ `quick-test.js` - ä¸“é—¨çš„å¿«é€Ÿæµ‹è¯•è„šæœ¬
- åŒ…å«4ç§ä¸åŒçš„æµ‹è¯•æ–¹æ³•
- æä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
- å¯ä»¥åœ¨ä»»ä½•é¡µé¢çš„æ§åˆ¶å°è¿è¡Œ

## ä¿®å¤ç­–ç•¥è¯´æ˜

### å¤šå±‚å¤‡ç”¨æœºåˆ¶
1. **ç¬¬ä¸€å±‚**: ç®€åŒ–çš„æ¶ˆæ¯ä¼ é€’åˆ°background script
2. **ç¬¬äºŒå±‚**: ç›´æ¥è°ƒç”¨chrome.sidePanel.open() API
3. **ç¬¬ä¸‰å±‚**: ç”¨æˆ·å‹å¥½çš„å¼•å¯¼æç¤º

### é”™è¯¯å¤„ç†æ”¹è¿›
- ä½¿ç”¨PromiseåŒ…è£…æ¶ˆæ¯å‘é€
- æ£€æŸ¥chrome.runtime.lastError
- æä¾›è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- ä¼˜é›…çš„é™çº§å¤„ç†

### æµ‹è¯•å’ŒéªŒè¯å¢å¼º
- åŸºæœ¬çŠ¶æ€æ£€æŸ¥ï¼ˆAPIså¯ç”¨æ€§ï¼‰
- æ¶ˆæ¯å‘é€æµ‹è¯•
- ç›´æ¥æ–¹æ³•è°ƒç”¨æµ‹è¯•
- æ¨¡æ‹Ÿç‚¹å‡»æµ‹è¯•

## ä½¿ç”¨è¯´æ˜

### éƒ¨ç½²æ­¥éª¤
1. **é‡æ–°åŠ è½½æ‰©å±•**
   ```
   Chromeæ‰©å±•ç®¡ç†é¡µé¢ -> é‡æ–°åŠ è½½
   ```

2. **æµ‹è¯•åŸºæœ¬åŠŸèƒ½**
   - è®¿é—®ä»»ä½•ç½‘é¡µ
   - æ£€æŸ¥æ˜¯å¦å‡ºç°æµ®åŠ¨å›¾æ ‡
   - ç‚¹å‡»æµ®åŠ¨å›¾æ ‡æµ‹è¯•

3. **è¿è¡Œè°ƒè¯•æµ‹è¯•**
   ```javascript
   // åœ¨æ§åˆ¶å°å¤åˆ¶ç²˜è´´ quick-test.js å†…å®¹
   // æˆ–è€…è¿è¡Œ:
   window.quickTest.runQuickTests();
   ```

### é¢„æœŸè¡Œä¸º

#### æˆåŠŸåœºæ™¯
- ç‚¹å‡»æµ®åŠ¨å›¾æ ‡ â†’ ä¾§è¾¹æ ç›´æ¥æ‰“å¼€
- æ§åˆ¶å°æ˜¾ç¤ºæˆåŠŸæ—¥å¿—
- æ— é”™è¯¯æç¤º

#### é™çº§åœºæ™¯
- ç‚¹å‡»æµ®åŠ¨å›¾æ ‡ â†’ æ˜¾ç¤ºå¼•å¯¼æç¤º
- ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»å·¥å…·æ å›¾æ ‡
- ä¾§è¾¹æ æ­£å¸¸æ‰“å¼€å¹¶æ˜¾ç¤ºDOIä¿¡æ¯

#### é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- ç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯
- ä¸ä¼šå½±å“å…¶ä»–åŠŸèƒ½

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

- âœ… `content.js` - å®Œå…¨é‡å†™openSidebaræ–¹æ³•
- âœ… `background.js` - ç®€åŒ–æ¶ˆæ¯å¤„ç†é€»è¾‘
- âœ… `manifest.json` - content_scriptsæ”¯æŒæ‰€æœ‰URL
- âœ… `quick-test.js` - æ–°å¢ä¸“é—¨çš„æµ‹è¯•è„šæœ¬
- âœ… æœ¬ä¿®å¤æŠ¥å‘Š

## æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶æ— æ³•å·¥ä½œ
1. **æ£€æŸ¥æ‰©å±•æ˜¯å¦æ­£ç¡®åŠ è½½**
   ```javascript
   console.log(chrome.runtime.getManifest());
   ```

2. **éªŒè¯æƒé™è®¾ç½®**
   ```javascript
   chrome.permissions.getAll(console.log);
   ```

3. **é‡å¯æµè§ˆå™¨**
   æŸäº›Chromeæ›´æ–°éœ€è¦é‡å¯æµè§ˆå™¨æ‰èƒ½ç”Ÿæ•ˆ

4. **æŸ¥çœ‹æ‰©å±•é”™è¯¯**
   Chromeæ‰©å±•ç®¡ç†é¡µé¢ -> é”™è¯¯

### å¸¸è§é—®é¢˜è§£ç­”

**Q: æµ®åŠ¨å›¾æ ‡ä¸å‡ºç°ï¼Ÿ**
A: æ£€æŸ¥content scriptæ˜¯å¦åŠ è½½ï¼Œè¿è¡Œ`console.log(window.researchopiaContentScript)`

**Q: ç‚¹å‡»æ²¡æœ‰ååº”ï¼Ÿ**
A: æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œè¿è¡Œæµ‹è¯•è„šæœ¬è¯Šæ–­é—®é¢˜

**Q: ä¾§è¾¹æ æ‰“å¼€ä½†æ˜¾ç¤ºç©ºç™½ï¼Ÿ**
A: è¿™æ˜¯sidebar.htmlçš„é—®é¢˜ï¼Œä¸æ˜¯æµ®åŠ¨å›¾æ ‡çš„é—®é¢˜

## æŠ€æœ¯æ€»ç»“

è¿™æ¬¡ä¿®å¤é‡‡ç”¨äº†ä»¥ä¸‹æ ¸å¿ƒç­–ç•¥ï¼š
1. **ç®€åŒ–å¤æ‚åº¦** - ç§»é™¤äº†è¿‡åº¦å¤æ‚çš„å¼‚æ­¥å¤„ç†
2. **å¤šé‡å¤‡ç”¨** - æä¾›3ç§ä¸åŒçš„ä¾§è¾¹æ æ‰“å¼€æ–¹å¼
3. **å¢å¼ºè°ƒè¯•** - æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—å’Œæµ‹è¯•å·¥å…·
4. **æ‰©å±•å…¼å®¹** - æ”¯æŒæ‰€æœ‰ç½‘ç«™è¿è¡Œï¼Œä¾¿äºæµ‹è¯•
5. **ç”¨æˆ·å‹å¥½** - æä¾›æ¸…æ™°çš„é”™è¯¯å¤„ç†å’Œå¼•å¯¼

---
æœ€ç»ˆä¿®å¤å®Œæˆæ—¶é—´ï¼š2025-09-14  
ä¿®å¤ç‰ˆæœ¬ï¼šv3.0 - å®Œæ•´é‡æ„ç‰ˆ