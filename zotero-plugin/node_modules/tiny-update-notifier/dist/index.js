var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},s=(n,r,a)=>(a=n==null?{}:e(i(n)),o(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));const c=s(require(`https`)),l=s(require(`fs`)),u=s(require(`path`)),d=s(require(`os`)),f=s(require(`semiff`));function p(e,t=`latest`,n=3e4){let r=`https://registry.npmjs.org/-/package/${e}/dist-tags`;return new Promise((e,i)=>{let a=c.default.get(r,n=>{let r=``;n.on(`data`,e=>r+=e).on(`end`,()=>{try{let n=JSON.parse(r),a=n[t];a?e(a):i(Error(`Couldn't get version for dist-tag: ${t}`))}catch(e){i(e)}}).on(`error`,i)}),o=setTimeout(()=>{a.destroy(),i(Error(`Request timed out`))},n);a.on(`close`,()=>{clearTimeout(o)})})}const m=d.default.homedir();function h(e){let t=process.env.LOCALAPPDATA||u.default.join(m,`AppData`,`Local`);return u.default.join(t,e,`Cache`)}function g(e){return u.default.join(process.env.XDG_CACHE_HOME||u.default.join(m,`.cache`),e)}function _(e){return u.default.join(m,`Library`,`Caches`,e)}function v(e){switch(process.platform){case`win32`:return h(e);case`darwin`:return _(e);default:return g(e)}}var y=class{dir;fp;constructor(e){this.dir=v(`tiny-update-notifier`),this.fp=u.default.join(this.dir,`${e.name}`),l.default.existsSync(this.dir)||l.default.mkdirSync(this.dir,{recursive:!0})}async create(){if(l.default.existsSync(this.fp))try{let e=await this.read();if(e&&!isNaN(e))return}catch{await l.default.promises.unlink(this.fp)}await this.update()}async read(){return+await l.default.promises.readFile(this.fp,`utf8`)}async update(){await l.default.promises.writeFile(this.fp,``+Date.now(),`utf8`)}};async function b(e){if(!e||!e.pkg||!e.pkg.name||!e.pkg.version)throw Error(`pkg.name and pkg.version are required`);let t;if(e={cache:!0,checkInterval:60*60*24*1e3,...e},e.cache){t=new y(e.pkg);try{let n=await t.read();if(n+e.checkInterval>Date.now())return!1}catch{await t.create()}}let n=await p(e.pkg.name,e.distTag,e.timeout);await t?.update();let r=(0,f.default)(e.pkg.version,n);return r?{name:e.pkg.name,current:e.pkg.version,latest:n,type:r}:!1}module.exports=b;