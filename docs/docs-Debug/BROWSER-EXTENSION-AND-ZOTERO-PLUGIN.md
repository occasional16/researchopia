# æµè§ˆå™¨æ‰©å±•ä¸ Zotero æ’ä»¶å¼€å‘æ–‡æ¡£

æœ¬æ–‡æ¡£æ•´åˆäº† Researchopia é¡¹ç›®çš„**æµè§ˆå™¨æ‰©å±•**å’Œ **Zotero æ’ä»¶**ä¸¤å¤§å®¢æˆ·ç«¯ç»„ä»¶çš„è¯¦ç»†å¼€å‘å’Œä½¿ç”¨æŒ‡å—ã€‚

---

## ç›®å½•

### ç¬¬ä¸€éƒ¨åˆ†ï¼šæµè§ˆå™¨æ‰©å±•
1. [æ‰©å±•ç®€ä»‹](#æ‰©å±•ç®€ä»‹)
2. [æ‰©å±•ä¸»è¦åŠŸèƒ½](#æ‰©å±•ä¸»è¦åŠŸèƒ½)
3. [æ‰©å±•å®‰è£…æ–¹æ³•](#æ‰©å±•å®‰è£…æ–¹æ³•)
4. [æ‰©å±•ä½¿ç”¨æŒ‡å—](#æ‰©å±•ä½¿ç”¨æŒ‡å—)
5. [æ‰©å±•æŠ€æœ¯ç‰¹æ€§](#æ‰©å±•æŠ€æœ¯ç‰¹æ€§)
6. [æ‰©å±•å¼€å‘è¯´æ˜](#æ‰©å±•å¼€å‘è¯´æ˜)

### ç¬¬äºŒéƒ¨åˆ†ï¼šZotero æ’ä»¶
7. [æ’ä»¶ç®€ä»‹](#æ’ä»¶ç®€ä»‹)
8. [æ’ä»¶æ ¸å¿ƒåŠŸèƒ½](#æ’ä»¶æ ¸å¿ƒåŠŸèƒ½)
9. [æ’ä»¶å®‰è£…æ–¹æ³•](#æ’ä»¶å®‰è£…æ–¹æ³•)
10. [æ’ä»¶å¼€å‘æŒ‡å—](#æ’ä»¶å¼€å‘æŒ‡å—)
11. [æ’ä»¶é…ç½®è¯´æ˜](#æ’ä»¶é…ç½®è¯´æ˜)
12. [æ’ä»¶æ•°æ®åº“æ¶æ„](#æ’ä»¶æ•°æ®åº“æ¶æ„)
13. [é—®é¢˜æ’æŸ¥](#é—®é¢˜æ’æŸ¥)

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šæµè§ˆå™¨æ‰©å±•

<a name="æ‰©å±•ç®€ä»‹"></a>
## 1. æ‰©å±•ç®€ä»‹

**ç ”å­¦æ¸¯æµè§ˆå™¨æ‰©å±•** æ˜¯ç ”å­¦æ¸¯ï¼ˆResearchopiaï¼‰çš„å®˜æ–¹æµè§ˆå™¨æ’ä»¶ï¼ŒåŸºäºæœ€æ–°çš„ **Manifest V3** è§„èŒƒå¼€å‘ã€‚æ‰©å±•æ—¨åœ¨ä¸ºå­¦æœ¯ç ”ç©¶è€…æä¾›ä¾¿æ·çš„è®ºæ–‡æœç´¢å’Œç®¡ç†å·¥å…·ï¼Œå®ç°"ç ”å­¦å¹¶è¿›,æ™ºæ…§å…±äº«"çš„ç†å¿µã€‚

**æ ¸å¿ƒä»·å€¼**:
- ğŸ” è‡ªåŠ¨æ£€æµ‹å­¦æœ¯ç½‘é¡µä¸­çš„ DOI
- ğŸ“Œ æä¾›æ‚¬æµ®æ‹–æ‹½å›¾æ ‡å¿«é€Ÿè®¿é—®
- ğŸ“– é›†æˆä¾§è¾¹æ æ— ç¼å¯¹æ¥ç ”å­¦æ¸¯ç½‘ç«™
- ğŸš€ ä¸€é”®æœç´¢è®ºæ–‡è¯¦æƒ…å’Œç¤¾åŒºæ ‡æ³¨

<a name="æ‰©å±•ä¸»è¦åŠŸèƒ½"></a>
## 2. æ‰©å±•ä¸»è¦åŠŸèƒ½

### 2.1 æ™ºèƒ½ DOI æ£€æµ‹

- **è‡ªåŠ¨æ£€æµ‹**: é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰«æ DOI
- **å¤šæºæ”¯æŒ**: 
  - HTML meta æ ‡ç­¾ (`<meta name="citation_doi">`)
  - JSON-LD ç»“æ„åŒ–æ•°æ® (`@type: ScholarlyArticle`)
  - é¡µé¢æ–‡æœ¬ä¸­çš„ DOI æ ¼å¼ (`10.xxxx/xxxxx`)
  - URL è·¯å¾„ä¸­çš„ DOI (`/doi/10.xxxx/`)
- **å¹¿æ³›å…¼å®¹**: è¦†ç›–ä¸»æµå­¦æœ¯å‡ºç‰ˆå•†ç½‘ç«™

**æ”¯æŒçš„ç½‘ç«™**:
- Nature (nature.com)
- Science (science.org)
- IEEE (ieee.org)
- Springer (springer.com)
- ScienceDirect (sciencedirect.com)
- Wiley (wiley.com)
- Taylor & Francis (tandfonline.com)
- ACM (acm.org)
- arXiv (arxiv.org)
- PubMed (pubmed.ncbi.nlm.nih.gov)
- DOI.org (doi.org)

### 2.2 æ‚¬æµ®æ‹–æ‹½å›¾æ ‡

- **å¸¸é©»æ˜¾ç¤º**: é»˜è®¤æ˜¾ç¤ºåœ¨ç½‘é¡µå³ä¸Šè§’
- **æ‹–æ‹½ç§»åŠ¨**: é•¿æŒ‰å›¾æ ‡å¯è‡ªç”±æ‹–æ‹½
- **æ™ºèƒ½å¸é™„**: è‡ªåŠ¨å¸é™„åˆ°çª—å£å·¦å³è¾¹ç¼˜
- **çŠ¶æ€æŒ‡ç¤º**: 
  - ç»¿è‰²æŒ‡ç¤ºå™¨: æ£€æµ‹åˆ° DOI
  - ç°è‰²: æœªæ£€æµ‹åˆ° DOI
- **å¿«é€Ÿè®¿é—®**: ç‚¹å‡»å›¾æ ‡æ‰“å¼€ç ”å­¦æ¸¯ä¾§è¾¹æ 

### 2.3 é›†æˆä¾§è¾¹æ 

- **ä¸€é”®æ‰“å¼€**: ç‚¹å‡»æ‚¬æµ®å›¾æ ‡å±•å¼€ä¾§è¾¹æ 
- **åµŒå…¥å¼æµè§ˆ**: ç›´æ¥åœ¨ä¾§è¾¹æ åŠ è½½ç ”å­¦æ¸¯ç½‘ç«™
- **è‡ªåŠ¨æœç´¢**: æ£€æµ‹åˆ° DOI æ—¶è‡ªåŠ¨å¡«å…¥æœç´¢æ¡†
- **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **ç‹¬ç«‹äº¤äº’**: ä¸å½±å“å½“å‰ç½‘é¡µæµè§ˆ

### 2.4 å¿«é€Ÿæœç´¢

- **æ–°æ ‡ç­¾é¡µæœç´¢**: ç‚¹å‡»å¼¹çª—ä¸­çš„æœç´¢æŒ‰é’®
- **è‡ªåŠ¨å‚æ•°**: è‡ªåŠ¨å¡«å…¥æ£€æµ‹åˆ°çš„ DOI
- **æ™ºèƒ½è·³è½¬**: ç›´æ¥æ‰“å¼€è®ºæ–‡è¯¦æƒ…é¡µ

<a name="æ‰©å±•å®‰è£…æ–¹æ³•"></a>
## 3. æ‰©å±•å®‰è£…æ–¹æ³•

### 3.1 å¼€å‘è€…æ¨¡å¼å®‰è£…

**é€‚ç”¨äº**: æœ¬åœ°å¼€å‘ã€æµ‹è¯•ç‰ˆæœ¬

**æ­¥éª¤**:
1. æ‰“å¼€ Chrome æµè§ˆå™¨
2. åœ¨åœ°å€æ è¾“å…¥ `chrome://extensions/`
3. å¼€å¯å³ä¸Šè§’"å¼€å‘è€…æ¨¡å¼"å¼€å…³
4. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
5. é€‰æ‹©é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `extension/` æ–‡ä»¶å¤¹
6. æ‰©å±•å®‰è£…å®Œæˆ,å›¾æ ‡å°†å‡ºç°åœ¨å·¥å…·æ 

### 3.2 Chrome Web Store å®‰è£…

**é€‚ç”¨äº**: æ­£å¼å‘å¸ƒç‰ˆæœ¬

> ğŸ“ æ³¨æ„: ç›®å‰æ‰©å±•å°šæœªå‘å¸ƒåˆ° Chrome Web Store,è¯·ä½¿ç”¨å¼€å‘è€…æ¨¡å¼å®‰è£…ã€‚

**æœªæ¥æ­¥éª¤** (å¾…å‘å¸ƒ):
1. è®¿é—® Chrome Web Store æœç´¢"Researchopia"
2. ç‚¹å‡»"æ·»åŠ è‡³ Chrome"
3. ç¡®è®¤æƒé™è¯·æ±‚
4. å®‰è£…å®Œæˆ

### 3.3 æœåŠ¡å™¨é…ç½®

æ‰©å±•æ”¯æŒè¿æ¥åˆ°:
- **ç”Ÿäº§æœåŠ¡å™¨**(é»˜è®¤): `https://www.researchopia.com`
- **å¤‡ç”¨æœåŠ¡å™¨**: `https://researchopia.vercel.app`
- **æœ¬åœ°å¼€å‘æœåŠ¡å™¨**: `http://localhost:3000-3009`

å¯ä»¥åœ¨æ‰©å±•å¼¹çª—ä¸­åˆ‡æ¢æœåŠ¡å™¨åœ°å€ã€‚

<a name="æ‰©å±•ä½¿ç”¨æŒ‡å—"></a>
## 4. æ‰©å±•ä½¿ç”¨æŒ‡å—

### 4.1 åŸºæœ¬ä½¿ç”¨æµç¨‹

#### åœºæ™¯ 1: è®¿é—®å­¦æœ¯ç½‘é¡µ

```
1. æ‰“å¼€å­¦æœ¯è®ºæ–‡é¡µé¢(å¦‚ Nature æ–‡ç« )
   â†“
2. æ‰©å±•è‡ªåŠ¨æ£€æµ‹ DOI
   â†“
3. æ‚¬æµ®å›¾æ ‡æ˜¾ç¤ºç»¿è‰²æŒ‡ç¤ºå™¨
   â†“
4. ç‚¹å‡»å›¾æ ‡æ‰“å¼€ä¾§è¾¹æ 
   â†“
5. è‡ªåŠ¨æœç´¢å¹¶æ˜¾ç¤ºè®ºæ–‡è¯¦æƒ…
```

#### åœºæ™¯ 2: æ‰‹åŠ¨æœç´¢

```
1. ç‚¹å‡»æ‰©å±•å›¾æ ‡(å·¥å…·æ )
   â†“
2. æŸ¥çœ‹æ£€æµ‹çŠ¶æ€
   â†“
3. ç‚¹å‡»"æœç´¢"æŒ‰é’®
   â†“
4. æ–°æ ‡ç­¾é¡µæ‰“å¼€ç ”å­¦æ¸¯ç½‘ç«™
```

### 4.2 é«˜çº§åŠŸèƒ½

**æ‹–æ‹½å®šä½**:
- é•¿æŒ‰æ‚¬æµ®å›¾æ ‡ > æ‹–æ‹½åˆ°ä»»æ„ä½ç½® > é‡Šæ”¾è‡ªåŠ¨å¸é™„

**è®¾ç½®ç®¡ç†**:
- `chrome://extensions/` > æ‰¾åˆ° Researchopia > è¯¦æƒ…
- å¯è°ƒæ•´æƒé™ã€æ‚¬æµ®å›¾æ ‡æ˜¾ç¤ºç­‰è®¾ç½®

**å¿«æ·é”®**(æœªæ¥æ”¯æŒ):
- `Ctrl+Shift+R`: æ‰“å¼€/å…³é—­ä¾§è¾¹æ 
- `Ctrl+Shift+S`: å¿«é€Ÿæœç´¢å½“å‰ DOI

<a name="æ‰©å±•æŠ€æœ¯ç‰¹æ€§"></a>
## 5. æ‰©å±•æŠ€æœ¯ç‰¹æ€§

- âœ… **Manifest V3**: ç¬¦åˆæœ€æ–° Chrome æ‰©å±•æ ‡å‡†
- âœ… **æƒé™æœ€å°åŒ–**: ä»…è¯·æ±‚å¿…è¦æƒé™(`activeTab`, `storage`, `scripting`)
- âœ… **å“åº”å¼è®¾è®¡**: æ”¯æŒå„ç§å±å¹•å°ºå¯¸
- âœ… **æ·±è‰²æ¨¡å¼æ”¯æŒ**: è‡ªåŠ¨é€‚é…ç³»ç»Ÿä¸»é¢˜
- âœ… **é«˜å¯¹æ¯”åº¦æ¨¡å¼**: æ— éšœç¢è®¿é—®æ”¯æŒ
- âœ… **ä¼˜é›…åŠ¨ç”»**: æµç•…çš„ç”¨æˆ·äº¤äº’ä½“éªŒ
- âœ… **è·¨åŸŸå®‰å…¨**: ä¸¥æ ¼çš„ CSP ç­–ç•¥
- âœ… **æœ¬åœ°å­˜å‚¨**: ç”¨æˆ·é…ç½®æŒä¹…åŒ–ä¿å­˜

**æ–‡ä»¶ç»“æ„**:
```
extension/
â”œâ”€â”€ manifest.json          # æ‰©å±•æ¸…å•(Manifest V3)
â”œâ”€â”€ popup.html            # å¼¹çª—ç•Œé¢
â”œâ”€â”€ popup.js              # å¼¹çª—é€»è¾‘
â”œâ”€â”€ background.js         # Service Worker(åå°è„šæœ¬)
â”œâ”€â”€ content.js            # å†…å®¹è„šæœ¬(DOIæ£€æµ‹)
â”œâ”€â”€ content.css           # æ‚¬æµ®å›¾æ ‡æ ·å¼
â”œâ”€â”€ sidebar.html          # ä¾§è¾¹æ ç•Œé¢
â”œâ”€â”€ sidebar.js            # ä¾§è¾¹æ é€»è¾‘
â”œâ”€â”€ welcome.html          # æ¬¢è¿é¡µé¢
â”œâ”€â”€ welcome.js            # æ¬¢è¿é¡µé¢é€»è¾‘
â”œâ”€â”€ icons/                # å›¾æ ‡èµ„æº
â”‚   â”œâ”€â”€ icon16.png
â”‚   â”œâ”€â”€ icon32.png
â”‚   â”œâ”€â”€ icon48.png
â”‚   â””â”€â”€ icon128.png
â””â”€â”€ _locales/             # å›½é™…åŒ–
    â”œâ”€â”€ en/
    â”‚   â””â”€â”€ messages.json
    â””â”€â”€ zh_CN/
        â””â”€â”€ messages.json
```

<a name="æ‰©å±•å¼€å‘è¯´æ˜"></a>
## 6. æ‰©å±•å¼€å‘è¯´æ˜

### 6.1 å¼€å‘ç¯å¢ƒ

**ä¾èµ–**:
- Chrome æµè§ˆå™¨ 88+ æˆ– Edge 88+
- ç ”å­¦æ¸¯æœ¬åœ°æœåŠ¡å™¨(å¯é€‰): `http://localhost:3000`

**è°ƒè¯•æ–¹æ³•**:

1. **æ‰©å±•å¼¹çª—è°ƒè¯•**:
   - å³é”®ç‚¹å‡»æ‰©å±•å›¾æ ‡ > "å®¡æŸ¥å¼¹å‡ºå†…å®¹"
   - æ‰“å¼€ DevTools æŸ¥çœ‹ `popup.js` æ—¥å¿—

2. **å†…å®¹è„šæœ¬è°ƒè¯•**:
   - åœ¨ç›®æ ‡ç½‘é¡µæŒ‰ F12
   - Console ä¸­æŸ¥çœ‹ `[Content Script]` å‰ç¼€çš„æ—¥å¿—

3. **åå°è„šæœ¬è°ƒè¯•**:
   - `chrome://extensions/` > Researchopia > "Service Worker"
   - ç‚¹å‡»"æ£€æŸ¥è§†å›¾"é“¾æ¥æ‰“å¼€ DevTools

### 6.2 è‡ªå®šä¹‰é…ç½®

æ‰©å±•ä½¿ç”¨ Chrome Storage API è¿›è¡Œé…ç½®ç®¡ç†:

```javascript
// è·å–å½“å‰é…ç½®
chrome.storage.sync.get([
  'floatingEnabled',    // æ˜¯å¦æ˜¾ç¤ºæ‚¬æµ®å›¾æ ‡
  'researchopiaUrl',    // ç ”å­¦æ¸¯æœåŠ¡å™¨åœ°å€
  'autoDetectDOI',      // æ˜¯å¦è‡ªåŠ¨æ£€æµ‹ DOI
  'sidebarWidth'        // ä¾§è¾¹æ å®½åº¦
], (result) => {
  console.log('å½“å‰é…ç½®:', result);
});

// æ›´æ–°é…ç½®
chrome.storage.sync.set({
  researchopiaUrl: 'https://www.researchopia.com',
  autoDetectDOI: true
});
```

### 6.3 æ ¸å¿ƒä»£ç è§£æ

**DOI æ£€æµ‹é€»è¾‘** (`content.js`):
```javascript
function detectDOI() {
  // 1. æ£€æµ‹ meta æ ‡ç­¾
  let doi = document.querySelector('meta[name="citation_doi"]')?.content;
  
  // 2. æ£€æµ‹ JSON-LD
  if (!doi) {
    const jsonLd = document.querySelector('script[type="application/ld+json"]');
    if (jsonLd) {
      const data = JSON.parse(jsonLd.textContent);
      doi = data.doi || data['@id'];
    }
  }
  
  // 3. æ£€æµ‹é¡µé¢æ–‡æœ¬
  if (!doi) {
    const bodyText = document.body.innerText;
    const match = bodyText.match(/10\.\d{4,9}\/[-._;()/:A-Z0-9]+/i);
    doi = match?.[0];
  }
  
  return doi;
}
```

**æ¶ˆæ¯ä¼ é€’** (Content Script â†” Background):
```javascript
// content.js - å‘é€æ¶ˆæ¯
chrome.runtime.sendMessage({
  type: 'DOI_DETECTED',
  doi: detectedDOI
});

// background.js - æ¥æ”¶æ¶ˆæ¯
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (message.type === 'DOI_DETECTED') {
    console.log('æ£€æµ‹åˆ° DOI:', message.doi);
    // æ›´æ–°å›¾æ ‡çŠ¶æ€
    updateIcon(sender.tab.id, message.doi);
  }
});
```

### 6.4 ç‰ˆæœ¬å‘å¸ƒ

**æ‰“åŒ…æ‰©å±•**:
```bash
# å‹ç¼© extension ç›®å½•
cd extension
zip -r researchopia-extension.zip . -x "*.DS_Store" "*.git*"
```

**æäº¤åˆ° Chrome Web Store**:
1. è®¿é—® [Chrome Developer Dashboard](https://chrome.google.com/webstore/devconsole)
2. ä¸Šä¼  ZIP æ–‡ä»¶
3. å¡«å†™å•†åº—è¯¦æƒ…(æè¿°ã€æˆªå›¾ã€æƒé™è¯´æ˜)
4. æäº¤å®¡æ ¸

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šZotero æ’ä»¶

<a name="æ’ä»¶ç®€ä»‹"></a>
## 7. æ’ä»¶ç®€ä»‹

**Researchopia Zotero Plugin** æ˜¯ç ”å­¦æ¸¯çš„æ¡Œé¢å®¢æˆ·ç«¯ç»„ä»¶,ä¸º Zotero ç”¨æˆ·æä¾›æ ‡æ³¨å…±äº«å’Œå®æ—¶åä½œåŠŸèƒ½ã€‚æ’ä»¶å®Œå…¨å…¼å®¹ **Zotero 8 Beta**,æ”¯æŒå‘ä¸‹å…¼å®¹ Zotero 7ã€‚

**æ ¸å¿ƒä»·å€¼**:
- ğŸ“ åŒæ­¥ Zotero PDF æ ‡æ³¨åˆ°ç ”å­¦æ¸¯äº‘ç«¯
- ğŸŒ æŸ¥çœ‹å…¶ä»–ç ”ç©¶è€…çš„ç¤¾åŒºæ ‡æ³¨
- ğŸ’¬ å®æ—¶åä½œ(å…±è¯»ä¼šè¯ã€èŠå¤©ã€äº‹ä»¶æ—¶é—´è½´)
- ğŸ† æ ‡æ³¨è´¨é‡è¯„åˆ†å’Œæ’åº
- ğŸ”” å®æ—¶æ›´æ–°é€šçŸ¥

<a name="æ’ä»¶æ ¸å¿ƒåŠŸèƒ½"></a>
## 8. æ’ä»¶æ ¸å¿ƒåŠŸèƒ½

### 8.1 æ ‡æ³¨å…±äº«

**åŠŸèƒ½æè¿°**:
- è‡ªåŠ¨æå– Zotero PDF æ ‡æ³¨
- ä¸€é”®ä¸Šä¼ åˆ°ç ”å­¦æ¸¯äº‘ç«¯
- æ”¯æŒé«˜äº®ã€ä¾¿ç­¾ã€æ–‡æœ¬é€‰æ‹©ç­‰å¤šç§æ ‡æ³¨ç±»å‹

**ä½¿ç”¨æ–¹æ³•**:
1. åœ¨ Zotero ä¸­æ‰“å¼€ PDF å¹¶æ·»åŠ æ ‡æ³¨
2. å³é”®ç‚¹å‡»æ–‡çŒ® â†’ "Share My Annotations"
3. æ ‡æ³¨è‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯

### 8.2 ç¤¾åŒºæ ‡æ³¨æŸ¥çœ‹

**åŠŸèƒ½æè¿°**:
- æŸ¥çœ‹åŒä¸€è®ºæ–‡(DOI)çš„æ‰€æœ‰ç¤¾åŒºæ ‡æ³¨
- å®æ—¶æ›´æ–°å…¶ä»–ç”¨æˆ·çš„æ–°æ ‡æ³¨
- æ™ºèƒ½æ’åº(è´¨é‡è¯„åˆ†ã€æ—¶é—´ã€ç‚¹èµæ•°)

**æ˜¾ç¤ºä½ç½®**:
- Zotero é¡¹ç›®é¢æ¿(Item Pane) â†’ "Community Annotations" æ ‡ç­¾é¡µ

### 8.3 ç¤¾äº¤äº’åŠ¨

**äº’åŠ¨åŠŸèƒ½**:
- â¤ï¸ ç‚¹èµæ ‡æ³¨
- ğŸ’¬ è¯„è®ºæ ‡æ³¨
- ğŸ‘¤ å…³æ³¨æ ‡æ³¨ä½œè€…
- ğŸ“Š æŸ¥çœ‹è´¨é‡è¯„åˆ†

### 8.4 å…±è¯»ä¼šè¯

**å®æ—¶åä½œ**:
- åˆ›å»ºå…¬å¼€/ç§å¯†å…±è¯»ä¼šè¯
- é‚€è¯·ç é‚€è¯·æˆå‘˜åŠ å…¥
- å®æ—¶åŒæ­¥æ ‡æ³¨ã€èŠå¤©æ¶ˆæ¯ã€æˆå‘˜çŠ¶æ€
- äº‹ä»¶æ—¶é—´è½´è®°å½•æ‰€æœ‰æ´»åŠ¨

**ä¼šè¯ç±»å‹**:
- **å…¬å¼€ä¼šè¯**: ä»»ä½•äººå¯åŠ å…¥
- **ç§å¯†ä¼šè¯**: éœ€è¦é‚€è¯·ç 

<a name="æ’ä»¶å®‰è£…æ–¹æ³•"></a>
## 9. æ’ä»¶å®‰è£…æ–¹æ³•

### 9.1 æ™®é€šç”¨æˆ·å®‰è£…

**ä» Releases å®‰è£…**(æ¨è):
1. è®¿é—® [GitHub Releases](https://github.com/occasional16/researchopia/releases)
2. ä¸‹è½½æœ€æ–°çš„ `.xpi` æ–‡ä»¶
3. åœ¨ Zotero ä¸­: å·¥å…· â†’ é™„åŠ ç»„ä»¶
4. ç‚¹å‡»é½¿è½®å›¾æ ‡ â†’ "Install Add-on From File"
5. é€‰æ‹©ä¸‹è½½çš„ `.xpi` æ–‡ä»¶
6. é‡å¯ Zotero

### 9.2 å¼€å‘è€…å®‰è£…

**å‰ç½®è¦æ±‚**:
- [Zotero 8 Beta](https://www.zotero.org/support/beta_builds) (æˆ– Zotero 7)
- [Node.js](https://nodejs.org/) v18+
- [Git](https://git-scm.com/)

**å®‰è£…æ­¥éª¤**:
```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/occasional16/researchopia.git
cd researchopia/zotero-plugin

# 2. å®‰è£…ä¾èµ–
npm install

# 3. é…ç½®ç¯å¢ƒ(å¯é€‰)
cp .env.template .env
# ç¼–è¾‘ .env è®¾ç½® Zotero è·¯å¾„å’Œ Supabase é…ç½®
```

<a name="æ’ä»¶å¼€å‘æŒ‡å—"></a>
## 10. æ’ä»¶å¼€å‘æŒ‡å—

### 10.1 çƒ­é‡è½½å¼€å‘

æ’ä»¶æ”¯æŒ**çƒ­é‡è½½**(hot reload)åŠŸèƒ½,å¤§å¹…æå‡å¼€å‘æ•ˆç‡:

```bash
# å¯åŠ¨çƒ­é‡è½½å¼€å‘æ¨¡å¼
npm start
```

**å·¥ä½œåŸç†**:
1. ç›‘å¬ `src/` å’Œ `addon/` ç›®å½•çš„æ–‡ä»¶å˜æ›´
2. è‡ªåŠ¨é‡æ–°ç¼–è¯‘æ’ä»¶
3. è‡ªåŠ¨é‡å¯ Zotero å¹¶é‡è½½æ’ä»¶
4. æ˜¾ç¤ºè¯¦ç»†çš„ç¼–è¯‘æ—¥å¿—

**ä¼˜åŠ¿**:
- æ— éœ€æ‰‹åŠ¨é‡å¯ Zotero
- å³æ—¶æŸ¥çœ‹ä»£ç æ›´æ”¹æ•ˆæœ
- æé«˜å¼€å‘è¿­ä»£é€Ÿåº¦

### 10.2 æ„å»ºå’Œæ‰“åŒ…

**å¼€å‘ç‰ˆæœ¬æ„å»º**:
```bash
npm run build
```

**ç”Ÿäº§ç‰ˆæœ¬æ„å»º**:
```bash
npm run build:prod
```

**ç”Ÿæˆ XPI åŒ…**(ç”¨äºå‘å¸ƒ):
```bash
npm run release

# è¾“å‡º: build/researchopia.xpi
```

### 10.3 æµ‹è¯•å’Œè°ƒè¯•

**å•å…ƒæµ‹è¯•**:
```bash
npm test
```

**ä»£ç æ£€æŸ¥**:
```bash
# æ£€æŸ¥ä»£ç è§„èŒƒ
npm run lint:check

# è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
npm run lint:fix
```

**è°ƒè¯•æ—¥å¿—**:
- Zotero èœå• â†’ å¸®åŠ© â†’ Debug Output Logging â†’ View Output
- æˆ–åœ¨ä»£ç ä¸­ä½¿ç”¨ `logger.log()` (æ’ä»¶å†…ç½®æ—¥å¿—å·¥å…·)

**æ–­ç‚¹è°ƒè¯•**:
- å·¥å…· â†’ å¼€å‘è€… â†’ Error Console
- åœ¨ä»£ç ä¸­æ·»åŠ  `debugger;` è¯­å¥

### 10.4 æ ¸å¿ƒæ¶æ„

æ’ä»¶é‡‡ç”¨ **MVC + Service Layer** æ¶æ„:

```
src/
â”œâ”€â”€ addon.ts                # æ’ä»¶å…¥å£,ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”œâ”€â”€ modules/                # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ auth.ts            # è®¤è¯ç®¡ç†å™¨
â”‚   â”œâ”€â”€ ui-manager.ts      # UI ç®¡ç†å™¨(æ³¨å†Œè§†å›¾)
â”‚   â”œâ”€â”€ readingSessionManager.ts  # å…±è¯»ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ supabaseManager.ts # æ•°æ®åº“æ“ä½œå°è£…
â”‚   â”œâ”€â”€ paperRegistry.ts   # è®ºæ–‡æ³¨å†ŒæœåŠ¡
â”‚   â”œâ”€â”€ pdfReaderManager.ts # PDF é˜…è¯»å™¨é›†æˆ
â”‚   â””â”€â”€ ui/                # UI è§†å›¾å±‚
â”‚       â”œâ”€â”€ readingSessionView.ts   # ä¼šè¯ä¸»è§†å›¾
â”‚       â”œâ”€â”€ sharedAnnotationsView.ts # ç¤¾åŒºæ ‡æ³¨è§†å›¾
â”‚       â”œâ”€â”€ myAnnotationsView.ts    # æˆ‘çš„æ ‡æ³¨
â”‚       â””â”€â”€ sessionListView.ts      # ä¼šè¯åˆ—è¡¨
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ apiClient.ts      # API å®¢æˆ·ç«¯(Next.js ä»£ç†)
â”‚   â”œâ”€â”€ logger.ts         # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ helpers.ts        # é€šç”¨å·¥å…·
â””â”€â”€ config/                # é…ç½®æ–‡ä»¶
    â””â”€â”€ env.ts            # ç¯å¢ƒé…ç½®
```

**å…³é”®æ¨¡å—è¯´æ˜**:

1. **AuthManager**: 
   - ç®¡ç†ç”¨æˆ·ç™»å½•/æ³¨å†Œ
   - Token å­˜å‚¨å’Œåˆ·æ–°
   - ä¼šè¯çŠ¶æ€ç»´æŠ¤

2. **ReadingSessionManager**: 
   - åˆ›å»º/åŠ å…¥å…±è¯»ä¼šè¯
   - å®æ—¶åŒæ­¥æ ‡æ³¨å’ŒèŠå¤©
   - æˆå‘˜çŠ¶æ€ç®¡ç†

3. **SupabaseManager**: 
   - å°è£…æ•°æ®åº“æ“ä½œ
   - é€šè¿‡ Next.js API ä»£ç†è°ƒç”¨ Supabase
   - é”™è¯¯å¤„ç†å’Œé‡è¯•

4. **UIManager**: 
   - æ³¨å†Œ Zotero UI ç»„ä»¶
   - ç®¡ç†è§†å›¾ç”Ÿå‘½å‘¨æœŸ
   - åè°ƒè§†å›¾é—´é€šä¿¡

5. **PDFReaderManager**: 
   - ç›‘å¬ Zotero PDF æ ‡æ³¨äº‹ä»¶
   - æå–æ ‡æ³¨æ•°æ®
   - è§¦å‘åŒæ­¥æµç¨‹

<a name="æ’ä»¶é…ç½®è¯´æ˜"></a>
## 11. æ’ä»¶é…ç½®è¯´æ˜

### 11.1 ç¯å¢ƒå˜é‡é…ç½®

å¤åˆ¶ `.env.template` åˆ° `.env` å¹¶ç¼–è¾‘:

```bash
# Zotero å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„(å¼€å‘å¿…éœ€)
ZOTERO_PLUGIN_ZOTERO_BIN_PATH=C:\Program Files\Zotero\zotero.exe

# Supabase é…ç½®(å·²å¼ƒç”¨,ç°ä½¿ç”¨ Next.js API ä»£ç†)
# SUPABASE_URL=https://your-project.supabase.co
# SUPABASE_ANON_KEY=your-anon-key

# Next.js API æœåŠ¡å™¨åœ°å€(æ¨è)
NEXT_PUBLIC_API_URL=https://www.researchopia.com
```

### 11.2 æ’ä»¶é…ç½®æ–‡ä»¶

ç¼–è¾‘ `zotero-plugin.config.ts`:

```typescript
export default {
  name: "Researchopia",
  id: "researchopia@example.com",
  namespace: "researchopia",
  xpiName: "researchopia.xpi",
  updateURL: "https://example.com/updates.json",
  zoteroType: "beta", // æˆ– "release"
  profilePath: "D:\\Zotero\\Profile" // ä½ çš„ Zotero é…ç½®ç›®å½•
};
```

### 11.3 ç”¨æˆ·é¦–é€‰é¡¹

æ’ä»¶åœ¨ Zotero é¦–é€‰é¡¹ä¸­æä¾›é…ç½®ç•Œé¢:

- **è®¤è¯**: ç™»å½•/æ³¨å†Œç ”å­¦æ¸¯è´¦å·
- **åŒæ­¥è®¾ç½®**: è‡ªåŠ¨åŒæ­¥å¼€å…³ã€åŒæ­¥é¢‘ç‡
- **éšç§è®¾ç½®**: æ ‡æ³¨å¯è§æ€§(å…¬å¼€/ä»…å¥½å‹/ç§å¯†)
- **é€šçŸ¥è®¾ç½®**: æ–°è¯„è®ºã€æ–°å…³æ³¨è€…é€šçŸ¥

<a name="æ’ä»¶æ•°æ®åº“æ¶æ„"></a>
## 12. æ’ä»¶æ•°æ®åº“æ¶æ„

æ’ä»¶ä½¿ç”¨ **Supabase PostgreSQL** ä½œä¸ºåç«¯æ•°æ®åº“,é€šè¿‡ **Next.js API ä»£ç†**è®¿é—®ã€‚

### 12.1 æ ¸å¿ƒæ•°æ®è¡¨

**shared_annotations**(å…±äº«æ ‡æ³¨):
```sql
CREATE TABLE shared_annotations (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  doi TEXT NOT NULL,
  user_id UUID REFERENCES auth.users(id),
  user_name TEXT NOT NULL,
  annotation_text TEXT,           -- æ ‡æ³¨å†…å®¹
  annotation_comment TEXT,        -- ç”¨æˆ·è¯„è®º
  page_number INTEGER,
  position JSONB,                 -- é¡µé¢ä½ç½®
  annotation_type TEXT,           -- ç±»å‹: highlight, note, etc.
  annotation_color TEXT,          -- é¢œè‰²
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**annotation_likes**(ç‚¹èµ):
```sql
CREATE TABLE annotation_likes (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  annotation_id UUID REFERENCES shared_annotations(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(annotation_id, user_id)
);
```

**annotation_comments**(è¯„è®º):
```sql
CREATE TABLE annotation_comments (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  annotation_id UUID REFERENCES shared_annotations(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  user_name TEXT NOT NULL,
  comment_text TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

**user_follows**(å…³æ³¨):
```sql
CREATE TABLE user_follows (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  follower_id UUID REFERENCES auth.users(id),
  following_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(follower_id, following_id)
);
```

**reading_sessions**(å…±è¯»ä¼šè¯):
```sql
CREATE TABLE reading_sessions (
  id UUID PRIMARY KEY,
  paper_doi TEXT NOT NULL,
  session_type TEXT CHECK (session_type IN ('public', 'private')),
  invite_code TEXT UNIQUE,
  creator_id UUID REFERENCES auth.users(id),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);
```

**session_annotations**(ä¼šè¯æ ‡æ³¨):
```sql
CREATE TABLE session_annotations (
  id UUID PRIMARY KEY,
  session_id UUID REFERENCES reading_sessions(id),
  user_id UUID REFERENCES auth.users(id),
  paper_doi TEXT NOT NULL,
  annotation_data JSONB NOT NULL,  -- åŒ…å« zotero_key
  page_number INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### 12.2 RLS å®‰å…¨ç­–ç•¥

Supabase ä½¿ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥(RLS)ä¿æŠ¤æ•°æ®:

```sql
-- ç”¨æˆ·åªèƒ½è¯»å–è‡ªå·±çš„æ ‡æ³¨
CREATE POLICY "Users can view own annotations"
  ON shared_annotations
  FOR SELECT
  USING (auth.uid() = user_id);

-- æ‰€æœ‰äººå¯ä»¥æŸ¥çœ‹å…¬å…±æ ‡æ³¨
CREATE POLICY "Anyone can view public annotations"
  ON shared_annotations
  FOR SELECT
  USING (true);

-- ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„æ ‡æ³¨
CREATE POLICY "Users can delete own annotations"
  ON shared_annotations
  FOR DELETE
  USING (auth.uid() = user_id);
```

<a name="é—®é¢˜æ’æŸ¥"></a>
## 13. é—®é¢˜æ’æŸ¥

### 13.1 å¸¸è§é—®é¢˜

#### é—®é¢˜ 1: çƒ­é‡è½½ä¸å·¥ä½œ

**åŸå› **:
- `.env` ä¸­çš„ `ZOTERO_PLUGIN_ZOTERO_BIN_PATH` è·¯å¾„é”™è¯¯
- Zotero å·²ç»åœ¨è¿è¡Œ
- æ„å»ºç¼“å­˜æŸå

**è§£å†³æ–¹æ³•**:
```bash
# 1. æ£€æŸ¥ Zotero è·¯å¾„
echo $ZOTERO_PLUGIN_ZOTERO_BIN_PATH

# 2. å…³é—­æ‰€æœ‰ Zotero è¿›ç¨‹
# Windows: ä»»åŠ¡ç®¡ç†å™¨ â†’ ç»“æŸ zotero.exe
# Mac/Linux: killall zotero

# 3. æ¸…ç†æ„å»ºç¼“å­˜
rm -rf .scaffold/
rm -rf build/

# 4. é‡æ–°æ„å»º
npm run build
npm start
```

#### é—®é¢˜ 2: è®¤è¯å¤±è´¥

**ç°è±¡**: ç™»å½•åæç¤º"Unauthorized"æˆ–"Token invalid"

**åŸå› **:
- Next.js API æœåŠ¡å™¨æœªè¿è¡Œ
- Supabase é…ç½®é”™è¯¯
- ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ³•**:
```bash
# 1. ç¡®è®¤ Next.js æœåŠ¡å™¨è¿è¡Œä¸­
# è®¿é—® http://localhost:3000 æˆ– https://www.researchopia.com

# 2. æ£€æŸ¥ Supabase é…ç½®
# è®¿é—® Supabase Dashboard â†’ Settings â†’ API

# 3. æ£€æŸ¥ç½‘ç»œ
curl https://www.researchopia.com/api/health
```

#### é—®é¢˜ 3: æ ‡æ³¨ä¸æ˜¾ç¤º

**ç°è±¡**: ç¤¾åŒºæ ‡æ³¨åˆ—è¡¨ä¸ºç©º

**åŸå› **:
- è®ºæ–‡ç¼ºå°‘ DOI
- æœªç™»å½•
- æ•°æ®åº“ä¸­ç¡®å®æ²¡æœ‰æ ‡æ³¨

**è§£å†³æ–¹æ³•**:
1. ç¡®è®¤è®ºæ–‡æœ‰ DOI(Info é¢æ¿ â†’ DOI å­—æ®µ)
2. ç¡®è®¤å·²ç™»å½•(å·¥å…· â†’ Researchopia â†’ Login)
3. å°è¯•åˆ·æ–°(é‡æ–°é€‰æ‹©æ–‡çŒ®)
4. æŸ¥çœ‹æ—¥å¿—(å¸®åŠ© â†’ Debug Output Logging)

#### é—®é¢˜ 4: æ„å»ºå¤±è´¥

**é”™è¯¯ç¤ºä¾‹**:
```
Error: Cannot find module 'zotero-plugin-toolkit'
```

**è§£å†³æ–¹æ³•**:
```bash
# åˆ é™¤ node_modules å’Œé”æ–‡ä»¶
rm -rf node_modules package-lock.json

# é‡æ–°å®‰è£…ä¾èµ–
npm install

# æ¸…ç†æ„å»ºç¼“å­˜
npm run clean

# é‡æ–°æ„å»º
npm run build
```

### 13.2 è°ƒè¯•æŠ€å·§

**1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**:
```typescript
// åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—
import { logger } from '../utils/logger';

logger.log('å˜é‡å€¼:', someVariable);
logger.error('é”™è¯¯ä¿¡æ¯:', error);
```

**2. ä½¿ç”¨ Zotero Debug Output**:
- å¸®åŠ© â†’ Debug Output Logging â†’ Start Logging
- æ‰§è¡Œæ“ä½œ
- å¸®åŠ© â†’ Debug Output Logging â†’ View Output

**3. æ£€æŸ¥ API è¯·æ±‚**:
```typescript
// utils/apiClient.ts ä¸­å·²æœ‰è¯¦ç»†æ—¥å¿—
// æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„ API è¯·æ±‚å’Œå“åº”
```

**4. æ•°æ®åº“æŸ¥è¯¢è°ƒè¯•**:
- è®¿é—® Supabase Dashboard
- SQL Editor â†’ è¿è¡ŒæŸ¥è¯¢
- ä¾‹: `SELECT * FROM shared_annotations WHERE doi = '10.xxxx/xxxxx';`

### 13.3 æ€§èƒ½ä¼˜åŒ–

**é—®é¢˜**: æ ‡æ³¨åˆ—è¡¨åŠ è½½ç¼“æ…¢

**ä¼˜åŒ–æ–¹æ³•**:
1. **åˆ†é¡µåŠ è½½**: é™åˆ¶å•æ¬¡æŸ¥è¯¢æ•°é‡
   ```typescript
   const { data } = await supabase
     .from('shared_annotations')
     .select('*')
     .range(0, 49) // æ¯æ¬¡åŠ è½½ 50 æ¡
     .order('created_at', { ascending: false });
   ```

2. **ç¼“å­˜ç­–ç•¥**: ä½¿ç”¨æœ¬åœ°ç¼“å­˜å‡å°‘ API è°ƒç”¨
3. **æ‡’åŠ è½½**: æ»šåŠ¨åˆ°åº•éƒ¨æ—¶åŠ è½½æ›´å¤š
4. **ç´¢å¼•ä¼˜åŒ–**: ç¡®ä¿æ•°æ®åº“å­—æ®µæœ‰ç´¢å¼•(doi, user_id, created_at)

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ¶æ„è¯´æ˜](./ARCHITECTURE.md)
- [è´¡çŒ®æŒ‡å—](./CONTRIBUTING.md)
- [é¡¹ç›®ä¼˜åŒ–è®¡åˆ’](../Debug/docs/PROJECT_OPTIMIZATION_PLAN.md)

### B. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

**æµè§ˆå™¨æ‰©å±•**:
```bash
# æ‰“åŒ…æ‰©å±•
cd extension
zip -r researchopia-extension.zip .
```

**Zotero æ’ä»¶**:
```bash
# å¼€å‘æ¨¡å¼(çƒ­é‡è½½)
npm start

# æ„å»ºå¼€å‘ç‰ˆæœ¬
npm run build

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build:prod

# ç”Ÿæˆ XPI åŒ…
npm run release

# è¿è¡Œæµ‹è¯•
npm test

# ä»£ç æ£€æŸ¥
npm run lint:check
npm run lint:fix
```

**Next.js ç½‘ç«™**:
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

### C. ç‰ˆæœ¬å†å²

**æµè§ˆå™¨æ‰©å±•**:
- v0.1.1: åˆå§‹ç‰ˆæœ¬,DOI æ£€æµ‹ã€æ‚¬æµ®å›¾æ ‡ã€ä¾§è¾¹æ 

**Zotero æ’ä»¶**:
- v1.0.0: åˆå§‹ç‰ˆæœ¬,æ ‡æ³¨å…±äº«ã€ç¤¾åŒºæ ‡æ³¨
- v1.1.0: æ·»åŠ å…±è¯»ä¼šè¯åŠŸèƒ½
- v1.2.0: å®æ—¶åä½œ(å½“å‰å¼€å‘ä¸­)

---

**ç»´æŠ¤è€…**: Researchopia Team  
**æœ€åæ›´æ–°**: 2025-11-02  
**è®¸å¯è¯**: AGPL-3.0-or-later
