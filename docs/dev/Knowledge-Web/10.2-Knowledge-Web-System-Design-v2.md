# 10.2 知识网整体设计 v2 | Knowledge Web System Design v2

**整合 ChatGPT + Microsoft Copilot 深度反馈后的升级版**

---

## 一、核心理念升级

### 1.1 从"标识"到"多重标识+版本族"

| 原设计 | 升级设计 |
|--------|---------|
| URL = 唯一标识 | URL + canonical + 内容哈希 + 快照指针 |
| DOI = 唯一标识 | DOI + 版本链 (预印本↔发表版↔勘误版) |
| 网页/文献分离 | **作品族**: 同一作品的多承载页归并 |

### 1.2 从"关联"到"类型化证据边"

```
边 = 关系类型 + 证据片段 + 置信度 + 来源
```

**关系类型**:
- 网页↔网页: `引用` `回应` `反驳` `翻译` `策展收录`
- 网页↔文献: `评述` `数据来源` `方法复现` `教学解读`
- 文献↔文献: `被引` `共引` `方法继承` `数据复用` `版本关系`

**证据片段**: 引文段落、截屏、时间戳、页码

---

## 二、数据模型

### 2.1 节点 (Knowledge Units)

```sql
knowledge_units (
  id UUID PRIMARY KEY,
  -- 多重标识
  primary_url TEXT,              -- 首见URL
  canonical_url TEXT,            -- 规范化URL
  content_hash TEXT,             -- 正文哈希(去重)
  doi TEXT,                      -- DOI (文献)
  isbn TEXT,                     -- ISBN (图书)
  -- 元数据
  type TEXT,                     -- 'webpage' | 'paper' | 'book' | 'video' | 'audio'
  title TEXT,
  metadata JSONB,                -- 灵活扩展: authors, abstract, journal...
  -- 快照与版本
  snapshot_id TEXT,              -- 指向存档快照
  work_cluster_id UUID,          -- 作品族ID (版本归并)
  -- 权限
  user_id UUID,
  visibility TEXT,               -- 'private' | 'public' | 'team'
  created_at, updated_at
)
```

### 2.2 边 (Knowledge Links)

```sql
knowledge_links (
  id UUID PRIMARY KEY,
  source_id UUID,
  target_id UUID,
  -- 类型化关系
  link_type TEXT,                -- 'cite' | 'respond' | 'refute' | 'translate' | 'review' | 'cocite' ...
  direction TEXT,                -- 'forward' | 'backward' | 'bidirectional'
  -- 证据与置信度
  evidence JSONB,                -- { text_excerpt, page_number, timestamp, screenshot_url }
  confidence FLOAT,              -- 0.0~1.0
  evidence_source TEXT,          -- 'user_manual' | 'auto_extract' | 'crossref' | 'openalex'
  -- 归属
  created_by UUID,
  is_verified BOOLEAN,           -- 用户确认过
  created_at
)
```

### 2.3 收藏与标签分离

```sql
-- 标签 (开放、语义维度)
tags (id, name, user_id, visibility)
unit_tags (unit_id, tag_id)

-- 集合 (策展、可排序、目的导向)
collections (id, name, type, description, user_id, visibility)
collection_units (collection_id, unit_id, position, added_at)
```

### 2.4 笔记分层

```sql
notes (
  id UUID,
  unit_id UUID,                  -- 所属知识单元
  note_type TEXT,                -- 'highlight' | 'comment' | 'rich_note'
  -- 高亮型
  text_excerpt TEXT,             -- 原文片段
  position JSONB,                -- 位置定位 (页码/时间戳/DOM路径)
  -- 评论/笔记型
  content TEXT,                  -- Markdown内容
  attachments JSONB,             -- 图片等附件
  -- 权限
  user_id UUID,
  visibility TEXT,
  created_at
)
```

---

## 三、系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                     采集层 (Capture Layer)                   │
├─────────────────────────────────────────────────────────────┤
│  浏览器扩展              Zotero插件            网站导入      │
│  - URL规范化             - 条目同步            - DOI搜索     │
│  - DOI检测               - 标注同步            - 批量导入    │
│  - 快照生成              - 双向冲突解决                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   解析归并层 (Resolution Layer)              │
├─────────────────────────────────────────────────────────────┤
│  URL规范化 → 作品族归并 → 关系抽取(自动) → 用户校正         │
│  - utm剔除                - 版本链识别      - 链接解析        │
│  - 重定向跟踪             - 实体解析        - 共引计算        │
│  - canonical获取          - 去重            - 语义相似度      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      存储层 (Storage Layer)                  │
├─────────────────────────────────────────────────────────────┤
│  PostgreSQL             对象存储              向量索引        │
│  - 知识单元              - 快照(WARC)         - 语义检索      │
│  - 类型化边              - 笔记媒体           - 相似度计算    │
│  - 标签/集合             - 截图证据                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    展示层 (Presentation Layer)               │
├─────────────────────────────────────────────────────────────┤
│  个人知识流      个人知识网       全局知识流      全局知识网   │
│  - 时间线         - 图视图         - 推荐算法      - 聚合图    │
│  - 任务上下文     - 过滤器         - 可解释性      - 主题图谱  │
│  - 图更新事件     - 边权可视化     - 反回音策略               │
└─────────────────────────────────────────────────────────────┘
```

---

## 四、外部生态集成

| 系统 | 集成方式 | 价值 |
|------|---------|------|
| **OpenAlex** | API补全 | 引用网络、作者、机构、概念 |
| **CrossRef** | DOI解析 | 元数据、引用关系 |
| **Zotero** | 双向同步 | 文献管理生态复用 |
| **Hypothesis** | 协议对接 | 网页标注互通 |
| **Internet Archive** | 快照指针 | 链接腐朽后的保底 |

---

## 五、治理与信任

### 5.1 证据分级

| 级别 | 描述 | 权重 |
|------|------|------|
| 强关联 | 有引文片段/页码/截图 | 1.0 |
| 中关联 | 用户手动确认 | 0.7 |
| 弱关联 | 自动抽取未确认 | 0.3 |
| 软关联 | 灵感/联想 | 0.1 |

### 5.2 隐私分层

```
条目基础信息 → 可选公开
笔记与评论   → 默认私密，逐条公开
关系边       → 跟随两端节点的最严权限
```

### 5.3 社区治理

- 举报机制 (垃圾边、滥标签)
- 审核队列
- 用户信誉分

---

## 六、成功指标

| 维度 | 指标 | 目标 |
|------|------|------|
| 使用 | DAU/WAU | 持续增长 |
| 连通 | 平均节点边数 | >3 |
| 发现 | 推荐点击转化率 | >15% |
| 可靠 | 快照可恢复率 | >95% |
| 社交 | 公开策展被访问数 | 持续增长 |

---

*文档版本: v2.0 | 创建: 2025-12-04 | 整合: ChatGPT + Copilot 反馈*
