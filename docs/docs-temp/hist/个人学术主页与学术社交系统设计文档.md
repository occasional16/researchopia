# ç ”å­¦æ¸¯ - ä¸ªäººå­¦æœ¯ä¸»é¡µä¸å­¦æœ¯ç¤¾äº¤ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v0.2.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-01-17  
> **ç›®æ ‡**: æ‰“é€ å¼€æ”¾çš„å­¦æœ¯äº¤æµå…±äº«å¹³å°ï¼Œæ„å»ºå­¦æœ¯ç¤¾äº¤ç”Ÿæ€ç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç°çŠ¶åˆ†æ](#1-é¡¹ç›®ç°çŠ¶åˆ†æ)
2. [è®¾è®¡ç†å¿µä¸ç›®æ ‡](#2-è®¾è®¡ç†å¿µä¸ç›®æ ‡)
3. [æ ¸å¿ƒåŠŸèƒ½è®¾è®¡](#3-æ ¸å¿ƒåŠŸèƒ½è®¾è®¡)
4. [æŠ€æœ¯æ¶æ„è®¾è®¡](#4-æŠ€æœ¯æ¶æ„è®¾è®¡)
5. [æ•°æ®åº“è®¾è®¡](#5-æ•°æ®åº“è®¾è®¡)
6. [MVPå¼€å‘è®¡åˆ’](#6-mvpå¼€å‘è®¡åˆ’)
7. [é•¿æœŸå‘å±•è·¯çº¿](#7-é•¿æœŸå‘å±•è·¯çº¿)

---

## 1. é¡¹ç›®ç°çŠ¶åˆ†æ

### 1.1 å·²æœ‰åŸºç¡€è®¾æ–½

#### âœ… æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Next.js 15 + React 19 + TypeScript + Tailwind CSS
- **åç«¯**: Supabase (PostgreSQL) + RESTful API
- **éƒ¨ç½²**: Vercel
- **æ’ä»¶**: Zoteroæ’ä»¶ + æµè§ˆå™¨æ‰©å±•

#### âœ… æ ¸å¿ƒåŠŸèƒ½
- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (æ³¨å†Œ/ç™»å½•/å¯†ç ç®¡ç†)
- è®ºæ–‡æœç´¢ä¸è¯„åˆ†ç³»ç»Ÿ
- æ ‡æ³¨åˆ†äº«ä¸åä½œ (Zoteroé›†æˆ)
- è¯„è®ºç³»ç»Ÿ (æ”¯æŒåµŒå¥—å›å¤)
- åŸºç¡€ä¸ªäººä¸­å¿ƒé¡µé¢

#### âœ… æ•°æ®åº“è¡¨ç»“æ„
- `users` - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- `papers` - è®ºæ–‡æ•°æ®
- `annotations` - æ ‡æ³¨æ•°æ®
- `comments` - è¯„è®ºæ•°æ®
- `ratings` - è¯„åˆ†æ•°æ®
- `user_follows` - å…³æ³¨å…³ç³»
- `paper_favorites` - è®ºæ–‡æ”¶è—
- `annotation_likes` - æ ‡æ³¨ç‚¹èµ

### 1.2 ç°æœ‰é—®é¢˜ä¸æœºä¼š

#### ğŸ”´ å¾…å®Œå–„åŠŸèƒ½
1. **ä¸ªäººä¸»é¡µç¼ºå¤±**: æ— æ³•å±•ç¤ºç”¨æˆ·å­¦æœ¯æ¡£æ¡ˆå’Œæˆæœ
2. **ç¤¾äº¤åŠŸèƒ½è–„å¼±**: å…³æ³¨ç³»ç»Ÿæœªå®ç°ï¼Œç¼ºå°‘äº’åŠ¨æœºåˆ¶
3. **å­¦æœ¯èº«ä»½ä¸æ˜ç¡®**: ç¼ºå°‘ç ”ç©¶é¢†åŸŸã€æœºæ„ã€å­¦æœ¯æˆå°±å±•ç¤º
4. **å†…å®¹å‘ç°å›°éš¾**: ç¼ºå°‘æ¨èç®—æ³•å’Œä¸ªæ€§åŒ–å†…å®¹æµ
5. **ç¤¾åŒºæ°›å›´ä¸è¶³**: ç¼ºå°‘åŠ¨æ€ã€è¯é¢˜ã€è®¨è®ºåŒºç­‰ç¤¾åŒºåŠŸèƒ½

#### ğŸŸ¢ æ ¸å¿ƒä¼˜åŠ¿
1. **Zoteroæ·±åº¦é›†æˆ**: ç›´æ¥è¿æ¥ç ”ç©¶è€…çš„æ–‡çŒ®åº“
2. **æ ‡æ³¨ä¸ºä¸­å¿ƒ**: ç‹¬ç‰¹çš„æ ‡æ³¨åˆ†äº«æœºåˆ¶
3. **æŠ€æœ¯æ¶æ„å®Œå–„**: ç°ä»£åŒ–æŠ€æœ¯æ ˆï¼Œæ˜“äºæ‰©å±•
4. **å¼€æºå¼€æ”¾**: AGPL-3.0åè®®ï¼Œç¤¾åŒºé©±åŠ¨

---

## 2. è®¾è®¡ç†å¿µä¸ç›®æ ‡

### 2.1 æ ¸å¿ƒç†å¿µ

> **"ä»¥å­¦æœ¯å†…å®¹ä¸ºæ ¸å¿ƒï¼Œä»¥çœŸå®äº’åŠ¨ä¸ºçº½å¸¦ï¼Œæ„å»ºå¼€æ”¾çš„å­¦æœ¯å…±äº«ç¤¾åŒº"**

#### è®¾è®¡åŸåˆ™
1. **å­¦æœ¯ä¼˜å…ˆ**: å†…å®¹è´¨é‡ > ç¤¾äº¤å¨±ä¹
2. **çœŸå®èº«ä»½**: é¼“åŠ±å®åï¼Œå»ºç«‹å­¦æœ¯ä¿¡èª‰
3. **å¼€æ”¾å…±äº«**: çŸ¥è¯†è‡ªç”±æµåŠ¨ï¼Œåå¯¹å­¦æœ¯å­¤å²›
4. **éšç§ä¿æŠ¤**: ç”¨æˆ·å¯æ§çš„éšç§è®¾ç½®
5. **ç®€æ´é«˜æ•ˆ**: é¿å…è¿‡åº¦ç¤¾äº¤åŒ–ï¼Œä¸“æ³¨å­¦æœ¯ä»·å€¼

### 2.2 å¯¹æ ‡åˆ†æ

| å¹³å° | æ ¸å¿ƒç‰¹è‰² | å¯å€Ÿé‰´ç‚¹ | å·®å¼‚åŒ–æ–¹å‘ |
|------|---------|---------|-----------|
| **ResearchGate** | å­¦æœ¯ç¤¾äº¤ç½‘ç»œ | ä¸ªäººä¸»é¡µã€ç ”ç©¶æˆæœå±•ç¤ºã€Q&A | æ›´è½»é‡ã€æ›´å¼€æ”¾ã€æ ‡æ³¨ä¸­å¿ƒ |
| **Google Scholar** | å­¦æœ¯æ¡£æ¡ˆ | å¼•ç”¨ç»Ÿè®¡ã€h-indexã€åˆä½œè€…ç½‘ç»œ | å¢åŠ äº’åŠ¨æ€§ã€ç¤¾åŒºè®¨è®º |
| **çŸ¥ä¹** | é—®ç­”ç¤¾åŒº | è¯é¢˜ç³»ç»Ÿã€å†…å®¹æ¨èã€ä¸“æ  | èšç„¦å­¦æœ¯é¢†åŸŸã€ä¸“ä¸šæ€§ |
| **è±†ç“£** | å…´è¶£ç¤¾äº¤ | å°ç»„ã€ä¹¦å½±éŸ³è¯„ä»·ã€ä¸ªäººä¸»é¡µ | å­¦æœ¯å†…å®¹ã€ä¸“ä¸šè¯„ä»·ä½“ç³» |
| **Twitterå­¦æœ¯åœˆ** | å®æ—¶åŠ¨æ€ | ç®€çŸ­åˆ†äº«ã€è¯é¢˜æ ‡ç­¾ã€è½¬å‘ | æ·±åº¦å†…å®¹ã€é•¿æœŸä»·å€¼ |

### 2.3 ç›®æ ‡ç”¨æˆ·ç”»åƒ

#### ä¸»è¦ç”¨æˆ·ç¾¤ä½“
1. **ç ”ç©¶ç”Ÿ/åšå£«ç”Ÿ** (40%): æ–‡çŒ®é˜…è¯»ã€è®ºæ–‡å†™ä½œã€å­¦æœ¯äº¤æµ
2. **é’å¹´å­¦è€…** (30%): æˆæœå±•ç¤ºã€åˆä½œå¯»æ‰¾ã€å­¦æœ¯å½±å“åŠ›
3. **èµ„æ·±æ•™æˆ** (15%): çŸ¥è¯†åˆ†äº«ã€å­¦æœ¯æŒ‡å¯¼ã€é¢†åŸŸå½±å“
4. **ç§‘ç ”å·¥ä½œè€…** (15%): æŠ€æœ¯äº¤æµã€é—®é¢˜æ±‚åŠ©ã€èµ„æºå…±äº«

#### æ ¸å¿ƒéœ€æ±‚
- ğŸ“š **æ–‡çŒ®ç®¡ç†**: é«˜æ•ˆçš„æ–‡çŒ®é˜…è¯»å’Œæ ‡æ³¨å·¥å…·
- ğŸ“ **å­¦æœ¯å±•ç¤º**: å±•ç¤ºç ”ç©¶æˆæœå’Œå­¦æœ¯èº«ä»½
- ğŸ¤ **å­¦æœ¯ç¤¾äº¤**: æ‰¾åˆ°åŒé¢†åŸŸç ”ç©¶è€…ï¼Œå»ºç«‹åˆä½œ
- ğŸ’¡ **çŸ¥è¯†è·å–**: å‘ç°ä¼˜è´¨å†…å®¹ï¼Œå­¦ä¹ å‰æ²¿çŸ¥è¯†
- ğŸ” **é—®é¢˜è§£å†³**: æé—®ã€è®¨è®ºã€è·å¾—ä¸“ä¸šå»ºè®®

---

## 3. æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 3.1 ä¸ªäººå­¦æœ¯ä¸»é¡µ (Academic Profile)

#### 3.1.1 åŸºæœ¬ä¿¡æ¯åŒº
```typescript
interface UserProfile {
  // åŸºç¡€ä¿¡æ¯
  id: string
  username: string
  email: string
  avatar_url?: string
  
  // å­¦æœ¯èº«ä»½
  real_name?: string              // çœŸå®å§“å
  institution?: string            // æ‰€å±æœºæ„
  department?: string             // é™¢ç³»/éƒ¨é—¨
  position?: string               // èŒä½/èŒç§°
  research_fields: string[]       // ç ”ç©¶é¢†åŸŸ
  
  // å­¦æœ¯æ ‡è¯†
  orcid?: string                  // ORCID ID
  google_scholar_id?: string      // Google Scholar ID
  researchgate_id?: string        // ResearchGate ID
  
  // ä¸ªäººç®€ä»‹
  bio?: string                    // ä¸ªäººç®€ä»‹
  website?: string                // ä¸ªäººç½‘ç«™
  location?: string               // æ‰€åœ¨åœ°
  
  // ç¤¾äº¤ç»Ÿè®¡
  followers_count: number         // å…³æ³¨è€…æ•°
  following_count: number         // å…³æ³¨æ•°
  papers_count: number            // è®ºæ–‡æ•°
  annotations_count: number       // æ ‡æ³¨æ•°
  
  // éšç§è®¾ç½®
  profile_visibility: 'public' | 'followers' | 'private'
  show_email: boolean
  show_institution: boolean
  
  created_at: string
  updated_at: string
}
```

#### 3.1.2 ä¸»é¡µå¸ƒå±€è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¤´åƒ]  ç”¨æˆ·å @username                    [å…³æ³¨] [ç§ä¿¡] â”‚
â”‚         èŒä½ @ æœºæ„                                      â”‚
â”‚         ğŸ“ åœ°åŒº | ğŸ”— ä¸ªäººç½‘ç«™ | ğŸ“ ORCID                 â”‚
â”‚         ç ”ç©¶é¢†åŸŸ: #æœºå™¨å­¦ä¹  #è‡ªç„¶è¯­è¨€å¤„ç†                  â”‚
â”‚                                                         â”‚
â”‚  ğŸ“Š 123 å…³æ³¨è€… | 456 å…³æ³¨ä¸­ | 78 è®ºæ–‡ | 234 æ ‡æ³¨        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [æ¦‚è§ˆ] [è®ºæ–‡] [æ ‡æ³¨] [è¯„è®º] [æ”¶è—] [åŠ¨æ€]               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                         â”‚
â”‚  ğŸ“ ä¸ªäººç®€ä»‹                                            â”‚
â”‚  è¿™é‡Œæ˜¯ç”¨æˆ·çš„ä¸ªäººç®€ä»‹å†…å®¹...                              â”‚
â”‚                                                         â”‚
â”‚  ğŸ† å­¦æœ¯æˆå°±                                            â”‚
â”‚  â€¢ h-index: 15                                         â”‚
â”‚  â€¢ æ€»å¼•ç”¨: 1,234                                        â”‚
â”‚  â€¢ ä¼˜è´¨æ ‡æ³¨: 56                                         â”‚
â”‚                                                         â”‚
â”‚  ğŸ“š æœ€æ–°è®ºæ–‡ (3)                          [æŸ¥çœ‹å…¨éƒ¨ â†’]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ è®ºæ–‡æ ‡é¢˜...                          â”‚               â”‚
â”‚  â”‚ ä½œè€… | æœŸåˆŠ | 2024                   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                         â”‚
â”‚  ğŸ’¡ çƒ­é—¨æ ‡æ³¨ (5)                          [æŸ¥çœ‹å…¨éƒ¨ â†’]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ "è¿™ä¸ªæ–¹æ³•çš„åˆ›æ–°ç‚¹åœ¨äº..."            â”‚               â”‚
â”‚  â”‚ ğŸ‘ 45  ğŸ’¬ 12  | è®ºæ–‡: XXX            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                         â”‚
â”‚  ğŸ”¥ æœ€è¿‘æ´»åŠ¨                                            â”‚
â”‚  â€¢ è¯„è®ºäº†è®ºæ–‡ã€ŠXXXã€‹                                     â”‚
â”‚  â€¢ åˆ†äº«äº†æ ‡æ³¨ "å…³äºXXXçš„æ€è€ƒ"                            â”‚
â”‚  â€¢ å…³æ³¨äº† @researcher_name                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.3 åŠŸèƒ½æ¨¡å—

**A. æ¦‚è§ˆæ ‡ç­¾é¡µ**
- ä¸ªäººç®€ä»‹å’Œå­¦æœ¯èº«ä»½
- å­¦æœ¯æˆå°±ç»Ÿè®¡
- æœ€æ–°è®ºæ–‡/æ ‡æ³¨/è¯„è®º
- æœ€è¿‘æ´»åŠ¨æ—¶é—´çº¿

**B. è®ºæ–‡æ ‡ç­¾é¡µ**
- ç”¨æˆ·å‘å¸ƒ/æ”¶è—çš„è®ºæ–‡åˆ—è¡¨
- æŒ‰æ—¶é—´/å¼•ç”¨/è¯„åˆ†æ’åº
- ç­›é€‰å™¨: ä½œä¸ºä½œè€…/ä½œä¸ºè¯»è€…
- è®ºæ–‡ç»Ÿè®¡å›¾è¡¨

**C. æ ‡æ³¨æ ‡ç­¾é¡µ**
- ç”¨æˆ·çš„æ‰€æœ‰å…¬å¼€æ ‡æ³¨
- æŒ‰è®ºæ–‡/æ—¶é—´/çƒ­åº¦åˆ†ç»„
- æ ‡æ³¨è´¨é‡è¯„åˆ†å±•ç¤º
- æ”¯æŒæœç´¢å’Œç­›é€‰

**D. è¯„è®ºæ ‡ç­¾é¡µ**
- è®ºæ–‡è¯„è®ºå†å²
- æ ‡æ³¨è¯„è®ºå†å²
- æŒ‰æ—¶é—´å€’åºæ’åˆ—
- æ˜¾ç¤ºè¯„è®ºæ‰€å±å†…å®¹

**E. æ”¶è—æ ‡ç­¾é¡µ**
- æ”¶è—çš„è®ºæ–‡
- æ”¶è—çš„æ ‡æ³¨
- æ”¶è—å¤¹åˆ†ç±»ç®¡ç†

**F. åŠ¨æ€æ ‡ç­¾é¡µ**
- ç”¨æˆ·çš„å­¦æœ¯åŠ¨æ€æµ
- å‘å¸ƒã€è¯„è®ºã€ç‚¹èµã€å…³æ³¨ç­‰æ´»åŠ¨
- æ—¶é—´çº¿å±•ç¤º

### 3.2 å­¦æœ¯ç¤¾äº¤ç³»ç»Ÿ

#### 3.2.1 å…³æ³¨ç³»ç»Ÿ (Follow System)

```typescript
interface FollowRelation {
  id: string
  follower_id: string      // å…³æ³¨è€…
  following_id: string     // è¢«å…³æ³¨è€…
  created_at: string
  
  // æ‰©å±•å­—æ®µ
  notification_enabled: boolean  // æ˜¯å¦æ¥æ”¶åŠ¨æ€é€šçŸ¥
  tags?: string[]                // ç»™å…³æ³¨è€…æ‰“æ ‡ç­¾
}

// APIè®¾è®¡
POST   /api/users/:userId/follow        // å…³æ³¨ç”¨æˆ·
DELETE /api/users/:userId/unfollow      // å–æ¶ˆå…³æ³¨
GET    /api/users/:userId/followers     // è·å–å…³æ³¨è€…åˆ—è¡¨
GET    /api/users/:userId/following     // è·å–å…³æ³¨åˆ—è¡¨
GET    /api/users/:userId/is-following  // æ£€æŸ¥æ˜¯å¦å…³æ³¨
```

**å…³æ³¨åŠŸèƒ½ç‰¹æ€§**:
- âœ… å•å‘å…³æ³¨ (ç±»ä¼¼Twitter)
- âœ… å…³æ³¨è€…/å…³æ³¨ä¸­åˆ—è¡¨
- âœ… äº’ç›¸å…³æ³¨æ ‡è¯†
- âœ… å…³æ³¨åŠ¨æ€æ¨é€
- âœ… å…³æ³¨è€…åˆ†ç»„ç®¡ç† (æœªæ¥)

#### 3.2.2 åŠ¨æ€ç³»ç»Ÿ (Activity Feed)

```typescript
interface Activity {
  id: string
  user_id: string
  type: ActivityType
  content: string
  metadata: Record<string, any>
  visibility: 'public' | 'followers' | 'private'
  created_at: string
}

type ActivityType = 
  | 'paper_published'      // å‘å¸ƒè®ºæ–‡
  | 'annotation_shared'    // åˆ†äº«æ ‡æ³¨
  | 'paper_commented'      // è¯„è®ºè®ºæ–‡
  | 'paper_rated'          // è¯„åˆ†è®ºæ–‡
  | 'user_followed'        // å…³æ³¨ç”¨æˆ·
  | 'paper_favorited'      // æ”¶è—è®ºæ–‡
  | 'annotation_liked'     // ç‚¹èµæ ‡æ³¨
```

**åŠ¨æ€æµè®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ  é¦–é¡µåŠ¨æ€                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [å…³æ³¨] [æ¨è] [çƒ­é—¨]                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  ğŸ‘¤ å¼ ä¸‰ @zhangsan Â· 2å°æ—¶å‰             â”‚
â”‚  ğŸ“ åˆ†äº«äº†æ ‡æ³¨                           â”‚
â”‚  "è¿™ç¯‡è®ºæ–‡æå‡ºçš„æ–¹æ³•å¾ˆæœ‰å¯å‘æ€§..."        â”‚
â”‚  ğŸ“„ è®ºæ–‡: Deep Learning for NLP         â”‚
â”‚  ğŸ‘ 12  ğŸ’¬ 3  ğŸ”– 5                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  ğŸ‘¤ æå›› @lisi Â· 5å°æ—¶å‰                 â”‚
â”‚  â­ è¯„ä»·äº†è®ºæ–‡                           â”‚
â”‚  åˆ›æ–°æ€§: â­â­â­â­â­                        â”‚
â”‚  æ–¹æ³•è®º: â­â­â­â­                          â”‚
â”‚  ğŸ“„ è®ºæ–‡: Transformer Architecture      â”‚
â”‚  ğŸ‘ 8  ğŸ’¬ 2                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  ğŸ‘¤ ç‹äº” @wangwu Â· 1å¤©å‰                 â”‚
â”‚  ğŸ‘¥ å…³æ³¨äº† @expert_researcher           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.3 æ¨èç³»ç»Ÿ (Recommendation)

**æ¨èç»´åº¦**:
1. **ç”¨æˆ·æ¨è**
   - ç›¸åŒç ”ç©¶é¢†åŸŸ
   - ç›¸åŒæœºæ„
   - å…±åŒå…³æ³¨
   - äº’åŠ¨é¢‘ç¹

2. **å†…å®¹æ¨è**
   - å…³æ³¨ç”¨æˆ·çš„åŠ¨æ€
   - ç ”ç©¶é¢†åŸŸç›¸å…³è®ºæ–‡
   - çƒ­é—¨æ ‡æ³¨å’Œè®¨è®º
   - ä¸ªæ€§åŒ–æ¨è

**æ¨èç®—æ³•** (ç®€åŒ–ç‰ˆ):
```typescript
function calculateUserSimilarity(user1: User, user2: User): number {
  let score = 0
  
  // ç ”ç©¶é¢†åŸŸé‡åˆåº¦ (40%)
  const fieldOverlap = intersection(user1.research_fields, user2.research_fields).length
  score += (fieldOverlap / user1.research_fields.length) * 0.4
  
  // å…±åŒå…³æ³¨ (30%)
  const commonFollowing = getCommonFollowing(user1.id, user2.id).length
  score += Math.min(commonFollowing / 10, 1) * 0.3
  
  // äº’åŠ¨é¢‘ç‡ (20%)
  const interactions = getInteractionCount(user1.id, user2.id)
  score += Math.min(interactions / 20, 1) * 0.2
  
  // æœºæ„ç›¸åŒ (10%)
  if (user1.institution === user2.institution) {
    score += 0.1
  }
  
  return score
}
```

#### 3.2.4 æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿ

```typescript
interface Notification {
  id: string
  user_id: string          // æ¥æ”¶è€…
  type: NotificationType
  actor_id?: string        // è§¦å‘è€…
  target_type: string      // ç›®æ ‡ç±»å‹ (paper/annotation/comment)
  target_id: string        // ç›®æ ‡ID
  content: string
  is_read: boolean
  created_at: string
}

type NotificationType =
  | 'new_follower'         // æ–°å…³æ³¨è€…
  | 'annotation_liked'     // æ ‡æ³¨è¢«ç‚¹èµ
  | 'annotation_commented' // æ ‡æ³¨è¢«è¯„è®º
  | 'comment_replied'      // è¯„è®ºè¢«å›å¤
  | 'paper_commented'      // è®ºæ–‡è¢«è¯„è®º
  | 'mention'              // è¢«@æåŠ
  | 'system'               // ç³»ç»Ÿé€šçŸ¥
```

**é€šçŸ¥ä¸­å¿ƒè®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”” é€šçŸ¥ (5æ¡æœªè¯»)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [å…¨éƒ¨] [äº’åŠ¨] [å…³æ³¨] [ç³»ç»Ÿ]             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  ğŸ”µ ğŸ‘¤ å¼ ä¸‰ å…³æ³¨äº†ä½                      â”‚
â”‚     2å°æ—¶å‰                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  ğŸ”µ ğŸ‘ æå›› ç‚¹èµäº†ä½ çš„æ ‡æ³¨                â”‚
â”‚     "å…³äºæ·±åº¦å­¦ä¹ çš„æ€è€ƒ..."              â”‚
â”‚     5å°æ—¶å‰                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  âšª ğŸ’¬ ç‹äº” å›å¤äº†ä½ çš„è¯„è®º                â”‚
â”‚     "æˆ‘è®¤ä¸ºè¿™ä¸ªæ–¹æ³•..."                  â”‚
â”‚     1å¤©å‰                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                         â”‚
â”‚  âšª ğŸ“¢ ç³»ç»Ÿé€šçŸ¥                           â”‚
â”‚     æ‚¨çš„è®ºæ–‡ã€ŠXXXã€‹è·å¾—äº†10ä¸ªè¯„åˆ†         â”‚
â”‚     2å¤©å‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Zoteroæ’ä»¶ç¤¾äº¤åŠŸèƒ½å¢å¼º

#### 3.3.1 æ’ä»¶å†…ä¸ªäººä¸»é¡µé¢„è§ˆ

åœ¨Zoteroæ’ä»¶ä¸­æ·»åŠ "ä¸ªäººä¸»é¡µ"æŒ‰é’®ï¼Œç‚¹å‡»ååœ¨ä¾§è¾¹æ æ˜¾ç¤ºç®€åŒ–ç‰ˆä¸ªäººä¸»é¡µ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸ªäººä¸»é¡µ                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [å¤´åƒ] ç”¨æˆ·å                   â”‚
â”‚  èŒä½ @ æœºæ„                     â”‚
â”‚                                 â”‚
â”‚  ğŸ“Š ç»Ÿè®¡                         â”‚
â”‚  â€¢ 123 å…³æ³¨è€…                    â”‚
â”‚  â€¢ 78 è®ºæ–‡                       â”‚
â”‚  â€¢ 234 æ ‡æ³¨                      â”‚
â”‚                                 â”‚
â”‚  [åœ¨ç½‘é¡µä¸­æŸ¥çœ‹å®Œæ•´ä¸»é¡µ]          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  æœ€æ–°æ ‡æ³¨ (3)                    â”‚
â”‚  â€¢ "å…³äºXXXçš„æ€è€ƒ..."            â”‚
â”‚  â€¢ "è¿™ä¸ªæ–¹æ³•å¾ˆæœ‰æ„æ€..."          â”‚
â”‚  â€¢ "å€¼å¾—æ·±å…¥ç ”ç©¶..."             â”‚
â”‚                                 â”‚
â”‚  [ç®¡ç†æˆ‘çš„ä¸»é¡µ]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3.2 å…³æ³¨åŠŸèƒ½é›†æˆ

åœ¨å…±äº«æ ‡æ³¨åˆ—è¡¨ä¸­ï¼Œæ¯ä¸ªæ ‡æ³¨å¡ç‰‡æ·»åŠ "å…³æ³¨ä½œè€…"æŒ‰é’®:

```typescript
// åœ¨ sharedAnnotationsView.ts ä¸­æ·»åŠ 
async function followAuthor(userId: string): Promise<void> {
  const currentUser = AuthManager.getCurrentUser()
  if (!currentUser) {
    showLoginPrompt()
    return
  }
  
  const supabase = SupabaseManager.getInstance()
  const result = await supabase.followUser(currentUser.id, userId)
  
  if (result.success) {
    showMessage('å·²å…³æ³¨è¯¥ç”¨æˆ·')
    updateFollowButton(userId, true)
  }
}
```

#### 3.3.3 åŠ¨æ€é€šçŸ¥

åœ¨Zoteroæ’ä»¶ä¸­æ·»åŠ é€šçŸ¥å›¾æ ‡ï¼Œæ˜¾ç¤ºæœªè¯»é€šçŸ¥æ•°é‡:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Researchopia                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [ğŸ”” 5]  [ğŸ‘¤]  [âš™ï¸]              â”‚
â”‚                                 â”‚
â”‚  å½“å‰è®ºæ–‡: Deep Learning...      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [å¿«æ·æœç´¢] [ç®¡ç†æ ‡æ³¨]           â”‚
â”‚  [å…±äº«æ ‡æ³¨] [è®ºæ–‡è¯„ä»·]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æŠ€æœ¯æ¶æ„è®¾è®¡

### 4.1 å‰ç«¯æ¶æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”œâ”€â”€ [username]/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # ç”¨æˆ·ä¸»é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ papers/page.tsx       # è®ºæ–‡åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ annotations/page.tsx  # æ ‡æ³¨åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ activity/page.tsx     # åŠ¨æ€åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ edit/page.tsx             # ç¼–è¾‘ä¸ªäººèµ„æ–™
â”‚   â”œâ”€â”€ feed/
â”‚   â”‚   â””â”€â”€ page.tsx                  # åŠ¨æ€æµé¡µé¢
â”‚   â”œâ”€â”€ notifications/
â”‚   â”‚   â””â”€â”€ page.tsx                  # é€šçŸ¥ä¸­å¿ƒ
â”‚   â””â”€â”€ discover/
â”‚       â””â”€â”€ page.tsx                  # å‘ç°é¡µé¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”œâ”€â”€ ProfileHeader.tsx         # ä¸»é¡µå¤´éƒ¨
â”‚   â”‚   â”œâ”€â”€ ProfileStats.tsx          # ç»Ÿè®¡ä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ ProfileTabs.tsx           # æ ‡ç­¾é¡µ
â”‚   â”‚   â”œâ”€â”€ FollowButton.tsx          # å…³æ³¨æŒ‰é’®
â”‚   â”‚   â””â”€â”€ ProfileEdit.tsx           # ç¼–è¾‘è¡¨å•
â”‚   â”œâ”€â”€ feed/
â”‚   â”‚   â”œâ”€â”€ ActivityCard.tsx          # åŠ¨æ€å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ FeedFilter.tsx            # åŠ¨æ€ç­›é€‰
â”‚   â”‚   â””â”€â”€ FeedList.tsx              # åŠ¨æ€åˆ—è¡¨
â”‚   â”œâ”€â”€ social/
â”‚   â”‚   â”œâ”€â”€ FollowList.tsx            # å…³æ³¨åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ UserCard.tsx              # ç”¨æˆ·å¡ç‰‡
â”‚   â”‚   â””â”€â”€ RecommendUsers.tsx        # æ¨èç”¨æˆ·
â”‚   â””â”€â”€ notifications/
â”‚       â”œâ”€â”€ NotificationList.tsx      # é€šçŸ¥åˆ—è¡¨
â”‚       â”œâ”€â”€ NotificationItem.tsx      # é€šçŸ¥é¡¹
â”‚       â””â”€â”€ NotificationBadge.tsx     # é€šçŸ¥å¾½ç« 
â””â”€â”€ lib/
    â”œâ”€â”€ profile.ts                    # ä¸ªäººèµ„æ–™API
    â”œâ”€â”€ follow.ts                     # å…³æ³¨API
    â”œâ”€â”€ activity.ts                   # åŠ¨æ€API
    â””â”€â”€ notifications.ts              # é€šçŸ¥API
```

### 4.2 APIè®¾è®¡

```typescript
// ä¸ªäººèµ„æ–™ API
GET    /api/users/:username/profile      // è·å–ç”¨æˆ·èµ„æ–™
PUT    /api/users/:username/profile      // æ›´æ–°ç”¨æˆ·èµ„æ–™
GET    /api/users/:username/stats        // è·å–ç»Ÿè®¡ä¿¡æ¯

// å…³æ³¨ API
POST   /api/users/:userId/follow         // å…³æ³¨ç”¨æˆ·
DELETE /api/users/:userId/unfollow       // å–æ¶ˆå…³æ³¨
GET    /api/users/:userId/followers      // è·å–å…³æ³¨è€…
GET    /api/users/:userId/following      // è·å–å…³æ³¨ä¸­
GET    /api/users/:userId/is-following   // æ£€æŸ¥å…³æ³¨çŠ¶æ€

// åŠ¨æ€ API
GET    /api/feed                         // è·å–åŠ¨æ€æµ
GET    /api/feed/following               // å…³æ³¨ç”¨æˆ·åŠ¨æ€
GET    /api/feed/recommended             // æ¨èåŠ¨æ€
POST   /api/activities                   // åˆ›å»ºåŠ¨æ€
GET    /api/users/:userId/activities     // ç”¨æˆ·åŠ¨æ€

// é€šçŸ¥ API
GET    /api/notifications                // è·å–é€šçŸ¥åˆ—è¡¨
PUT    /api/notifications/:id/read       // æ ‡è®°å·²è¯»
PUT    /api/notifications/read-all       // å…¨éƒ¨æ ‡è®°å·²è¯»
GET    /api/notifications/unread-count   // æœªè¯»æ•°é‡

// æ¨è API
GET    /api/recommendations/users        // æ¨èç”¨æˆ·
GET    /api/recommendations/papers       // æ¨èè®ºæ–‡
GET    /api/recommendations/annotations  // æ¨èæ ‡æ³¨
```

---

## 5. æ•°æ®åº“è®¾è®¡

### 5.1 æ–°å¢è¡¨ç»“æ„

```sql
-- æ‰©å±•ç”¨æˆ·è¡¨
ALTER TABLE users ADD COLUMN IF NOT EXISTS real_name TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS institution TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS department TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS position TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS research_fields TEXT[] DEFAULT '{}';
ALTER TABLE users ADD COLUMN IF NOT EXISTS orcid TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS google_scholar_id TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS researchgate_id TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS bio TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS website TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS location TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS profile_visibility TEXT DEFAULT 'public';
ALTER TABLE users ADD COLUMN IF NOT EXISTS show_email BOOLEAN DEFAULT false;
ALTER TABLE users ADD COLUMN IF NOT EXISTS show_institution BOOLEAN DEFAULT true;
ALTER TABLE users ADD COLUMN IF NOT EXISTS followers_count INTEGER DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS following_count INTEGER DEFAULT 0;

-- åŠ¨æ€è¡¨
CREATE TABLE IF NOT EXISTS activities (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  type TEXT NOT NULL,
  content TEXT,
  metadata JSONB DEFAULT '{}',
  target_type TEXT,
  target_id UUID,
  visibility TEXT DEFAULT 'public',
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_activities_user_id ON activities(user_id);
CREATE INDEX idx_activities_created_at ON activities(created_at DESC);
CREATE INDEX idx_activities_type ON activities(type);

-- é€šçŸ¥è¡¨
CREATE TABLE IF NOT EXISTS notifications (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  type TEXT NOT NULL,
  actor_id UUID REFERENCES users(id) ON DELETE SET NULL,
  target_type TEXT,
  target_id UUID,
  content TEXT NOT NULL,
  is_read BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);
CREATE INDEX idx_notifications_created_at ON notifications(created_at DESC);

-- æ‰©å±•å…³æ³¨è¡¨ (å·²å­˜åœ¨ï¼Œæ·»åŠ å­—æ®µ)
ALTER TABLE user_follows ADD COLUMN IF NOT EXISTS notification_enabled BOOLEAN DEFAULT true;
ALTER TABLE user_follows ADD COLUMN IF NOT EXISTS tags TEXT[] DEFAULT '{}';

-- ç”¨æˆ·ç»Ÿè®¡è§†å›¾
CREATE OR REPLACE VIEW user_stats AS
SELECT 
  u.id,
  u.username,
  COUNT(DISTINCT p.id) as papers_count,
  COUNT(DISTINCT a.id) as annotations_count,
  COUNT(DISTINCT c.id) as comments_count,
  COUNT(DISTINCT r.id) as ratings_count,
  u.followers_count,
  u.following_count
FROM users u
LEFT JOIN papers p ON p.created_by = u.id
LEFT JOIN annotations a ON a.user_id = u.id AND a.visibility = 'public'
LEFT JOIN comments c ON c.user_id = u.id
LEFT JOIN ratings r ON r.user_id = u.id
GROUP BY u.id, u.username, u.followers_count, u.following_count;
```

### 5.2 è§¦å‘å™¨è®¾è®¡

```sql
-- è‡ªåŠ¨æ›´æ–°å…³æ³¨è®¡æ•°
CREATE OR REPLACE FUNCTION update_follow_counts()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    -- å¢åŠ å…³æ³¨è€…çš„following_count
    UPDATE users SET following_count = following_count + 1 
    WHERE id = NEW.follower_id;
    -- å¢åŠ è¢«å…³æ³¨è€…çš„followers_count
    UPDATE users SET followers_count = followers_count + 1 
    WHERE id = NEW.following_id;
  ELSIF TG_OP = 'DELETE' THEN
    -- å‡å°‘å…³æ³¨è€…çš„following_count
    UPDATE users SET following_count = following_count - 1 
    WHERE id = OLD.follower_id;
    -- å‡å°‘è¢«å…³æ³¨è€…çš„followers_count
    UPDATE users SET followers_count = followers_count - 1 
    WHERE id = OLD.following_id;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_follow_counts
AFTER INSERT OR DELETE ON user_follows
FOR EACH ROW EXECUTE FUNCTION update_follow_counts();

-- è‡ªåŠ¨åˆ›å»ºåŠ¨æ€
CREATE OR REPLACE FUNCTION create_activity_on_action()
RETURNS TRIGGER AS $$
BEGIN
  -- æ ¹æ®ä¸åŒçš„è¡¨å’Œæ“ä½œåˆ›å»ºç›¸åº”çš„åŠ¨æ€
  IF TG_TABLE_NAME = 'annotations' AND TG_OP = 'INSERT' AND NEW.visibility = 'public' THEN
    INSERT INTO activities (user_id, type, content, target_type, target_id, metadata)
    VALUES (NEW.user_id, 'annotation_shared', NEW.content, 'annotation', NEW.id, 
            jsonb_build_object('document_id', NEW.document_id));
  ELSIF TG_TABLE_NAME = 'ratings' AND TG_OP = 'INSERT' THEN
    INSERT INTO activities (user_id, type, content, target_type, target_id, metadata)
    VALUES (NEW.user_id, 'paper_rated', '', 'paper', NEW.paper_id,
            jsonb_build_object('overall_score', NEW.overall_score));
  ELSIF TG_TABLE_NAME = 'user_follows' AND TG_OP = 'INSERT' THEN
    INSERT INTO activities (user_id, type, content, target_type, target_id)
    VALUES (NEW.follower_id, 'user_followed', '', 'user', NEW.following_id);
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- è‡ªåŠ¨åˆ›å»ºé€šçŸ¥
CREATE OR REPLACE FUNCTION create_notification_on_action()
RETURNS TRIGGER AS $$
BEGIN
  -- æ–°å…³æ³¨è€…é€šçŸ¥
  IF TG_TABLE_NAME = 'user_follows' AND TG_OP = 'INSERT' THEN
    INSERT INTO notifications (user_id, type, actor_id, content)
    VALUES (NEW.following_id, 'new_follower', NEW.follower_id, 'å…³æ³¨äº†ä½ ');
  
  -- æ ‡æ³¨è¢«ç‚¹èµé€šçŸ¥
  ELSIF TG_TABLE_NAME = 'annotation_likes' AND TG_OP = 'INSERT' THEN
    INSERT INTO notifications (user_id, type, actor_id, target_type, target_id, content)
    SELECT a.user_id, 'annotation_liked', NEW.user_id, 'annotation', NEW.annotation_id, 'ç‚¹èµäº†ä½ çš„æ ‡æ³¨'
    FROM annotations a WHERE a.id = NEW.annotation_id AND a.user_id != NEW.user_id;
  
  -- è¯„è®ºè¢«å›å¤é€šçŸ¥
  ELSIF TG_TABLE_NAME = 'comments' AND TG_OP = 'INSERT' AND NEW.parent_id IS NOT NULL THEN
    INSERT INTO notifications (user_id, type, actor_id, target_type, target_id, content)
    SELECT c.user_id, 'comment_replied', NEW.user_id, 'comment', NEW.id, 'å›å¤äº†ä½ çš„è¯„è®º'
    FROM comments c WHERE c.id = NEW.parent_id AND c.user_id != NEW.user_id;
  END IF;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## 6. é•¿æœŸå‘å±•è·¯çº¿

### 6.1 åŠŸèƒ½æ‰©å±• (3-6ä¸ªæœˆ)

#### Q1: ç¤¾åŒºåŠŸèƒ½å®Œå–„
- ğŸ”¹ è¯é¢˜ç³»ç»Ÿ (#æ ‡ç­¾)
- ğŸ”¹ å°ç»„/ç ”ç©¶ç»„åŠŸèƒ½
- ğŸ”¹ å­¦æœ¯é—®ç­” (Q&A)
- ğŸ”¹ ä¸“æ /åšå®¢åŠŸèƒ½
- ğŸ”¹ ç§ä¿¡ç³»ç»Ÿ
- ğŸ”¹ å­¦æœ¯æ´»åŠ¨/ä¼šè®®

#### Q2: å†…å®¹å¢å¼º
- ğŸ”¹ è®ºæ–‡è§£è¯»/ç¬”è®°
- ğŸ”¹ æ–‡çŒ®ç»¼è¿°å·¥å…·
- ğŸ”¹ ç ”ç©¶é¡¹ç›®å±•ç¤º
- ğŸ”¹ æ•°æ®é›†åˆ†äº«
- ğŸ”¹ ä»£ç ä»“åº“é›†æˆ
- ğŸ”¹ å¤šåª’ä½“å†…å®¹æ”¯æŒ

#### Q3: æ™ºèƒ½åŒ–åŠŸèƒ½
- ğŸ”¹ AIæ¨èä¼˜åŒ–
- ğŸ”¹ æ™ºèƒ½æ ‡æ³¨å»ºè®®
- ğŸ”¹ è®ºæ–‡ç›¸ä¼¼åº¦åˆ†æ
- ğŸ”¹ ç ”ç©¶è¶‹åŠ¿åˆ†æ
- ğŸ”¹ åˆä½œè€…æ¨è
- ğŸ”¹ è‡ªåŠ¨æ‘˜è¦ç”Ÿæˆ

#### Q4: ç”Ÿæ€å»ºè®¾
- ğŸ”¹ å¼€æ”¾APIå¹³å°
- ğŸ”¹ ç¬¬ä¸‰æ–¹æ’ä»¶å¸‚åœº
- ğŸ”¹ æœºæ„ç‰ˆåŠŸèƒ½
- ğŸ”¹ ä»˜è´¹ä¼šå‘˜ä½“ç³»
- ğŸ”¹ å­¦æœ¯è®¤è¯ç³»ç»Ÿ
- ğŸ”¹ ç§»åŠ¨ç«¯APP

### 6.2 å•†ä¸šåŒ–æ¢ç´¢

#### å…è´¹åŠŸèƒ½ (æ ¸å¿ƒ)
- âœ… åŸºç¡€ä¸ªäººä¸»é¡µ
- âœ… æ ‡æ³¨åˆ†äº«
- âœ… å…³æ³¨å’ŒåŠ¨æ€
- âœ… è®ºæ–‡æœç´¢å’Œè¯„ä»·
- âœ… åŸºç¡€æ¨è

#### é«˜çº§åŠŸèƒ½ (ä¼šå‘˜)
- ğŸ’ é«˜çº§ç»Ÿè®¡åˆ†æ
- ğŸ’ æ— é™åˆ¶æ ‡æ³¨å­˜å‚¨
- ğŸ’ ä¼˜å…ˆæ¨èæƒé‡
- ğŸ’ è‡ªå®šä¹‰ä¸»é¡µæ ·å¼
- ğŸ’ æ•°æ®å¯¼å‡ºåŠŸèƒ½
- ğŸ’ å»å¹¿å‘Š

#### æœºæ„ç‰ˆåŠŸèƒ½
- ğŸ¢ å›¢é˜Ÿåä½œç©ºé—´
- ğŸ¢ æœºæ„ä¸»é¡µ
- ğŸ¢ æˆå‘˜ç®¡ç†
- ğŸ¢ æ•°æ®ç»Ÿè®¡æŠ¥è¡¨
- ğŸ¢ APIè°ƒç”¨é¢åº¦
- ğŸ¢ æŠ€æœ¯æ”¯æŒ

---

## 7. å®æ–½å»ºè®®

### 7.1 æŠ€æœ¯å€ºåŠ¡ç®¡ç†

**éœ€è¦é‡æ„**:
- ç»Ÿä¸€APIå“åº”æ ¼å¼
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- æ·»åŠ ç¼“å­˜å±‚ (Redis)
- å®Œå–„é”™è¯¯å¤„ç†

**éœ€è¦è¡¥å……**:
- å•å…ƒæµ‹è¯•è¦†ç›–
- E2Eæµ‹è¯•
- æ€§èƒ½ç›‘æ§
- æ—¥å¿—ç³»ç»Ÿ

### 7.2 ç”¨æˆ·åé¦ˆæœºåˆ¶

**Betaæµ‹è¯•**:
1. é‚€è¯·10-20åæ´»è·ƒç”¨æˆ·
2. æ”¶é›†åŠŸèƒ½ä½¿ç”¨åé¦ˆ
3. å¿«é€Ÿè¿­ä»£ä¼˜åŒ–
4. é€æ­¥å¼€æ”¾æ³¨å†Œ

**æ•°æ®æŒ‡æ ‡**:
- DAU/MAU (æ—¥æ´»/æœˆæ´»)
- å…³æ³¨è½¬åŒ–ç‡
- åŠ¨æ€äº’åŠ¨ç‡
- åŠŸèƒ½ä½¿ç”¨ç‡
- ç”¨æˆ·ç•™å­˜ç‡