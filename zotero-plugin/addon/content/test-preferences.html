<!DOCTYPE html>
<html>
<head>
    <title>Researchopia 测试面板</title>
    <meta charset="utf-8"/>
</head>
<body>
    <h2>偏好设置测试</h2>
    <p>这是一个简化的测试面板</p>
    
    <button id="simpleTestBtn" style="padding: 10px; font-size: 14px;" onclick="testClick();">简单测试按钮</button>
    <div id="testResult" style="margin-top: 10px; padding: 10px; border: 1px solid #ccc;">等待按钮点击...</div>
    
    <script>
        // 立即执行的基础测试
        (function() {
            console.log('IMMEDIATE: 测试脚本开始执行');
            
            // 显示执行标记
            var resultDiv = document.getElementById('testResult');
            if (resultDiv) {
                resultDiv.innerHTML = '脚本已加载，等待按钮点击...';
                resultDiv.style.backgroundColor = '#fff3cd';
            }
        })();
        
        // 全局函数，用于按钮点击
        function testClick() {
            console.log('CLICK: 按钮被点击了！');
            var resultDiv = document.getElementById('testResult');
            if (resultDiv) {
                resultDiv.innerHTML = '✅ 按钮响应成功！时间: ' + new Date().toLocaleString();
                resultDiv.style.backgroundColor = '#e8f5e8';
            }
            
            // 测试 Zotero 对象访问
            try {
                if (typeof Zotero !== 'undefined') {
                    console.log('Zotero对象可用:', Zotero);
                    resultDiv.innerHTML += '<br>✅ Zotero对象可用';
                } else {
                    console.log('Zotero对象不可用');
                    resultDiv.innerHTML += '<br>❌ Zotero对象不可用';
                }
            } catch (e) {
                console.error('访问Zotero对象出错:', e);
                resultDiv.innerHTML += '<br>❌ 访问Zotero出错: ' + e.message;
            }
        }
        
        // 文档就绪检测
        function checkDocReady() {
            console.log('DOC_READY: 文档状态检查:', document.readyState);
            var resultDiv = document.getElementById('testResult');
            if (resultDiv && document.readyState === 'complete') {
                resultDiv.innerHTML += '<br>📄 文档加载完成';
            }
        }
        
        // 多种初始化检测
        checkDocReady();
        setTimeout(checkDocReady, 100);
        setTimeout(checkDocReady, 500);
        
        if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOMContentLoaded 事件触发');
                checkDocReady();
            });
        }
        
        if (window.addEventListener) {
            window.addEventListener('load', function() {
                console.log('Window load 事件触发');
                checkDocReady();
            });
        }
    </script>
</body>
</html>