# 10.1 çŸ¥è¯†ç½‘ MVP è§„èŒƒ | Knowledge Web MVP Specification

**ç›®æ ‡**: 4-6å‘¨å†…äº¤ä»˜å¯éªŒè¯çš„æœ€å°å¯è¡Œäº§å“

---

## ä¸€ã€MVP èŒƒå›´å®šä¹‰

### 1.1 æ ¸å¿ƒåŠŸèƒ½ (Must Have)

| åŠŸèƒ½ | å…¥å£ | ä¼˜å…ˆçº§ |
|------|------|--------|
| ç½‘é¡µé‡‡é›† | æµè§ˆå™¨æ‰©å±• | P0 |
| æ–‡çŒ®é‡‡é›† | æµè§ˆå™¨æ‰©å±•+ç½‘ç«™ | P0 |
| åˆ›å»ºåŒé“¾ | ç½‘ç«™ | P0 |
| ä¸ªäººçŸ¥è¯†æµ | ç½‘ç«™ | P0 |
| æ”¶è—å¤¹ç®¡ç† | ç½‘ç«™ | P1 |

### 1.2 å»¶åŽåŠŸèƒ½ (Phase 2+)

- âŒ çŸ¥è¯†ç½‘å¯è§†åŒ–
- âŒ å…¨å±€çŸ¥è¯†æµ/æŽ¨èç®—æ³•
- âŒ ç¤¾äº¤åŠŸèƒ½(å…³æ³¨ã€ç‚¹èµž)
- âŒ ZoteroåŒå‘åŒæ­¥
- âŒ ç§»åŠ¨ç«¯

---

## äºŒã€æ•°æ®åº“è®¾è®¡

### 2.1 æ–°å¢žè¡¨

```sql
-- çŸ¥è¯†å•å…ƒè¡¨
CREATE TABLE knowledge_units (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  type TEXT NOT NULL CHECK (type IN ('webpage', 'paper', 'book')),
  identifier TEXT NOT NULL,        -- URL / DOI / ISBN
  title TEXT NOT NULL,
  metadata JSONB DEFAULT '{}',     -- çµæ´»å­˜å‚¨å…ƒä¿¡æ¯
  user_id UUID REFERENCES auth.users(id),
  visibility TEXT DEFAULT 'private' CHECK (visibility IN ('private', 'public')),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, type, identifier) -- åŒä¸€ç”¨æˆ·ä¸é‡å¤æ”¶è—
);

-- çŸ¥è¯†åŒé“¾è¡¨
CREATE TABLE knowledge_links (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  source_id UUID REFERENCES knowledge_units(id) ON DELETE CASCADE,
  target_id UUID REFERENCES knowledge_units(id) ON DELETE CASCADE,
  link_type TEXT DEFAULT 'related' CHECK (link_type IN ('reference', 'related', 'derived')),
  created_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(source_id, target_id)     -- é˜²æ­¢é‡å¤é“¾æŽ¥
);

-- æ”¶è—å¤¹è¡¨ (æ ‡ç­¾=æ”¶è—å¤¹)
CREATE TABLE collections (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  type TEXT NOT NULL CHECK (type IN ('webpage', 'literature', 'mixed')),
  user_id UUID REFERENCES auth.users(id),
  visibility TEXT DEFAULT 'private' CHECK (visibility IN ('private', 'public')),
  created_at TIMESTAMP DEFAULT NOW()
);

-- æ”¶è—å¤¹-çŸ¥è¯†å•å…ƒå…³è”è¡¨
CREATE TABLE collection_units (
  collection_id UUID REFERENCES collections(id) ON DELETE CASCADE,
  unit_id UUID REFERENCES knowledge_units(id) ON DELETE CASCADE,
  added_at TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY(collection_id, unit_id)
);
```

### 2.2 ç´¢å¼•

```sql
CREATE INDEX idx_units_user ON knowledge_units(user_id);
CREATE INDEX idx_units_type ON knowledge_units(type);
CREATE INDEX idx_units_identifier ON knowledge_units(identifier);
CREATE INDEX idx_units_created ON knowledge_units(created_at DESC);
CREATE INDEX idx_links_source ON knowledge_links(source_id);
CREATE INDEX idx_links_target ON knowledge_links(target_id);
```

### 2.3 RLS ç­–ç•¥

```sql
-- çŸ¥è¯†å•å…ƒ: ç§æœ‰åªèƒ½æœ¬äººè®¿é—®ï¼Œå…¬å¼€æ‰€æœ‰äººå¯è§
ALTER TABLE knowledge_units ENABLE ROW LEVEL SECURITY;
CREATE POLICY "units_select" ON knowledge_units FOR SELECT USING (
  visibility = 'public' OR user_id = auth.uid()
);
CREATE POLICY "units_insert" ON knowledge_units FOR INSERT WITH CHECK (user_id = auth.uid());
CREATE POLICY "units_update" ON knowledge_units FOR UPDATE USING (user_id = auth.uid());
CREATE POLICY "units_delete" ON knowledge_units FOR DELETE USING (user_id = auth.uid());
```

---

## ä¸‰ã€API ç«¯ç‚¹è®¾è®¡

### 3.1 çŸ¥è¯†å•å…ƒ API

| æ–¹æ³• | ç«¯ç‚¹ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/proxy/units/create` | åˆ›å»ºçŸ¥è¯†å•å…ƒ |
| GET | `/api/proxy/units/list` | èŽ·å–ç”¨æˆ·çŸ¥è¯†å•å…ƒåˆ—è¡¨ |
| GET | `/api/proxy/units/[id]` | èŽ·å–å•ä¸ªçŸ¥è¯†å•å…ƒè¯¦æƒ… |
| PATCH | `/api/proxy/units/[id]` | æ›´æ–°çŸ¥è¯†å•å…ƒ |
| DELETE | `/api/proxy/units/[id]` | åˆ é™¤çŸ¥è¯†å•å…ƒ |

### 3.2 åŒé“¾ API

| æ–¹æ³• | ç«¯ç‚¹ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/proxy/links/create` | åˆ›å»ºåŒé“¾ |
| GET | `/api/proxy/links/[unitId]` | èŽ·å–çŸ¥è¯†å•å…ƒçš„æ‰€æœ‰å…³è” |
| DELETE | `/api/proxy/links/[id]` | åˆ é™¤åŒé“¾ |

### 3.3 æ”¶è—å¤¹ API

| æ–¹æ³• | ç«¯ç‚¹ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/proxy/collections/create` | åˆ›å»ºæ”¶è—å¤¹ |
| GET | `/api/proxy/collections/list` | èŽ·å–ç”¨æˆ·æ”¶è—å¤¹åˆ—è¡¨ |
| POST | `/api/proxy/collections/add-unit` | æ·»åŠ çŸ¥è¯†å•å…ƒåˆ°æ”¶è—å¤¹ |

---

## å››ã€æµè§ˆå™¨æ‰©å±•æ”¹é€ 

### 4.1 æ–°å¢žåŠŸèƒ½

```javascript
// popup.js æ–°å¢ž
- å½“å‰ç½‘é¡µä¸€é”®æ”¶è—
- DOIæ£€æµ‹åŽä¸€é”®æ”¶è—
- é€‰æ‹©æ”¶è—å¤¹
- å¿«é€Ÿå»ºç«‹åŒé“¾(é€‰æ‹©å·²æœ‰çŸ¥è¯†å•å…ƒ)
```

### 4.2 UI åŽŸåž‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â­ æ”¶è—æ­¤é¡µé¢                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ ‡é¢˜: [è‡ªåŠ¨å¡«å……]            â”‚
â”‚ ç±»åž‹: â—‹ç½‘é¡µ â—‹æ–‡çŒ®           â”‚
â”‚ æ”¶è—å¤¹: [ä¸‹æ‹‰é€‰æ‹©]          â”‚
â”‚ å¯è§æ€§: â—‹ç§å¯† â—‹å…¬å¼€         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ”— å…³è”çŸ¥è¯† (å¯é€‰)          â”‚
â”‚ [æœç´¢å·²æœ‰çŸ¥è¯†å•å…ƒ...]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      [å–æ¶ˆ]  [ä¿å­˜]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€ç½‘ç«™é¡µé¢

### 5.1 æ–°å¢žé¡µé¢

| è·¯ç”± | åŠŸèƒ½ |
|------|------|
| `/knowledge` | ä¸ªäººçŸ¥è¯†æµ(æ—¶é—´çº¿) |
| `/knowledge/[id]` | çŸ¥è¯†å•å…ƒè¯¦æƒ…+å…³è” |
| `/collections` | æ”¶è—å¤¹ç®¡ç† |
| `/collections/[id]` | æ”¶è—å¤¹å†…å®¹ |

### 5.2 çŸ¥è¯†å•å…ƒè¯¦æƒ…é¡µç»“æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ“„ çŸ¥è¯†å•å…ƒæ ‡é¢˜                     â”‚
â”‚ ç±»åž‹: ç½‘é¡µ | URL: https://...       â”‚
â”‚ æ”¶è—æ—¶é—´: 2025-12-04               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ“ ç¬”è®°åŒº (Phase 2)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ”— å…³è”çŸ¥è¯† (3)                     â”‚
â”‚ â”œâ”€ [è®ºæ–‡] xxx (åŒå‘)               â”‚
â”‚ â”œâ”€ [ç½‘é¡µ] yyy (æˆ‘å…³è”çš„)           â”‚
â”‚ â””â”€ [ç½‘é¡µ] zzz (ä»–äººå…³è”)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€é‡Œç¨‹ç¢‘

| å‘¨æ¬¡ | ç›®æ ‡ | äº¤ä»˜ç‰© |
|------|------|--------|
| W1 | æ•°æ®åº“+API | 4è¡¨+6ç«¯ç‚¹ |
| W2 | æ‰©å±•é‡‡é›† | ç½‘é¡µ/æ–‡çŒ®ä¸€é”®æ”¶è— |
| W3 | åŒé“¾åŠŸèƒ½ | åˆ›å»º/å±•ç¤ºå…³è” |
| W4 | çŸ¥è¯†æµ | æ—¶é—´çº¿é¡µé¢ |
| W5 | æ”¶è—å¤¹ | åˆ†ç±»ç®¡ç† |
| W6 | æµ‹è¯•+ä¼˜åŒ– | MVPä¸Šçº¿ |

---

## ä¸ƒã€æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|--------|
| é‡‡é›†æˆåŠŸçŽ‡ | >95% |
| é¦–æ¬¡é‡‡é›†è€—æ—¶ | <2s |
| åŒé“¾åˆ›å»ºè€—æ—¶ | <1s |
| çŸ¥è¯†æµåŠ è½½ | <500ms |

---

*æ–‡æ¡£ç‰ˆæœ¬: v0.1 | åˆ›å»º: 2025-12-04*
