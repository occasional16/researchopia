# Researchopia å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¨æµç¨‹æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¶é—´**: 2025-01-07
- **çŠ¶æ€**: å¼€å‘æ–¹æ¡ˆ
- **ä¼˜å…ˆçº§**: ä¸­
- **ç›®æ ‡**: å°† https://www.researchopia.com/ ç§»æ¤ä¸ºå¾®ä¿¡å°ç¨‹åº

---

## 1. é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 ä¸ºä»€ä¹ˆè¦å¼€å‘å°ç¨‹åº?

**æ ¸å¿ƒä¼˜åŠ¿**:
- âœ… **ç”¨æˆ·ä¹ æƒ¯**: å¾®ä¿¡11äº¿DAU,å­¦æœ¯ç”¨æˆ·é«˜åº¦é‡åˆ
- âœ… **æ— éœ€å®‰è£…**: å³ç”¨å³èµ°,é™ä½ä½¿ç”¨é—¨æ§›
- âœ… **æµç•…ä½“éªŒ**: åŸç”Ÿç»„ä»¶,æ¯”H5æ›´æµç•…
- âœ… **ç¤¾äº¤ä¼ æ’­**: åˆ†äº«è®ºæ–‡/æ ‡æ³¨åˆ°å¾®ä¿¡å¥½å‹/ç¾¤èŠ
- âœ… **æ¨é€é€šçŸ¥**: æ¨¡æ¿æ¶ˆæ¯æé†’(ä¼šè¯é‚€è¯·ã€æ–°æ ‡æ³¨)

**ä¸ç°æœ‰Webç«™çš„å…³ç³»**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Researchopia ç”Ÿæ€                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Webç½‘ç«™ (PCç«¯ä¸»åŠ›)                          â”‚
â”‚  â†“                                          â”‚
â”‚  å¾®ä¿¡å°ç¨‹åº (ç§»åŠ¨ç«¯ä¸»åŠ›)                      â”‚
â”‚  â†“                                          â”‚
â”‚  Zoteroæ’ä»¶ (æ¡Œé¢ç«¯æ·±åº¦é›†æˆ)                 â”‚
â”‚  â†“                                          â”‚
â”‚  æµè§ˆå™¨æ‰©å±• (Webè¾…åŠ©)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â”€â–¶ å…±äº«åç«¯: Supabase
```

### 1.2 åŠŸèƒ½èŒƒå›´å®šä¹‰

**MVP (Minimum Viable Product) é˜¶æ®µ**:
- âœ… ç”¨æˆ·è®¤è¯(å¾®ä¿¡ç™»å½•)
- âœ… è®ºæ–‡æœç´¢(DOI/æ ‡é¢˜)
- âœ… è®ºæ–‡è¯¦æƒ…å±•ç¤º
- âœ… å…±äº«æ ‡æ³¨æŸ¥çœ‹
- âœ… æ–‡çŒ®å…±è¯»ä¼šè¯(æŸ¥çœ‹/åŠ å…¥)
- âœ… ä¸ªäººä¸­å¿ƒ

**è¿›é˜¶åŠŸèƒ½(äºŒæœŸ)**:
- ğŸ“ åœ¨çº¿æ ‡æ³¨(PDFé¢„è§ˆ + æ–‡å­—é«˜äº®)
- ğŸ’¬ æ ‡æ³¨è¯„è®º/ç‚¹èµ
- ğŸ‘¥ ç”¨æˆ·å…³æ³¨/ç²‰ä¸
- ğŸ“Š ä¸ªäººæ•°æ®ç»Ÿè®¡
- ğŸ”” æ¶ˆæ¯é€šçŸ¥(æ¨¡æ¿æ¶ˆæ¯)
- ğŸŒ ç¤¾åŒºåŠ¨æ€æµ

**æš‚ä¸å®ç°**:
- âŒ PDFå®Œæ•´é˜…è¯»å™¨(å»ºè®®è·³è½¬Webæˆ–ä¸‹è½½)
- âŒ å¤æ‚å›¾è¡¨æ¸²æŸ“(æŠ€æœ¯å—é™)
- âŒ è§†é¢‘/éŸ³é¢‘æ ‡æ³¨(å°ç¨‹åºåŒ…ä½“ç§¯é™åˆ¶)

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 å¼€å‘æ¡†æ¶å¯¹æ¯”

| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èåº¦ |
|------|------|------|--------|
| **åŸç”Ÿå°ç¨‹åº** | æ€§èƒ½æœ€ä¼˜ã€æ–‡æ¡£å…¨ | å¼€å‘æ•ˆç‡ä½ã€ä»£ç å†—ä½™ | â­â­â­ |
| **uni-app** | ä¸€æ¬¡ç¼–å†™å¤šç«¯å‘å¸ƒ | æ€§èƒ½ç•¥å·®ã€ç¤¾åŒºåˆ†æ•£ | â­â­â­â­ |
| **Taro** | Reactè¯­æ³•ã€ç»„ä»¶ä¸°å¯Œ | ç¼–è¯‘åä»£ç ä½“ç§¯å¤§ | â­â­â­â­â­ |
| **mpvue** | Vueè¯­æ³•ã€ä¸Šæ‰‹ç®€å• | å·²åœæ­¢ç»´æŠ¤ | â­ |

**æœ€ç»ˆé€‰æ‹©**: **Taro 4.x** (Reactè¯­æ³•)

**ç†ç”±**:
1. é¡¹ç›®å·²ä½¿ç”¨React(Next.js),å¤ç”¨ç»„ä»¶é€»è¾‘
2. TypeScriptæ”¯æŒå®Œå–„
3. ç¤¾åŒºæ´»è·ƒ,äº¬ä¸œå›¢é˜Ÿç»´æŠ¤
4. æ”¯æŒå¤šç«¯å‘å¸ƒ(åç»­å¯æ‰©å±•åˆ°æ”¯ä»˜å®/ç™¾åº¦å°ç¨‹åº)
5. ç»„ä»¶åº“ä¸°å¯Œ(Taro UI)

### 2.2 æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯å±‚                                      â”‚
â”‚  - Taro 4.x (React 18)                      â”‚
â”‚  - TypeScript                                â”‚
â”‚  - Taro UI (UIç»„ä»¶åº“)                        â”‚
â”‚  - MobX (çŠ¶æ€ç®¡ç†)                           â”‚
â”‚  - Taro-Axios (HTTPè¯·æ±‚)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ HTTPS/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸­é—´å±‚                                      â”‚
â”‚  - Next.js API Routes (ç°æœ‰)                 â”‚
â”‚  - Vercel Edge Functions                    â”‚
â”‚  - å¾®ä¿¡å°ç¨‹åºæœåŠ¡ç«¯API                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯å±‚                                      â”‚
â”‚  - Supabase (å¤ç”¨ç°æœ‰)                       â”‚
â”‚  - PostgreSQL (æ•°æ®åº“)                       â”‚
â”‚  - Supabase Auth (è®¤è¯)                      â”‚
â”‚  - Supabase Storage (æ–‡ä»¶å­˜å‚¨)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒä¾èµ–**:
```json
{
  "dependencies": {
    "@tarojs/components": "4.1.0",
    "@tarojs/runtime": "4.1.0",
    "@tarojs/taro": "4.1.0",
    "@tarojs/plugin-platform-weapp": "4.1.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "mobx": "^6.13.5",
    "mobx-react": "^9.1.0",
    "taro-ui": "^3.3.1",
    "axios": "^1.12.2"
  },
  "devDependencies": {
    "@tarojs/cli": "4.1.0",
    "@tarojs/webpack5-runner": "4.1.0",
    "@types/react": "^18.2.0",
    "typescript": "^5.6.3",
    "eslint": "^9.15.0"
  }
}
```

---

## 3. é¡¹ç›®ç»“æ„è®¾è®¡

### 3.1 ç›®å½•ç»“æ„

```
wechat-miniprogram/
â”œâ”€â”€ project.config.json       # å¾®ä¿¡å¼€å‘è€…å·¥å…·é…ç½®
â”œâ”€â”€ package.json              # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ tsconfig.json             # TypeScripté…ç½®
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ index.ts             # TaroåŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ dev.ts               # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ prod.ts              # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.config.ts        # å…¨å±€é…ç½®(é¡µé¢è·¯ç”±ã€çª—å£æ ·å¼)
â”‚   â”œâ”€â”€ app.tsx              # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ app.scss             # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ index.html           # H5æ¨¡æ¿(å¯é€‰)
â”‚   â”œâ”€â”€ pages/               # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index/           # é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ index.config.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.scss
â”‚   â”‚   â”œâ”€â”€ search/          # æœç´¢é¡µ
â”‚   â”‚   â”œâ”€â”€ paper-detail/    # è®ºæ–‡è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ session-list/    # ä¼šè¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ session-detail/  # ä¼šè¯è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ my-annotations/  # æˆ‘çš„æ ‡æ³¨
â”‚   â”‚   â”œâ”€â”€ profile/         # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ login/           # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ components/          # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ PaperCard/       # è®ºæ–‡å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ AnnotationItem/  # æ ‡æ³¨æ¡ç›®
â”‚   â”‚   â”œâ”€â”€ SessionCard/     # ä¼šè¯å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ UserAvatar/      # ç”¨æˆ·å¤´åƒ
â”‚   â”‚   â””â”€â”€ EmptyState/      # ç©ºçŠ¶æ€
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ api.ts          # APIå°è£…
â”‚   â”‚   â”œâ”€â”€ auth.ts         # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ paper.ts        # è®ºæ–‡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ session.ts      # ä¼šè¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ annotation.ts   # æ ‡æ³¨æœåŠ¡
â”‚   â”œâ”€â”€ stores/              # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ user.ts         # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ paper.ts        # è®ºæ–‡çŠ¶æ€
â”‚   â”‚   â””â”€â”€ session.ts      # ä¼šè¯çŠ¶æ€
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.ts      # HTTPè¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ storage.ts      # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ logger.ts       # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ helpers.ts      # é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ types/               # TypeScriptç±»å‹
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ paper.ts
â”‚   â”‚   â””â”€â”€ session.ts
â”‚   â””â”€â”€ constants/           # å¸¸é‡
â”‚       â”œâ”€â”€ config.ts       # é…ç½®å¸¸é‡
â”‚       â””â”€â”€ enums.ts        # æšä¸¾
â””â”€â”€ dist/                    # ç¼–è¯‘è¾“å‡º(gitignore)
```

### 3.2 æ ¸å¿ƒé…ç½®æ–‡ä»¶

#### 3.2.1 project.config.json (å¾®ä¿¡å¼€å‘è€…å·¥å…·é…ç½®)
```json
{
  "miniprogramRoot": "dist/",
  "projectname": "researchopia",
  "description": "ç ”å­¦æ¸¯ - å­¦æœ¯äº¤æµä¸å…±äº«å¹³å°",
  "appid": "wxXXXXXXXXXXXXXXXX",  // éœ€ç”³è¯·
  "setting": {
    "urlCheck": true,
    "es6": false,
    "enhance": true,
    "compileHotReLoad": true,
    "postcss": true,
    "minified": true,
    "babelSetting": {
      "ignore": [],
      "disablePlugins": [],
      "outputPath": ""
    }
  },
  "compileType": "miniprogram",
  "condition": {},
  "editorSetting": {
    "tabIndent": "insertSpaces",
    "tabSize": 2
  }
}
```

#### 3.2.2 config/index.ts (Taroé…ç½®)
```typescript
import { defineConfig, type UserConfigExport } from '@tarojs/cli'

export default defineConfig({
  projectName: 'researchopia-miniprogram',
  date: '2025-1-7',
  designWidth: 750,  // è®¾è®¡ç¨¿å®½åº¦(åŸºäº750px)
  deviceRatio: {
    640: 2.34 / 2,
    750: 1,
    375: 2,
    828: 1.81 / 2
  },
  sourceRoot: 'src',
  outputRoot: 'dist',
  plugins: [],
  defineConstants: {},
  copy: {
    patterns: [],
    options: {}
  },
  framework: 'react',
  compiler: {
    type: 'webpack5',
    prebundle: { enable: false }
  },
  cache: {
    enable: false
  },
  mini: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          selectorBlackList: ['van-']  // å¿½ç•¥vantç»„ä»¶
        }
      },
      url: {
        enable: true,
        config: {
          limit: 1024  // å°äº1kbè½¬base64
        }
      },
      cssModules: {
        enable: false,
        config: {
          namingPattern: 'module',
          generateScopedName: '[name]__[local]___[hash:base64:5]'
        }
      }
    },
    webpackChain(chain) {
      // è‡ªå®šä¹‰Webpacké…ç½®
    }
  },
  h5: {
    publicPath: '/',
    staticDirectory: 'static',
    output: {
      filename: 'js/[name].[hash:8].js',
      chunkFilename: 'js/[name].[chunkhash:8].js'
    },
    miniCssExtractPluginOption: {
      ignoreOrder: true,
      filename: 'css/[name].[hash].css',
      chunkFilename: 'css/[name].[chunkhash].css'
    },
    postcss: {
      autoprefixer: {
        enable: true
      }
    }
  }
})
```

#### 3.2.3 src/app.config.ts (å…¨å±€é…ç½®)
```typescript
export default defineAppConfig({
  pages: [
    'pages/index/index',
    'pages/search/index',
    'pages/paper-detail/index',
    'pages/session-list/index',
    'pages/session-detail/index',
    'pages/my-annotations/index',
    'pages/profile/index',
    'pages/login/index'
  ],
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: 'ç ”å­¦æ¸¯',
    navigationBarTextStyle: 'black',
    enablePullDownRefresh: true
  },
  tabBar: {
    color: '#7A7E83',
    selectedColor: '#3cc51f',
    borderStyle: 'black',
    backgroundColor: '#ffffff',
    list: [
      {
        pagePath: 'pages/index/index',
        iconPath: 'assets/icons/home.png',
        selectedIconPath: 'assets/icons/home-active.png',
        text: 'é¦–é¡µ'
      },
      {
        pagePath: 'pages/search/index',
        iconPath: 'assets/icons/search.png',
        selectedIconPath: 'assets/icons/search-active.png',
        text: 'æœç´¢'
      },
      {
        pagePath: 'pages/session-list/index',
        iconPath: 'assets/icons/session.png',
        selectedIconPath: 'assets/icons/session-active.png',
        text: 'å…±è¯»'
      },
      {
        pagePath: 'pages/profile/index',
        iconPath: 'assets/icons/profile.png',
        selectedIconPath: 'assets/icons/profile-active.png',
        text: 'æˆ‘çš„'
      }
    ]
  },
  permission: {
    'scope.userLocation': {
      desc: 'æ‚¨çš„ä½ç½®ä¿¡æ¯å°†ç”¨äºå°ç¨‹åºä½ç½®æ¥å£çš„æ•ˆæœå±•ç¤º'
    }
  },
  requiredPrivateInfos: [],
  lazyCodeLoading: 'requiredComponents'  // æŒ‰éœ€æ³¨å…¥
})
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 4.1 ç”¨æˆ·è®¤è¯(å¾®ä¿¡ç™»å½•)

#### 4.1.1 æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å°ç¨‹åº      â”‚     â”‚  Next.js API â”‚     â”‚  Supabase    â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚  wx.login()  â”‚â”€â”€â”€â”€â–¶â”‚  /api/wx/    â”‚â”€â”€â”€â”€â–¶â”‚  auth.       â”‚
â”‚              â”‚     â”‚  login       â”‚     â”‚  signIn()    â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚  è·å–token   â”‚â—€â”€â”€â”€â”€â”‚  è¿”å›JWT     â”‚â—€â”€â”€â”€â”€â”‚  è¿”å›JWT     â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚  å­˜å‚¨token   â”‚     â”‚              â”‚     â”‚              â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚  è¯·æ±‚API     â”‚â”€â”€â”€â”€â–¶â”‚  éªŒè¯token   â”‚â”€â”€â”€â”€â–¶â”‚  RLSé‰´æƒ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.2 å°ç¨‹åºç«¯ä»£ç 
```typescript
// src/services/auth.ts
import Taro from '@tarojs/taro'
import { request } from '@/utils/request'

export class AuthService {
  /**
   * å¾®ä¿¡ç™»å½•
   */
  static async login(): Promise<void> {
    try {
      // 1. è°ƒç”¨å¾®ä¿¡ç™»å½•API
      const { code } = await Taro.login()
      
      if (!code) {
        throw new Error('è·å–å¾®ä¿¡ç™»å½•codeå¤±è´¥')
      }
      
      // 2. è°ƒç”¨åç«¯API,ç”¨codeæ¢å–token
      const res = await request({
        url: '/api/wx/login',
        method: 'POST',
        data: { code }
      })
      
      // 3. å­˜å‚¨token
      await Taro.setStorageSync('access_token', res.access_token)
      await Taro.setStorageSync('refresh_token', res.refresh_token)
      await Taro.setStorageSync('user', res.user)
      
      // 4. æ›´æ–°å…¨å±€çŠ¶æ€
      const userStore = useUserStore()
      userStore.setUser(res.user)
      userStore.setToken(res.access_token)
      
      Taro.showToast({
        title: 'ç™»å½•æˆåŠŸ',
        icon: 'success'
      })
      
    } catch (error) {
      console.error('[Auth] Login failed:', error)
      Taro.showToast({
        title: 'ç™»å½•å¤±è´¥,è¯·é‡è¯•',
        icon: 'none'
      })
      throw error
    }
  }
  
  /**
   * æ£€æŸ¥ç™»å½•çŠ¶æ€
   */
  static async checkLoginStatus(): Promise<boolean> {
    try {
      const token = await Taro.getStorageSync('access_token')
      if (!token) return false
      
      // éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆ
      const res = await request({
        url: '/api/auth/verify',
        method: 'POST',
        data: { token }
      })
      
      return res.valid
    } catch (error) {
      return false
    }
  }
  
  /**
   * é€€å‡ºç™»å½•
   */
  static async logout(): Promise<void> {
    await Taro.removeStorageSync('access_token')
    await Taro.removeStorageSync('refresh_token')
    await Taro.removeStorageSync('user')
    
    const userStore = useUserStore()
    userStore.clearUser()
    
    Taro.reLaunch({
      url: '/pages/login/index'
    })
  }
}
```

#### 4.1.3 åç«¯API (Next.js)
```typescript
// src/app/api/wx/login/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@supabase/supabase-js'

const WECHAT_APP_ID = process.env.WECHAT_APP_ID!
const WECHAT_APP_SECRET = process.env.WECHAT_APP_SECRET!

export async function POST(request: NextRequest) {
  try {
    const { code } = await request.json()
    
    // 1. ç”¨codeæ¢å–openidå’Œsession_key
    const wxResponse = await fetch(
      `https://api.weixin.qq.com/sns/jscode2session?` +
      `appid=${WECHAT_APP_ID}&` +
      `secret=${WECHAT_APP_SECRET}&` +
      `js_code=${code}&` +
      `grant_type=authorization_code`
    )
    
    const wxData = await wxResponse.json()
    
    if (wxData.errcode) {
      return NextResponse.json(
        { error: 'å¾®ä¿¡ç™»å½•å¤±è´¥', details: wxData.errmsg },
        { status: 400 }
      )
    }
    
    const { openid, session_key } = wxData
    
    // 2. åœ¨Supabaseä¸­æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
    const supabase = createClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.SUPABASE_SERVICE_ROLE_KEY!  // ä½¿ç”¨Service Role Key
    )
    
    // æŸ¥æ‰¾ç”¨æˆ·
    let { data: user } = await supabase
      .from('users')
      .select('*')
      .eq('wechat_openid', openid)
      .single()
    
    // å¦‚æœç”¨æˆ·ä¸å­˜åœ¨,åˆ›å»ºæ–°ç”¨æˆ·
    if (!user) {
      const { data: newUser, error: createError } = await supabase
        .from('users')
        .insert({
          wechat_openid: openid,
          username: `å¾®ä¿¡ç”¨æˆ·_${openid.slice(0, 8)}`,
          created_at: new Date()
        })
        .select()
        .single()
      
      if (createError) throw createError
      user = newUser
    }
    
    // 3. ç”ŸæˆJWT token
    const { data: authData, error: signInError } = await supabase.auth.signInWithPassword({
      email: `${openid}@wechat.researchopia.com`,  // è™šæ‹Ÿé‚®ç®±
      password: session_key  // ä½¿ç”¨session_keyä½œä¸ºå¯†ç 
    })
    
    // å¦‚æœç”¨æˆ·ä¸å­˜åœ¨äºauth.usersè¡¨,å…ˆåˆ›å»º
    if (signInError) {
      const { data: authUser } = await supabase.auth.admin.createUser({
        email: `${openid}@wechat.researchopia.com`,
        password: session_key,
        email_confirm: true,
        user_metadata: {
          openid,
          platform: 'wechat'
        }
      })
      
      // é‡æ–°ç™»å½•
      const { data: retryAuth } = await supabase.auth.signInWithPassword({
        email: `${openid}@wechat.researchopia.com`,
        password: session_key
      })
      
      return NextResponse.json({
        access_token: retryAuth?.session?.access_token,
        refresh_token: retryAuth?.session?.refresh_token,
        user: {
          id: user.id,
          username: user.username,
          avatar: user.avatar,
          openid: openid
        }
      })
    }
    
    return NextResponse.json({
      access_token: authData.session?.access_token,
      refresh_token: authData.session?.refresh_token,
      user: {
        id: user.id,
        username: user.username,
        avatar: user.avatar,
        openid: openid
      }
    })
    
  } catch (error) {
    console.error('[WX Login] Error:', error)
    return NextResponse.json(
      { error: 'æœåŠ¡å™¨é”™è¯¯' },
      { status: 500 }
    )
  }
}
```

### 4.2 è®ºæ–‡æœç´¢

```typescript
// src/pages/search/index.tsx
import { useState } from 'react'
import Taro from '@tarojs/taro'
import { View, Input, Button } from '@tarojs/components'
import { AtSearchBar } from 'taro-ui'
import { PaperService } from '@/services/paper'
import PaperCard from '@/components/PaperCard'
import EmptyState from '@/components/EmptyState'

export default function SearchPage() {
  const [keyword, setKeyword] = useState('')
  const [papers, setPapers] = useState([])
  const [loading, setLoading] = useState(false)
  
  const handleSearch = async () => {
    if (!keyword.trim()) {
      Taro.showToast({
        title: 'è¯·è¾“å…¥æœç´¢å…³é”®è¯',
        icon: 'none'
      })
      return
    }
    
    setLoading(true)
    
    try {
      const results = await PaperService.search(keyword)
      setPapers(results)
      
      if (results.length === 0) {
        Taro.showToast({
          title: 'æœªæ‰¾åˆ°ç›¸å…³è®ºæ–‡',
          icon: 'none'
        })
      }
    } catch (error) {
      Taro.showToast({
        title: 'æœç´¢å¤±è´¥,è¯·é‡è¯•',
        icon: 'none'
      })
    } finally {
      setLoading(false)
    }
  }
  
  const handlePaperClick = (doi: string) => {
    Taro.navigateTo({
      url: `/pages/paper-detail/index?doi=${encodeURIComponent(doi)}`
    })
  }
  
  return (
    <View className='search-page'>
      <AtSearchBar
        value={keyword}
        onChange={setKeyword}
        onActionClick={handleSearch}
        placeholder='æœç´¢DOIæˆ–è®ºæ–‡æ ‡é¢˜'
      />
      
      {loading && (
        <View className='loading'>
          <AtActivityIndicator />
        </View>
      )}
      
      {!loading && papers.length === 0 && (
        <EmptyState
          icon='search'
          text='æš‚æ— æœç´¢ç»“æœ'
        />
      )}
      
      {!loading && papers.length > 0 && (
        <View className='results'>
          {papers.map(paper => (
            <PaperCard
              key={paper.doi}
              paper={paper}
              onClick={() => handlePaperClick(paper.doi)}
            />
          ))}
        </View>
      )}
    </View>
  )
}
```

### 4.3 è®ºæ–‡è¯¦æƒ…

```typescript
// src/pages/paper-detail/index.tsx
import { useEffect, useState } from 'react'
import Taro, { useRouter } from '@tarojs/taro'
import { View, Text, Button } from '@tarojs/components'
import { PaperService } from '@/services/paper'
import { AnnotationService } from '@/services/annotation'
import AnnotationItem from '@/components/AnnotationItem'

export default function PaperDetailPage() {
  const router = useRouter()
  const { doi } = router.params
  
  const [paper, setPaper] = useState(null)
  const [annotations, setAnnotations] = useState([])
  const [loading, setLoading] = useState(true)
  
  useEffect(() => {
    if (doi) {
      loadPaperDetail(decodeURIComponent(doi))
    }
  }, [doi])
  
  const loadPaperDetail = async (doi: string) => {
    try {
      setLoading(true)
      
      // å¹¶è¡ŒåŠ è½½è®ºæ–‡è¯¦æƒ…å’Œæ ‡æ³¨
      const [paperData, annotationsData] = await Promise.all([
        PaperService.getByDOI(doi),
        AnnotationService.getByDOI(doi)
      ])
      
      setPaper(paperData)
      setAnnotations(annotationsData)
      
    } catch (error) {
      Taro.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'none'
      })
    } finally {
      setLoading(false)
    }
  }
  
  const handleShare = () => {
    Taro.showShareMenu({
      withShareTicket: true,
      menus: ['shareAppMessage', 'shareTimeline']
    })
  }
  
  // åˆ†äº«é…ç½®
  Taro.useShareAppMessage(() => {
    return {
      title: paper?.title || 'ç ”å­¦æ¸¯ - å­¦æœ¯è®ºæ–‡',
      path: `/pages/paper-detail/index?doi=${encodeURIComponent(doi)}`,
      imageUrl: 'https://www.researchopia.com/og-image.png'
    }
  })
  
  return (
    <View className='paper-detail-page'>
      {loading && <AtActivityIndicator />}
      
      {!loading && paper && (
        <>
          {/* è®ºæ–‡ä¿¡æ¯ */}
          <View className='paper-info'>
            <Text className='title'>{paper.title}</Text>
            <Text className='authors'>{paper.authors?.join(', ')}</Text>
            <Text className='journal'>{paper.journal}</Text>
            <Text className='doi'>DOI: {paper.doi}</Text>
          </View>
          
          {/* æ“ä½œæŒ‰é’® */}
          <View className='actions'>
            <Button onClick={handleShare}>åˆ†äº«</Button>
            <Button onClick={() => Taro.navigateTo({
              url: `/pages/session-list/index?doi=${doi}`
            })}>
              æŸ¥çœ‹å…±è¯»ä¼šè¯
            </Button>
          </View>
          
          {/* æ‘˜è¦ */}
          {paper.abstract && (
            <View className='abstract'>
              <Text className='section-title'>æ‘˜è¦</Text>
              <Text className='content'>{paper.abstract}</Text>
            </View>
          )}
          
          {/* å…±äº«æ ‡æ³¨ */}
          <View className='annotations'>
            <Text className='section-title'>
              å…±äº«æ ‡æ³¨ ({annotations.length})
            </Text>
            
            {annotations.length === 0 && (
              <EmptyState
                icon='annotation'
                text='æš‚æ— æ ‡æ³¨'
              />
            )}
            
            {annotations.map(annotation => (
              <AnnotationItem
                key={annotation.id}
                annotation={annotation}
              />
            ))}
          </View>
        </>
      )}
    </View>
  )
}
```

### 4.4 çŠ¶æ€ç®¡ç† (MobX)

```typescript
// src/stores/user.ts
import { makeAutoObservable } from 'mobx'
import Taro from '@tarojs/taro'

export class UserStore {
  user: User | null = null
  token: string | null = null
  isLoggedIn: boolean = false
  
  constructor() {
    makeAutoObservable(this)
    this.loadFromStorage()
  }
  
  async loadFromStorage() {
    try {
      const user = await Taro.getStorageSync('user')
      const token = await Taro.getStorageSync('access_token')
      
      if (user && token) {
        this.user = user
        this.token = token
        this.isLoggedIn = true
      }
    } catch (error) {
      console.error('[UserStore] Load from storage failed:', error)
    }
  }
  
  setUser(user: User) {
    this.user = user
    this.isLoggedIn = true
  }
  
  setToken(token: string) {
    this.token = token
  }
  
  clearUser() {
    this.user = null
    this.token = null
    this.isLoggedIn = false
  }
}

export const userStore = new UserStore()
```

---

## 5. å¼€å‘æµç¨‹

### 5.1 ç¯å¢ƒæ­å»º

#### 5.1.1 å®‰è£…ä¾èµ–å·¥å…·

```bash
# 1. å®‰è£…Node.js (æ¨èv18+)
node -v

# 2. å®‰è£…Taro CLI
npm install -g @tarojs/cli@4.1.0

# 3. ä¸‹è½½å¾®ä¿¡å¼€å‘è€…å·¥å…·
# https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
```

#### 5.1.2 åˆ›å»ºé¡¹ç›®

```bash
# 1. åˆ›å»ºTaroé¡¹ç›®
taro init researchopia-miniprogram

# é€‰æ‹©é…ç½®:
# - æ¡†æ¶: React
# - TypeScript: Yes
# - CSSé¢„å¤„ç†å™¨: Sass
# - æ¨¡æ¿: é»˜è®¤æ¨¡æ¿

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd researchopia-miniprogram

# 3. å®‰è£…ä¾èµ–
npm install

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev:weapp
```

#### 5.1.3 é…ç½®å¾®ä¿¡å¼€å‘è€…å·¥å…·

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. å¯¼å…¥é¡¹ç›® â†’ é€‰æ‹© `dist/` ç›®å½•
3. å¡«å†™ AppID (å…ˆç”¨æµ‹è¯•å·)
4. å¼€å¯"ä¸æ ¡éªŒåˆæ³•åŸŸå"(å¼€å‘é˜¶æ®µ)

### 5.2 å¼€å‘å·¥ä½œæµ

```mermaid
graph LR
    A[ç¼–å†™ä»£ç ] -->|Taroç¼–è¯‘| B[ç”Ÿæˆå°ç¨‹åºä»£ç ]
    B --> C[å¾®ä¿¡å¼€å‘è€…å·¥å…·]
    C -->|çƒ­é‡è½½| D[é¢„è§ˆ/è°ƒè¯•]
    D -->|å‘ç°é—®é¢˜| A
    D -->|æµ‹è¯•é€šè¿‡| E[æäº¤ä»£ç ]
```

**å…³é”®å‘½ä»¤**:
```bash
# å¼€å‘æ¨¡å¼(çƒ­é‡è½½)
npm run dev:weapp

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build:weapp

# å¤šç«¯æ„å»º
npm run build:h5        # H5ç‰ˆæœ¬
npm run build:alipay    # æ”¯ä»˜å®å°ç¨‹åº
npm run build:swan      # ç™¾åº¦å°ç¨‹åº
```

### 5.3 è°ƒè¯•æŠ€å·§

#### 5.3.1 çœŸæœºè°ƒè¯•
```bash
# 1. å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ é¢„è§ˆ
# 2. æ‰‹æœºæ‰«ç 
# 3. å¼€å¯vconsoleè°ƒè¯•
```

```typescript
// src/app.tsx
if (process.env.NODE_ENV === 'development') {
  // å¼€å¯vconsole
  const vConsole = new VConsole()
}
```

#### 5.3.2 ç½‘ç»œè¯·æ±‚è°ƒè¯•
```typescript
// src/utils/request.ts
import Taro from '@tarojs/taro'

Taro.addInterceptor(Taro.interceptors.logInterceptor)  // æ‰“å°è¯·æ±‚æ—¥å¿—

export function request(options) {
  console.log('[Request]', options.url, options.data)
  
  return Taro.request({
    ...options,
    header: {
      'Authorization': `Bearer ${getToken()}`,
      ...options.header
    }
  }).then(res => {
    console.log('[Response]', res.data)
    return res.data
  }).catch(err => {
    console.error('[Request Error]', err)
    throw err
  })
}
```

---

## 6. æµ‹è¯•ä¸ä¼˜åŒ–

### 6.1 æ€§èƒ½ä¼˜åŒ–

#### 6.1.1 ä»£ç åŒ…ä¼˜åŒ–
```javascript
// config/index.ts
export default {
  mini: {
    // åˆ†åŒ…é…ç½®
    subpackages: [
      {
        root: 'pages/session',
        pages: [
          'session-list/index',
          'session-detail/index'
        ]
      },
      {
        root: 'pages/profile',
        pages: [
          'profile/index',
          'my-annotations/index'
        ]
      }
    ],
    // é¢„åŠ è½½
    preloadRule: {
      'pages/index/index': {
        network: 'all',
        packages: ['pages/session']
      }
    }
  }
}
```

#### 6.1.2 å›¾ç‰‡ä¼˜åŒ–
```typescript
// ä½¿ç”¨WebPæ ¼å¼
<Image src='https://cdn.researchopia.com/image.webp' />

// CDNåŠ é€Ÿ
const IMAGE_CDN = 'https://cdn.researchopia.com'
<Image src={`${IMAGE_CDN}/avatar/${user.id}.webp`} />

// æ‡’åŠ è½½
<Image src={imageSrc} lazyLoad />
```

#### 6.1.3 æ•°æ®ç¼“å­˜
```typescript
// src/services/paper.ts
import Taro from '@tarojs/taro'

export class PaperService {
  private static CACHE_KEY = 'paper_cache'
  private static CACHE_DURATION = 5 * 60 * 1000  // 5åˆ†é’Ÿ
  
  static async getByDOI(doi: string) {
    // å…ˆæŸ¥ç¼“å­˜
    const cached = await this.getFromCache(doi)
    if (cached) return cached
    
    // è¯·æ±‚API
    const paper = await request({
      url: `/api/papers/${doi}`
    })
    
    // å†™å…¥ç¼“å­˜
    await this.saveToCache(doi, paper)
    
    return paper
  }
  
  private static async getFromCache(doi: string) {
    try {
      const cache = await Taro.getStorageSync(this.CACHE_KEY) || {}
      const item = cache[doi]
      
      if (item && Date.now() - item.timestamp < this.CACHE_DURATION) {
        return item.data
      }
    } catch (error) {
      return null
    }
  }
  
  private static async saveToCache(doi: string, data: any) {
    try {
      const cache = await Taro.getStorageSync(this.CACHE_KEY) || {}
      cache[doi] = {
        data,
        timestamp: Date.now()
      }
      await Taro.setStorageSync(this.CACHE_KEY, cache)
    } catch (error) {
      console.error('[Cache] Save failed:', error)
    }
  }
}
```

### 6.2 ä½“éªŒè¯„åˆ†

å¾®ä¿¡å°ç¨‹åºä½“éªŒåˆ† = æ€§èƒ½åˆ† Ã— 0.5 + ä½“éªŒåˆ† Ã— 0.3 + æœ€ä½³å®è·µåˆ† Ã— 0.2

**ä¼˜åŒ–ç›®æ ‡**:
- æ€§èƒ½åˆ† > 85åˆ†
- ä½“éªŒåˆ† > 90åˆ†
- æœ€ä½³å®è·µåˆ† > 95åˆ†

**å…³é”®æŒ‡æ ‡**:
- é¦–å±æ¸²æŸ“æ—¶é—´ < 2ç§’
- ä»£ç åŒ…å¤§å° < 2MB (ä¸»åŒ… < 500KB)
- å›¾ç‰‡åŠ è½½è€—æ—¶ < 1ç§’

---

## 7. ä¸Šçº¿æµç¨‹

### 7.1 å‡†å¤‡å·¥ä½œæ¸…å•

#### 7.1.1 å¾®ä¿¡å…¬ä¼—å¹³å°æ³¨å†Œ

**æ­¥éª¤**:
1. è®¿é—® https://mp.weixin.qq.com/
2. æ³¨å†Œå°ç¨‹åºè´¦å·
3. é€‰æ‹©ä¸»ä½“ç±»å‹(ä¼ä¸š/ä¸ªäºº)
4. å®Œæˆè®¤è¯(ä¼ä¸šéœ€è¥ä¸šæ‰§ç…§,ä¸ªäººéœ€èº«ä»½è¯)
5. è·å– `AppID` å’Œ `AppSecret`

**è´¹ç”¨**:
- ä¸ªäººä¸»ä½“: å…è´¹
- ä¼ä¸šä¸»ä½“: Â¥300/å¹´(å¾®ä¿¡è®¤è¯è´¹)

#### 7.1.2 é…ç½®æœåŠ¡å™¨åŸŸå

ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å° â†’ å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ æœåŠ¡å™¨åŸŸå

**éœ€è¦é…ç½®çš„åŸŸå**:
```
requeståˆæ³•åŸŸå:
  - https://www.researchopia.com
  - https://api.researchopia.com
  - https://XXXXXXX.supabase.co

uploadFileåˆæ³•åŸŸå:
  - https://XXXXXXX.supabase.co

downloadFileåˆæ³•åŸŸå:
  - https://cdn.researchopia.com
  - https://XXXXXXX.supabase.co

socketåˆæ³•åŸŸå:
  - wss://realtime.supabase.co
```

**æ³¨æ„**:
- å¿…é¡»æ˜¯HTTPS
- åŸŸåéœ€å®ŒæˆICPå¤‡æ¡ˆ
- æ¯æœˆåªèƒ½ä¿®æ”¹5æ¬¡

#### 7.1.3 éšç§åè®®

åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®:
- ç”¨æˆ·éšç§ä¿æŠ¤æŒ‡å¼•
- æ”¶é›†çš„ç”¨æˆ·ä¿¡æ¯ç±»å‹
- æ•°æ®ä½¿ç”¨è¯´æ˜

### 7.2 æ„å»ºä¸ä¸Šä¼ 

#### 7.2.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

```typescript
// config/prod.ts
export default {
  env: {
    API_BASE_URL: 'https://www.researchopia.com/api',
    SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL,
    SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
  },
  defineConstants: {
    'process.env.NODE_ENV': JSON.stringify('production')
  },
  mini: {
    minified: true,  // å‹ç¼©ä»£ç 
    sourceMapType: 'hidden-source-map'  // ç”Ÿæˆsourcemapä½†ä¸æ‰“åŒ…
  }
}
```

#### 7.2.2 æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
# 1. æ¸…ç†ç¼“å­˜
rm -rf dist/
rm -rf node_modules/.cache/

# 2. å®‰è£…ä¾èµ–
npm ci  # ä½¿ç”¨package-lock.jsonç¡®ä¿ä¸€è‡´æ€§

# 3. æ„å»º
npm run build:weapp

# 4. æ£€æŸ¥åŒ…å¤§å°
du -sh dist/
```

#### 7.2.3 ä¸Šä¼ ä»£ç 

**æ–¹å¼ä¸€: å¾®ä¿¡å¼€å‘è€…å·¥å…·**
1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»"ä¸Šä¼ "æŒ‰é’®
3. å¡«å†™ç‰ˆæœ¬å·å’Œå¤‡æ³¨
4. ç‚¹å‡»ç¡®è®¤ä¸Šä¼ 

**æ–¹å¼äºŒ: CLIå·¥å…·(æ¨è)**
```bash
# å®‰è£…miniprogram-ci
npm install miniprogram-ci -g

# ä¸Šä¼ ä»£ç 
miniprogram-ci upload \
  --pp ./project.config.json \
  --pkp ./private.key \
  --appid wxXXXXXXXXXXXXXXXX \
  --uv 1.0.0 \
  --ud "é¦–æ¬¡å‘å¸ƒ"
```

### 7.3 æäº¤å®¡æ ¸

#### 7.3.1 åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æäº¤å®¡æ ¸

ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å° â†’ ç‰ˆæœ¬ç®¡ç† â†’ å¼€å‘ç‰ˆæœ¬ â†’ æäº¤å®¡æ ¸

**å¿…å¡«ä¿¡æ¯**:
- å°ç¨‹åºåç§°: ç ”å­¦æ¸¯
- å°ç¨‹åºç®€ä»‹: å­¦æœ¯è®ºæ–‡äº¤æµä¸å…±äº«å¹³å°
- æœåŠ¡ç±»ç›®: æ•™è‚² â†’ åœ¨çº¿æ•™è‚²
- æ ‡ç­¾: å­¦æœ¯ã€è®ºæ–‡ã€ç§‘ç ”ã€é˜…è¯»
- æµ‹è¯•è´¦å·(å¯é€‰)

#### 7.3.2 åŠŸèƒ½é¡µé¢æˆªå›¾

å‡†å¤‡4-5å¼ çœŸæœºæˆªå›¾(750x1334px):
- é¦–é¡µ
- æœç´¢é¡µ
- è®ºæ–‡è¯¦æƒ…
- å…±è¯»ä¼šè¯
- ä¸ªäººä¸­å¿ƒ

#### 7.3.3 å®¡æ ¸è¦ç‚¹

**æ˜“è¢«æ‹’ç»çš„æƒ…å†µ**:
- âŒ ä½¿ç”¨"å¾®ä¿¡"ç­‰ä¿ç•™è¯
- âŒ éœ€è¦å¼ºåˆ¶å…³æ³¨å…¬ä¼—å·
- âŒ å­˜åœ¨è¯±å¯¼åˆ†äº«
- âŒ æœªå®Œæˆçš„åŠŸèƒ½
- âŒ è¿åå†…å®¹è§„èŒƒ

**å®¡æ ¸å‘¨æœŸ**: é€šå¸¸1-7ä¸ªå·¥ä½œæ—¥

### 7.4 å‘å¸ƒä¸Šçº¿

å®¡æ ¸é€šè¿‡å:
1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°
2. ç‰ˆæœ¬ç®¡ç† â†’ å®¡æ ¸ç‰ˆæœ¬ â†’ æäº¤å‘å¸ƒ
3. å…¨é‡å‘å¸ƒæˆ–ç°åº¦å‘å¸ƒ(åˆ†é˜¶æ®µæ”¾é‡)

**ç°åº¦å‘å¸ƒå»ºè®®**:
- ç¬¬1å¤©: 5%ç”¨æˆ·
- ç¬¬3å¤©: 20%ç”¨æˆ·
- ç¬¬7å¤©: 50%ç”¨æˆ·
- ç¬¬14å¤©: 100%ç”¨æˆ·

---

## 8. è¿è¥ä¸ç›‘æ§

### 8.1 æ•°æ®ç»Ÿè®¡

#### 8.1.1 å¾®ä¿¡å®˜æ–¹ç»Ÿè®¡

ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å° â†’ ç»Ÿè®¡ â†’ è®¿é—®åˆ†æ

**å…³é”®æŒ‡æ ‡**:
- æ—¥æ´»ç”¨æˆ·(DAU)
- æ–°å¢ç”¨æˆ·
- è®¿é—®æ¬¡æ•°
- é¡µé¢è®¿é—®æ·±åº¦
- åˆ†äº«æ¬¡æ•°

#### 8.1.2 è‡ªå®šä¹‰åŸ‹ç‚¹

```typescript
// src/utils/analytics.ts
import Taro from '@tarojs/taro'

export class Analytics {
  /**
   * é¡µé¢æµè§ˆ
   */
  static trackPageView(pageName: string) {
    Taro.reportAnalytics('page_view', {
      page_name: pageName,
      timestamp: Date.now()
    })
  }
  
  /**
   * äº‹ä»¶è¿½è¸ª
   */
  static trackEvent(eventName: string, params?: Record<string, any>) {
    Taro.reportAnalytics(eventName, {
      ...params,
      timestamp: Date.now()
    })
  }
  
  /**
   * æœç´¢è¿½è¸ª
   */
  static trackSearch(keyword: string, resultCount: number) {
    this.trackEvent('search', {
      keyword,
      result_count: resultCount
    })
  }
  
  /**
   * è®ºæ–‡æŸ¥çœ‹
   */
  static trackPaperView(doi: string) {
    this.trackEvent('paper_view', { doi })
  }
}
```

### 8.2 é”™è¯¯ç›‘æ§

```typescript
// src/app.tsx
import Taro from '@tarojs/taro'

class App {
  onError(error: string) {
    console.error('[Global Error]', error)
    
    // ä¸ŠæŠ¥åˆ°æœåŠ¡å™¨
    Taro.request({
      url: 'https://www.researchopia.com/api/log/error',
      method: 'POST',
      data: {
        error,
        platform: 'wechat-miniprogram',
        timestamp: Date.now(),
        user_id: getUserId()
      }
    })
  }
  
  onPageNotFound(res) {
    console.error('[Page Not Found]', res)
    
    // é‡å®šå‘åˆ°é¦–é¡µ
    Taro.redirectTo({
      url: '/pages/index/index'
    })
  }
}
```

### 8.3 ç”¨æˆ·åé¦ˆ

```typescript
// src/pages/profile/index.tsx
const handleFeedback = () => {
  Taro.navigateToMiniProgram({
    appId: 'wxXXXXXXXXXXXXXXXX',  // å¾®ä¿¡å®¢æœå°ç¨‹åº
    path: 'pages/index/index',
    extraData: {
      source: 'researchopia'
    }
  })
}
```

---

## 9. æˆæœ¬ä¼°ç®—

### 9.1 å¼€å‘æˆæœ¬

| é˜¶æ®µ | äººåŠ› | å·¥æ—¶ | è¯´æ˜ |
|------|------|------|------|
| **éœ€æ±‚è®¾è®¡** | 1äºº | 3å¤© | åŠŸèƒ½æ¢³ç†ã€åŸå‹è®¾è®¡ |
| **ç¯å¢ƒæ­å»º** | 1äºº | 1å¤© | Taroé¡¹ç›®åˆå§‹åŒ– |
| **æ ¸å¿ƒåŠŸèƒ½å¼€å‘** | 2äºº | 15å¤© | ç™»å½•ã€æœç´¢ã€è¯¦æƒ…ã€ä¼šè¯ |
| **UI/UXä¼˜åŒ–** | 1äºº | 5å¤© | æ ·å¼ç¾åŒ–ã€äº¤äº’ä¼˜åŒ– |
| **æµ‹è¯•ä¿®å¤** | 1äºº | 5å¤© | çœŸæœºæµ‹è¯•ã€bugä¿®å¤ |
| **ä¸Šçº¿éƒ¨ç½²** | 1äºº | 2å¤© | å®¡æ ¸æäº¤ã€å‘å¸ƒé…ç½® |
| **æ€»è®¡** | | **31å¤©** | |

**äººåŠ›æˆæœ¬**: 2äºº Ã— 1ä¸ªæœˆ â‰ˆ **2äººæœˆ**

### 9.2 è¿è¥æˆæœ¬

| é¡¹ç›® | è´¹ç”¨ | å‘¨æœŸ | è¯´æ˜ |
|------|------|------|------|
| **å¾®ä¿¡è®¤è¯** | Â¥300 | å¹´ | ä¼ä¸šä¸»ä½“å¿…é¡» |
| **æœåŠ¡å™¨åŸŸåHTTPS** | Â¥0 | å¹´ | å¤ç”¨ç°æœ‰(Let's Encryptå…è´¹) |
| **CDNæµé‡** | Â¥50 | æœˆ | å›¾ç‰‡/é™æ€èµ„æºåŠ é€Ÿ |
| **åç«¯API** | Â¥0 | æœˆ | å¤ç”¨Supabase (å…è´¹é¢åº¦) |
| **å¹´åº¦æ€»è®¡** | **Â¥900** | | |

### 9.3 æ¨å¹¿æˆæœ¬(å¯é€‰)

| æ¸ é“ | è´¹ç”¨ | æ•ˆæœ |
|------|------|------|
| **å¾®ä¿¡æœç´¢å¹¿å‘Š** | Â¥5000/æœˆ | ç²¾å‡†è·å®¢ |
| **å…¬ä¼—å·æ¨æ–‡** | Â¥2000/ç¯‡ | å†…å®¹è¥é”€ |
| **å­¦æœ¯ç¤¾ç¾¤åˆä½œ** | Â¥0 | å…è´¹æ¨å¹¿ |

---

## 10. é£é™©ä¸åº”å¯¹

### 10.1 æŠ€æœ¯é£é™©

| é£é™© | ç­‰çº§ | åº”å¯¹æªæ–½ |
|------|------|----------|
| å°ç¨‹åºåŒ…ä½“ç§¯è¶…é™(2MB) | ğŸŸ¡ ä¸­ | åˆ†åŒ…åŠ è½½ + å›¾ç‰‡CDN |
| PDFæ¸²æŸ“æ€§èƒ½å·® | ğŸŸ¡ ä¸­ | é™çº§ä¸ºæ–‡æœ¬é¢„è§ˆ + è·³è½¬Web |
| å¾®ä¿¡APIé™åˆ¶(å¦‚WebSocket) | ğŸŸ¢ ä½ | ä½¿ç”¨Supabase Realtimeé€‚é… |

### 10.2 å®¡æ ¸é£é™©

| é£é™© | ç­‰çº§ | åº”å¯¹æªæ–½ |
|------|------|----------|
| å†…å®¹å®¡æ ¸ä¸é€šè¿‡ | ğŸŸ¡ ä¸­ | æ·»åŠ å†…å®¹ä¸¾æŠ¥åŠŸèƒ½ + æ•æ„Ÿè¯è¿‡æ»¤ |
| åŠŸèƒ½è¢«è®¤ä¸º"è¯±å¯¼åˆ†äº«" | ğŸŸ¢ ä½ | åˆ†äº«åŠŸèƒ½è®¾è®¡ç¬¦åˆè§„èŒƒ |
| ç±»ç›®é€‰æ‹©ä¸å½“ | ğŸŸ¢ ä½ | é€‰æ‹©"æ•™è‚²-åœ¨çº¿æ•™è‚²"ç±»ç›® |

### 10.3 è¿è¥é£é™©

| é£é™© | ç­‰çº§ | åº”å¯¹æªæ–½ |
|------|------|----------|
| ç”¨æˆ·æ´»è·ƒåº¦ä½ | ğŸŸ¡ ä¸­ | æ¶ˆæ¯é€šçŸ¥ + ç§¯åˆ†æ¿€åŠ± |
| æœåŠ¡å™¨æˆæœ¬è¶…æ”¯ | ğŸŸ¢ ä½ | Supabaseå…è´¹é¢åº¦è¶³å¤Ÿ |

---

## 11. é‡Œç¨‹ç¢‘è®¡åˆ’

### Week 1: é¡¹ç›®åˆå§‹åŒ–
- [x] Taroé¡¹ç›®æ­å»º
- [x] ç›®å½•ç»“æ„è®¾è®¡
- [x] å¼€å‘ç¯å¢ƒé…ç½®
- [x] å¾®ä¿¡å¼€å‘è€…å·¥å…·è°ƒè¯•

### Week 2: æ ¸å¿ƒåŠŸèƒ½å¼€å‘
- [ ] å¾®ä¿¡ç™»å½•
- [ ] è®ºæ–‡æœç´¢
- [ ] è®ºæ–‡è¯¦æƒ…
- [ ] çŠ¶æ€ç®¡ç†

### Week 3: é«˜çº§åŠŸèƒ½å¼€å‘
- [ ] å…±è¯»ä¼šè¯åˆ—è¡¨
- [ ] ä¼šè¯è¯¦æƒ…
- [ ] æ ‡æ³¨æŸ¥çœ‹
- [ ] ä¸ªäººä¸­å¿ƒ

### Week 4: ä¼˜åŒ–ä¸æµ‹è¯•
- [ ] UI/UXä¼˜åŒ–
- [ ] æ€§èƒ½ä¼˜åŒ–(åˆ†åŒ…ã€ç¼“å­˜)
- [ ] çœŸæœºæµ‹è¯•
- [ ] Bugä¿®å¤

### Week 5: ä¸Šçº¿å‡†å¤‡
- [ ] ç”Ÿäº§ç¯å¢ƒé…ç½®
- [ ] ä»£ç å®¡æŸ¥
- [ ] æäº¤å®¡æ ¸
- [ ] å‘å¸ƒä¸Šçº¿

---

## 12. åç»­è§„åˆ’

### çŸ­æœŸ(3ä¸ªæœˆ)
- [ ] æ·»åŠ åœ¨çº¿æ ‡æ³¨åŠŸèƒ½(PDFé«˜äº®)
- [ ] æ¶ˆæ¯é€šçŸ¥(æ¨¡æ¿æ¶ˆæ¯)
- [ ] ç”¨æˆ·å…³æ³¨/ç²‰ä¸ç³»ç»Ÿ
- [ ] æ•°æ®ç»Ÿè®¡ä¼˜åŒ–

### ä¸­æœŸ(6ä¸ªæœˆ)
- [ ] AIè®ºæ–‡æ‘˜è¦
- [ ] çŸ¥è¯†å›¾è°±å¯è§†åŒ–
- [ ] ä¸ªäººå­¦æœ¯ä¸»é¡µ
- [ ] ç¤¾åŒºåŠ¨æ€æµ

### é•¿æœŸ(1å¹´)
- [ ] å¤šç«¯å‘å¸ƒ(æ”¯ä»˜å®/ç™¾åº¦å°ç¨‹åº)
- [ ] ä¼ä¸šç‰ˆåŠŸèƒ½(å›¢é˜Ÿåä½œ)
- [ ] ä»˜è´¹å¢å€¼æœåŠ¡
- [ ] å›½é™…åŒ–æ”¯æŒ

---

## é™„å½•

### A. å‚è€ƒèµ„æ–™

- å¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£: https://developers.weixin.qq.com/miniprogram/dev/framework/
- Taroå®˜æ–¹æ–‡æ¡£: https://taro-docs.jd.com/
- Taro UIç»„ä»¶åº“: https://taro-ui.jd.com/
- Supabaseæ–‡æ¡£: https://supabase.com/docs

### B. ç¤ºä¾‹ä»£ç ä»“åº“

- Researchopia Web: https://github.com/your-org/researchopia
- Researchopia å°ç¨‹åº: https://github.com/your-org/researchopia-miniprogram

### C. è”ç³»æ–¹å¼

- æŠ€æœ¯æ”¯æŒ: tech@researchopia.com
- å•†åŠ¡åˆä½œ: business@researchopia.com

---

**æ–‡æ¡£ç»“æŸ**

**ç»´æŠ¤è€…**: Researchopia Team  
**æœ€åæ›´æ–°**: 2025-01-07
