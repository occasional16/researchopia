# 研学港Zotero插件登录指南

## 🎯 概述

插件现已实现真正的Supabase集成认证系统，直接在插件内部完成登录流程，无需外部跳转，提供最佳的用户体验。

## 🔐 内置登录系统

### 全新的登录方式

1. **点击"登录研学港"按钮**
2. **选择登录方式**：
   - **真实登录** - 使用您的研学港账户
   - **演示模式** - 立即体验所有功能（推荐）
3. **如选择真实登录**：
   - 在插件内直接输入邮箱和密码
   - 插件直接调用Supabase Auth API完成认证
   - 无需浏览器跳转，完全内部化流程

### 认证流程说明

- **完全内置**：所有认证流程在插件内部完成
- **直接API调用**：插件直接与Supabase Auth API通信
- **即时反馈**：登录成功或失败立即显示结果
- **安全可靠**：基于标准JWT token认证机制
- **持久化存储**：认证状态在插件重启后保持有效

## 🔧 故障排除

### 问题1：真实登录失败

**常见错误及解决方案**：
- **邮箱或密码错误**：请检查输入的邮箱和密码是否正确
- **邮箱未验证**：请先在网站上验证您的邮箱地址
- **登录尝试过多**：请等待几分钟后重试
- **网络连接问题**：检查网络连接是否正常

### 问题2：输入对话框显示异常

**解决方案**：
- 由于Zotero环境限制，输入对话框可能显示简化版本
- 建议使用**演示模式**体验完整功能
- 演示模式提供所有功能，只是不会上传到真实服务器

### 问题3：认证状态丢失

**解决方案**：
- 重新登录即可
- 认证token有24小时有效期
- 插件会自动尝试刷新过期的token

## 📝 技术说明

### 真正的Supabase集成优势

1. **完全内置认证**：无需外部浏览器跳转
2. **直接API通信**：插件直接调用Supabase Auth API
3. **标准JWT认证**：基于行业标准的JSON Web Token
4. **即时状态反馈**：登录成功或失败立即显示
5. **安全存储**：认证信息加密存储在Zotero配置中

### 认证数据存储

插件将认证信息存储在：
- `extensions.researchopia.supabaseToken` - JWT认证token
- `extensions.researchopia.supabaseUser` - 用户信息
- `extensions.researchopia.supabaseAuthTime` - 认证时间戳

## 🚀 使用建议

1. **首次使用**：建议选择演示模式快速体验功能
2. **真实使用**：确保您已在网站注册并验证邮箱
3. **遇到问题**：优先使用演示模式，然后联系技术支持

## 🎉 新架构优势

相比之前的外部跳转方案，新的内置认证系统具有：

- ✅ **无需浏览器跳转**：完全在插件内部完成
- ✅ **即时反馈**：登录结果立即显示
- ✅ **更好的用户体验**：流程简化，操作直观
- ✅ **更高的可靠性**：不依赖跨域通信
- ✅ **更强的兼容性**：适用于各种Zotero环境

这是真正的"集成"认证系统！
